!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Timeless={})}(this,function(e){"use strict";function t(e){return{all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map(function(e){e(n)}),(r=e.get("*"))&&r.slice().map(function(e){e(t,n)})}}}const n=function(){let e=0;return function(){return e+=1,e}}();var r;function o(){const r=t();let o=[];return{off(e,t){r.off(e,t)},on(e,t){const n=()=>{o=o.filter(e=>e!==n),this.off(e,t)};return o.push(n),r.on(e,t),n},uid:n,emit(e,t){r.emit(e,t)},destroy(){for(let e=0;e<o.length;e+=1){(0,o[e])()}this.emit(e.BaseEvents.Destroy,null)}}}e.BaseEvents=void 0,(r=e.BaseEvents||(e.BaseEvents={})).Loading="__loading",r.Destroy="__destroy";class s{unique_id="BaseDomain";debug=!1;_emitter=t();listeners={};constructor(e={}){const{unique_id:t,debug:n}=e;t&&(this.unique_id=t)}uid(){return n()}log(...e){return this.debug?[`%c CORE %c ${this.unique_id} %c`,"color:white;background:#dfa639;border-top-left-radius:2px;border-bottom-left-radius:2px;","color:white;background:#19be6b;border-top-right-radius:2px;border-bottom-right-radius:2px;","color:#19be6b;",...e]:[]}errorTip(...e){this.debug&&console.log(`%c CORE %c ${this.unique_id} %c`,"color:white;background:red;border-top-left-radius:2px;border-bottom-left-radius:2px;","color:white;background:#19be6b;border-top-right-radius:2px;border-bottom-right-radius:2px;","color:#19be6b;",...e)}off(e,t){this._emitter.off(e,t)}offEvent(e){const t=this.listeners[e]||[];for(let e=0;e<t.length;e+=1){(0,t[e])()}}on(e,t){const n=()=>{const r=this.listeners[e]||[];this.listeners[e]=r.filter(e=>e!==n),this.off(e,t)},r=this.listeners[e]||[];return r.push(n),this.listeners[e]=r,this._emitter.on(e,t),n}emit(e,t){this._emitter.emit(e,t)}destroy(){Object.keys(this.listeners).map(e=>{const t=this.listeners[e]||[];for(let e=0;e<t.length;e+=1){(0,t[e])()}}),this.emit(e.BaseEvents.Destroy)}onDestroy(t){return this.on(e.BaseEvents.Destroy,t)}get[Symbol.toStringTag](){return"Domain"}}class i extends Error{messages;code;data=null;constructor(e,t,n=null){super(e.join("\n")),this.messages=e,this.code=t,this.data=n}}const a={Ok:e=>({data:e,error:null}),Err:(e,t,n=null)=>({data:n,code:t,error:(()=>{if(Array.isArray(e)){return new i(e,t,n)}if("string"==typeof e){return new i([e],t,n)}if(e instanceof i)return e;if("object"==typeof e){return new i([e.message],t,n)}if(!e){return new i(["未知错误"],t,n)}return e.error})()})};var h;!function(e){e.Horizontal="horizontal",e.Vertical="vertical"}(h||(h={}));const l=768,u=992,c=1200,d=1536;function p(e){return e>=d?"2xl":e>=c?"xl":e>=u?"lg":e>=l?"md":"sm"}var f,g;!function(e){e[e.Tip=0]="Tip",e[e.Loading=1]="Loading",e[e.HideLoading=2]="HideLoading",e[e.Error=3]="Error",e[e.Login=4]="Login",e[e.Logout=5]="Logout",e[e.ForceUpdate=6]="ForceUpdate",e[e.DeviceSizeChange=7]="DeviceSizeChange",e[e.Ready=8]="Ready",e[e.Show=9]="Show",e[e.Hidden=10]="Hidden",e[e.Resize=11]="Resize",e[e.Blur=12]="Blur",e[e.Keydown=13]="Keydown",e[e.OrientationChange=14]="OrientationChange",e[e.EscapeKeyDown=15]="EscapeKeyDown",e[e.StateChange=16]="StateChange"}(f||(f={}));!function(e){e[e.StateChange=0]="StateChange",e[e.PresentChange=1]="PresentChange",e[e.Show=2]="Show",e[e.TmpShow=3]="TmpShow",e[e.Hidden=4]="Hidden",e[e.TmpHidden=5]="TmpHidden",e[e.Unmounted=6]="Unmounted"}(g||(g={}));class m extends s{name="PresenceCore";debug=!1;animationName="none";mounted=!1;enter=!1;visible=!1;exit=!1;get state(){return{mounted:this.mounted,enter:this.enter,visible:this.visible,exit:this.exit,text:(()=>this.exit?"exit":this.enter?"enter":this.visible?"visible":"unknown")()}}constructor(e={}){super(e);const{mounted:t=!1,visible:n=!1}=e;this.mounted=t,this.visible=n,n&&(this.mounted=!0)}toggle(){this.visible?this.hide():this.show()}show(){!1===this.mounted&&(this.mounted=!0),this.exit=!1,this.enter=!0,this.visible=!0,this.emit(g.StateChange,{...this.state}),setTimeout(()=>{this.emit(g.Show)},180)}hide(e={}){const{destroy:t=!0}=e;if(!1===t)return this.exit=!0,this.enter=!1,this.emit(g.StateChange,{...this.state}),void setTimeout(()=>{this.visible=!1,this.emit(g.Hidden),this.emit(g.StateChange,{...this.state})},180);this.exit=!0,this.enter=!1,this.emit(g.StateChange,{...this.state}),setTimeout(()=>{this.visible=!1,this.emit(g.Hidden),this.emit(g.StateChange,{...this.state}),this.unmount()},180)}unmount(){this.mounted=!1,this.enter=!1,this.visible=!1,this.exit=!1,this.emit(g.Unmounted),this.emit(g.StateChange,{...this.state})}reset(){this.mounted=!1,this.enter=!1,this.visible=!1,this.exit=!1,this.emit(g.StateChange,{...this.state})}onTmpShow(e){return this.on(g.TmpShow,e)}onTmpHidden(e){return this.on(g.TmpHidden,e)}onShow(e){return this.on(g.Show,e)}onHidden(e){return this.on(g.Hidden,e)}onUnmounted(e){return this.on(g.Unmounted,e)}onStateChange(e){return this.on(g.StateChange,e)}onPresentChange(e){return this.on(g.PresentChange,e)}get[Symbol.toStringTag](){return"Presence"}}var y,S,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function b(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var n=function e(){var n=!1;try{n=this instanceof e}catch{}return n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),n}function w(){return S?y:(S=1,y=TypeError)}var x,_,k,T,O,P,E,D,M,L,A,R,I,N,$,F,B,H,j,V,U,q,W,z,Y,K,G,Q,J,X,Z,ee,te,ne,re,oe,se,ie,ae,he,le,ue,ce,de,pe,fe,ge,me,ye,Se,Ce,ve,be,we,xe,_e,ke,Te,Oe,Pe,Ee,De,Me,Le,Ae,Re,Ie,Ne,$e,Fe,Be,He,je,Ve,Ue,qe,We,ze,Ye,Ke,Ge,Qe,Je,Xe,Ze,et,tt,nt,rt=b(Object.freeze({__proto__:null,default:{}}));function ot(){if(_)return x;_=1;var e="function"==typeof Map&&Map.prototype,t=Object.getOwnPropertyDescriptor&&e?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,n=e&&t&&"function"==typeof t.get?t.get:null,r=e&&Map.prototype.forEach,o="function"==typeof Set&&Set.prototype,s=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,i=o&&s&&"function"==typeof s.get?s.get:null,a=o&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,l="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,u="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,c=Boolean.prototype.valueOf,d=Object.prototype.toString,p=Function.prototype.toString,f=String.prototype.match,g=String.prototype.slice,m=String.prototype.replace,y=String.prototype.toUpperCase,S=String.prototype.toLowerCase,v=RegExp.prototype.test,b=Array.prototype.concat,w=Array.prototype.join,k=Array.prototype.slice,T=Math.floor,O="function"==typeof BigInt?BigInt.prototype.valueOf:null,P=Object.getOwnPropertySymbols,E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,D="function"==typeof Symbol&&"object"==typeof Symbol.iterator,M="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===D||"symbol")?Symbol.toStringTag:null,L=Object.prototype.propertyIsEnumerable,A=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||v.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-T(-e):T(e);if(r!==e){var o=String(r),s=g.call(t,o.length+1);return m.call(o,n,"$&_")+"."+m.call(m.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return m.call(t,n,"$&_")}var I=rt,N=I.custom,$=W(N)?N:null,F={__proto__:null,double:'"',single:"'"},B={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function H(e,t,n){var r=n.quoteStyle||t,o=F[r];return o+e+o}function j(e){return m.call(String(e),/"/g,"&quot;")}function V(e){return!M||!("object"==typeof e&&(M in e||void 0!==e[M]))}function U(e){return"[object Array]"===K(e)&&V(e)}function q(e){return"[object RegExp]"===K(e)&&V(e)}function W(e){if(D)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!E)return!1;try{return E.call(e),!0}catch(e){}return!1}x=function e(t,o,s,d){var y=o||{};if(Y(y,"quoteStyle")&&!Y(F,y.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Y(y,"maxStringLength")&&("number"==typeof y.maxStringLength?y.maxStringLength<0&&y.maxStringLength!==1/0:null!==y.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var v=!Y(y,"customInspect")||y.customInspect;if("boolean"!=typeof v&&"symbol"!==v)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Y(y,"indent")&&null!==y.indent&&"\t"!==y.indent&&!(parseInt(y.indent,10)===y.indent&&y.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Y(y,"numericSeparator")&&"boolean"!=typeof y.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=y.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return Q(t,y);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var _=String(t);return x?R(t,_):_}if("bigint"==typeof t){var T=String(t)+"n";return x?R(t,T):T}var P=void 0===y.depth?5:y.depth;if(void 0===s&&(s=0),s>=P&&P>0&&"object"==typeof t)return U(t)?"[Array]":"[Object]";var N=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=w.call(Array(e.indent+1)," ")}return{base:n,prev:w.call(Array(t+1),n)}}(y,s);if(void 0===d)d=[];else if(G(d,t)>=0)return"[Circular]";function B(t,n,r){if(n&&(d=k.call(d)).push(n),r){var o={depth:y.depth};return Y(y,"quoteStyle")&&(o.quoteStyle=y.quoteStyle),e(t,o,s+1,d)}return e(t,y,s+1,d)}if("function"==typeof t&&!q(t)){var z=function(e){if(e.name)return e.name;var t=f.call(p.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),J=ne(t,B);return"[Function"+(z?": "+z:" (anonymous)")+"]"+(J.length>0?" { "+w.call(J,", ")+" }":"")}if(W(t)){var re=D?m.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):E.call(t);return"object"!=typeof t||D?re:X(re)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var oe="<"+S.call(String(t.nodeName)),se=t.attributes||[],ie=0;ie<se.length;ie++)oe+=" "+se[ie].name+"="+H(j(se[ie].value),"double",y);return oe+=">",t.childNodes&&t.childNodes.length&&(oe+="..."),oe+="</"+S.call(String(t.nodeName))+">"}if(U(t)){if(0===t.length)return"[]";var ae=ne(t,B);return N&&!function(e){for(var t=0;t<e.length;t++)if(G(e[t],"\n")>=0)return!1;return!0}(ae)?"["+te(ae,N)+"]":"[ "+w.call(ae,", ")+" ]"}if(function(e){return"[object Error]"===K(e)&&V(e)}(t)){var he=ne(t,B);return"cause"in Error.prototype||!("cause"in t)||L.call(t,"cause")?0===he.length?"["+String(t)+"]":"{ ["+String(t)+"] "+w.call(he,", ")+" }":"{ ["+String(t)+"] "+w.call(b.call("[cause]: "+B(t.cause),he),", ")+" }"}if("object"==typeof t&&v){if($&&"function"==typeof t[$]&&I)return I(t,{depth:P-s});if("symbol"!==v&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!n||!e||"object"!=typeof e)return!1;try{n.call(e);try{i.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var le=[];return r&&r.call(t,function(e,n){le.push(B(n,t,!0)+" => "+B(e,t))}),ee("Map",n.call(t),le,N)}if(function(e){if(!i||!e||"object"!=typeof e)return!1;try{i.call(e);try{n.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ue=[];return a&&a.call(t,function(e){ue.push(B(e,t))}),ee("Set",i.call(t),ue,N)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{l.call(e,l)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return Z("WeakMap");if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e,l);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return Z("WeakSet");if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{return u.call(e),!0}catch(e){}return!1}(t))return Z("WeakRef");if(function(e){return"[object Number]"===K(e)&&V(e)}(t))return X(B(Number(t)));if(function(e){if(!e||"object"!=typeof e||!O)return!1;try{return O.call(e),!0}catch(e){}return!1}(t))return X(B(O.call(t)));if(function(e){return"[object Boolean]"===K(e)&&V(e)}(t))return X(c.call(t));if(function(e){return"[object String]"===K(e)&&V(e)}(t))return X(B(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&t===globalThis||void 0!==C&&t===C)return"{ [object globalThis] }";if(!function(e){return"[object Date]"===K(e)&&V(e)}(t)&&!q(t)){var ce=ne(t,B),de=A?A(t)===Object.prototype:t instanceof Object||t.constructor===Object,pe=t instanceof Object?"":"null prototype",fe=!de&&M&&Object(t)===t&&M in t?g.call(K(t),8,-1):pe?"Object":"",ge=(de||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(fe||pe?"["+w.call(b.call([],fe||[],pe||[]),": ")+"] ":"");return 0===ce.length?ge+"{}":N?ge+"{"+te(ce,N)+"}":ge+"{ "+w.call(ce,", ")+" }"}return String(t)};var z=Object.prototype.hasOwnProperty||function(e){return e in this};function Y(e,t){return z.call(e,t)}function K(e){return d.call(e)}function G(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function Q(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return Q(g.call(e,0,t.maxStringLength),t)+r}var o=B[t.quoteStyle||"single"];return o.lastIndex=0,H(m.call(m.call(e,o,"\\$1"),/[\x00-\x1f]/g,J),"single",t)}function J(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+y.call(t.toString(16))}function X(e){return"Object("+e+")"}function Z(e){return e+" { ? }"}function ee(e,t,n,r){return e+" ("+t+") {"+(r?te(n,r):w.call(n,", "))+"}"}function te(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+w.call(e,","+n)+"\n"+t.prev}function ne(e,t){var n=U(e),r=[];if(n){r.length=e.length;for(var o=0;o<e.length;o++)r[o]=Y(e,o)?t(e[o],e):""}var s,i="function"==typeof P?P(e):[];if(D){s={};for(var a=0;a<i.length;a++)s["$"+i[a]]=i[a]}for(var h in e)Y(e,h)&&(n&&String(Number(h))===h&&h<e.length||D&&s["$"+h]instanceof Symbol||(v.call(/[^\w$]/,h)?r.push(t(h,e)+": "+t(e[h],e)):r.push(h+": "+t(e[h],e))));if("function"==typeof P)for(var l=0;l<i.length;l++)L.call(e,i[l])&&r.push("["+t(i[l])+"]: "+t(e[i[l]],e));return r}return x}function st(){if(T)return k;T=1;var e=ot(),t=w(),n=function(e,t,n){for(var r,o=e;null!=(r=o.next);o=r)if(r.key===t)return o.next=r.next,n||(r.next=e.next,e.next=r),r};return k=function(){var r,o={assert:function(n){if(!o.has(n))throw new t("Side channel does not contain "+e(n))},delete:function(e){var t=r&&r.next,o=function(e,t){if(e)return n(e,t,!0)}(r,e);return o&&t&&t===o&&(r=void 0),!!o},get:function(e){return function(e,t){if(e){var r=n(e,t);return r&&r.value}}(r,e)},has:function(e){return function(e,t){return!!e&&!!n(e,t)}(r,e)},set:function(e,t){r||(r={next:void 0}),function(e,t,r){var o=n(e,t);o?o.value=r:e.next={key:t,next:e.next,value:r}}(r,e,t)}};return o}}function it(){return P?O:(P=1,O=Object)}function at(){return D?E:(D=1,E=Error)}function ht(){return L?M:(L=1,M=EvalError)}function lt(){return R?A:(R=1,A=RangeError)}function ut(){return N?I:(N=1,I=ReferenceError)}function ct(){return F?$:(F=1,$=SyntaxError)}function dt(){return H?B:(H=1,B=URIError)}function pt(){return V?j:(V=1,j=Math.abs)}function ft(){return q?U:(q=1,U=Math.floor)}function gt(){return z?W:(z=1,W=Math.max)}function mt(){return K?Y:(K=1,Y=Math.min)}function yt(){return Q?G:(Q=1,G=Math.pow)}function St(){return X?J:(X=1,J=Math.round)}function Ct(){return ee?Z:(ee=1,Z=Number.isNaN||function(e){return e!=e})}function vt(){if(ne)return te;ne=1;var e=Ct();return te=function(t){return e(t)||0===t?t:t<0?-1:1}}function bt(){return oe?re:(oe=1,re=Object.getOwnPropertyDescriptor)}function wt(){if(ie)return se;ie=1;var e=bt();if(e)try{e([],"length")}catch(t){e=null}return se=e}function xt(){if(he)return ae;he=1;var e=Object.defineProperty||!1;if(e)try{e({},"a",{value:1})}catch(t){e=!1}return ae=e}function _t(){if(de)return ce;de=1;var e="undefined"!=typeof Symbol&&Symbol,t=ue?le:(ue=1,le=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(var r in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var o=Object.getOwnPropertySymbols(e);if(1!==o.length||o[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0});return ce=function(){return"function"==typeof e&&("function"==typeof Symbol&&("symbol"==typeof e("foo")&&("symbol"==typeof Symbol("bar")&&t())))}}function kt(){return fe?pe:(fe=1,pe="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null)}function Tt(){return me?ge:(me=1,ge=it().getPrototypeOf||null)}function Ot(){if(Se)return ye;Se=1;var e=Object.prototype.toString,t=Math.max,n=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var o=0;o<t.length;o+=1)n[o+e.length]=t[o];return n};return ye=function(r){var o=this;if("function"!=typeof o||"[object Function]"!==e.apply(o))throw new TypeError("Function.prototype.bind called on incompatible "+o);for(var s,i=function(e,t){for(var n=[],r=t,o=0;r<e.length;r+=1,o+=1)n[o]=e[r];return n}(arguments,1),a=t(0,o.length-i.length),h=[],l=0;l<a;l++)h[l]="$"+l;if(s=Function("binder","return function ("+function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n}(h,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof s){var e=o.apply(this,n(i,arguments));return Object(e)===e?e:this}return o.apply(r,n(i,arguments))}),o.prototype){var u=function(){};u.prototype=o.prototype,s.prototype=new u,u.prototype=null}return s},ye}function Pt(){if(ve)return Ce;ve=1;var e=Ot();return Ce=Function.prototype.bind||e}function Et(){return we?be:(we=1,be=Function.prototype.call)}function Dt(){return _e?xe:(_e=1,xe=Function.prototype.apply)}function Mt(){if(Pe)return Oe;Pe=1;var e=Pt(),t=Dt(),n=Et(),r=Te?ke:(Te=1,ke="undefined"!=typeof Reflect&&Reflect&&Reflect.apply);return Oe=r||e.call(n,t)}function Lt(){if(De)return Ee;De=1;var e=Pt(),t=w(),n=Et(),r=Mt();return Ee=function(o){if(o.length<1||"function"!=typeof o[0])throw new t("a function is required");return r(e,n,o)}}function At(){if(Le)return Me;Le=1;var e,t=Lt(),n=wt();try{e=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var r=!!e&&n&&n(Object.prototype,"__proto__"),o=Object,s=o.getPrototypeOf;return Me=r&&"function"==typeof r.get?t([r.get]):"function"==typeof s&&function(e){return s(null==e?e:o(e))}}function Rt(){if(Re)return Ae;Re=1;var e=kt(),t=Tt(),n=At();return Ae=e?function(t){return e(t)}:t?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return t(e)}:n?function(e){return n(e)}:null}function It(){if(Ne)return Ie;Ne=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,n=Pt();return Ie=n.call(e,t)}function Nt(){if(Fe)return $e;var e;Fe=1;var t=it(),n=at(),r=ht(),o=lt(),s=ut(),i=ct(),a=w(),h=dt(),l=pt(),u=ft(),c=gt(),d=mt(),p=yt(),f=St(),g=vt(),m=Function,y=function(e){try{return m('"use strict"; return ('+e+").constructor;")()}catch(e){}},S=wt(),C=xt(),v=function(){throw new a},b=S?function(){try{return v}catch(e){try{return S(arguments,"callee").get}catch(e){return v}}}():v,x=_t()(),_=Rt(),k=Tt(),T=kt(),O=Dt(),P=Et(),E={},D="undefined"!=typeof Uint8Array&&_?_(Uint8Array):e,M={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?e:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?e:ArrayBuffer,"%ArrayIteratorPrototype%":x&&_?_([][Symbol.iterator]()):e,"%AsyncFromSyncIteratorPrototype%":e,"%AsyncFunction%":E,"%AsyncGenerator%":E,"%AsyncGeneratorFunction%":E,"%AsyncIteratorPrototype%":E,"%Atomics%":"undefined"==typeof Atomics?e:Atomics,"%BigInt%":"undefined"==typeof BigInt?e:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?e:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?e:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?e:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":r,"%Float16Array%":"undefined"==typeof Float16Array?e:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?e:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?e:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?e:FinalizationRegistry,"%Function%":m,"%GeneratorFunction%":E,"%Int8Array%":"undefined"==typeof Int8Array?e:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?e:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?e:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":x&&_?_(_([][Symbol.iterator]())):e,"%JSON%":"object"==typeof JSON?JSON:e,"%Map%":"undefined"==typeof Map?e:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&x&&_?_((new Map)[Symbol.iterator]()):e,"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":S,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?e:Promise,"%Proxy%":"undefined"==typeof Proxy?e:Proxy,"%RangeError%":o,"%ReferenceError%":s,"%Reflect%":"undefined"==typeof Reflect?e:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?e:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&x&&_?_((new Set)[Symbol.iterator]()):e,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?e:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":x&&_?_(""[Symbol.iterator]()):e,"%Symbol%":x?Symbol:e,"%SyntaxError%":i,"%ThrowTypeError%":b,"%TypedArray%":D,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?e:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?e:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?e:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?e:Uint32Array,"%URIError%":h,"%WeakMap%":"undefined"==typeof WeakMap?e:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?e:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?e:WeakSet,"%Function.prototype.call%":P,"%Function.prototype.apply%":O,"%Object.defineProperty%":C,"%Object.getPrototypeOf%":k,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":c,"%Math.min%":d,"%Math.pow%":p,"%Math.round%":f,"%Math.sign%":g,"%Reflect.getPrototypeOf%":T};if(_)try{null.error}catch(e){var L=_(_(e));M["%Error.prototype%"]=L}var A=function e(t){var n;if("%AsyncFunction%"===t)n=y("async function () {}");else if("%GeneratorFunction%"===t)n=y("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=y("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&_&&(n=_(o.prototype))}return M[t]=n,n},R={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},I=Pt(),N=It(),$=I.call(P,Array.prototype.concat),F=I.call(O,Array.prototype.splice),B=I.call(P,String.prototype.replace),H=I.call(P,String.prototype.slice),j=I.call(P,RegExp.prototype.exec),V=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,U=/\\(\\)?/g,q=function(e,t){var n,r=e;if(N(R,r)&&(r="%"+(n=R[r])[0]+"%"),N(M,r)){var o=M[r];if(o===E&&(o=A(r)),void 0===o&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new i("intrinsic "+e+" does not exist!")};return $e=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');if(null===j(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=H(e,0,1),n=H(e,-1);if("%"===t&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return B(e,V,function(e,t,n,o){r[r.length]=n?B(o,U,"$1"):t||e}),r}(e),r=n.length>0?n[0]:"",o=q("%"+r+"%",t),s=o.name,h=o.value,l=!1,u=o.alias;u&&(r=u[0],F(n,$([0,1],u)));for(var c=1,d=!0;c<n.length;c+=1){var p=n[c],f=H(p,0,1),g=H(p,-1);if(('"'===f||"'"===f||"`"===f||'"'===g||"'"===g||"`"===g)&&f!==g)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&d||(l=!0),N(M,s="%"+(r+="."+p)+"%"))h=M[s];else if(null!=h){if(!(p in h)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(S&&c+1>=n.length){var m=S(h,p);h=(d=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:h[p]}else d=N(h,p),h=h[p];d&&!l&&(M[s]=h)}}return h},$e}function $t(){if(He)return Be;He=1;var e=Nt(),t=Lt(),n=t([e("%String.prototype.indexOf%")]);return Be=function(r,o){var s=e(r,!!o);return"function"==typeof s&&n(r,".prototype.")>-1?t([s]):s}}function Ft(){if(Ve)return je;Ve=1;var e=Nt(),t=$t(),n=ot(),r=w(),o=e("%Map%",!0),s=t("Map.prototype.get",!0),i=t("Map.prototype.set",!0),a=t("Map.prototype.has",!0),h=t("Map.prototype.delete",!0),l=t("Map.prototype.size",!0);return je=!!o&&function(){var e,t={assert:function(e){if(!t.has(e))throw new r("Side channel does not contain "+n(e))},delete:function(t){if(e){var n=h(e,t);return 0===l(e)&&(e=void 0),n}return!1},get:function(t){if(e)return s(e,t)},has:function(t){return!!e&&a(e,t)},set:function(t,n){e||(e=new o),i(e,t,n)}};return t}}function Bt(){if(ze)return We;ze=1;var e=w(),t=ot(),n=st(),r=Ft(),o=function(){if(qe)return Ue;qe=1;var e=Nt(),t=$t(),n=ot(),r=Ft(),o=w(),s=e("%WeakMap%",!0),i=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),h=t("WeakMap.prototype.has",!0),l=t("WeakMap.prototype.delete",!0);return Ue=s?function(){var e,t,u={assert:function(e){if(!u.has(e))throw new o("Side channel does not contain "+n(e))},delete:function(n){if(s&&n&&("object"==typeof n||"function"==typeof n)){if(e)return l(e,n)}else if(r&&t)return t.delete(n);return!1},get:function(n){return s&&n&&("object"==typeof n||"function"==typeof n)&&e?i(e,n):t&&t.get(n)},has:function(n){return s&&n&&("object"==typeof n||"function"==typeof n)&&e?h(e,n):!!t&&t.has(n)},set:function(n,o){s&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new s),a(e,n,o)):r&&(t||(t=r()),t.set(n,o))}};return u}:r}(),s=o||r||n;return We=function(){var n,r={assert:function(n){if(!r.has(n))throw new e("Side channel does not contain "+t(n))},delete:function(e){return!!n&&n.delete(e)},get:function(e){return n&&n.get(e)},has:function(e){return!!n&&n.has(e)},set:function(e,t){n||(n=s()),n.set(e,t)}};return r}}function Ht(){if(Ke)return Ye;Ke=1;var e=String.prototype.replace,t=/%20/g,n="RFC3986";return Ye={default:n,formatters:{RFC1738:function(n){return e.call(n,t,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:n}}function jt(){if(Qe)return Ge;Qe=1;var e=Ht(),t=Bt(),n=Object.prototype.hasOwnProperty,r=Array.isArray,o=t(),s=function(e,t){return o.set(e,t),e},i=function(e){return o.has(e)},a=function(e){return o.get(e)},h=function(e,t){o.set(e,t)},l=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),u=function(e,t){for(var n=t&&t.plainObjects?{__proto__:null}:{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n},c=1024;return Ge={arrayToObject:u,assign:function(e,t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},combine:function(e,t,n,r){if(i(e)){var o=a(e)+1;return e[o]=t,h(e,o),e}var l=[].concat(e,t);return l.length>n?s(u(l,{plainObjects:r}),l.length-1):l},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],o=0;o<t.length;++o)for(var s=t[o],i=s.obj[s.prop],a=Object.keys(i),h=0;h<a.length;++h){var l=a[h],u=i[l];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:i,prop:l}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(r(n)){for(var o=[],s=0;s<n.length;++s)void 0!==n[s]&&o.push(n[s]);t.obj[t.prop]=o}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(t,n,r,o,s){if(0===t.length)return t;var i=t;if("symbol"==typeof t?i=Symbol.prototype.toString.call(t):"string"!=typeof t&&(i=String(t)),"iso-8859-1"===r)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var a="",h=0;h<i.length;h+=c){for(var u=i.length>=c?i.slice(h,h+c):i,d=[],p=0;p<u.length;++p){var f=u.charCodeAt(p);45===f||46===f||95===f||126===f||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||s===e.RFC1738&&(40===f||41===f)?d[d.length]=u.charAt(p):f<128?d[d.length]=l[f]:f<2048?d[d.length]=l[192|f>>6]+l[128|63&f]:f<55296||f>=57344?d[d.length]=l[224|f>>12]+l[128|f>>6&63]+l[128|63&f]:(p+=1,f=65536+((1023&f)<<10|1023&u.charCodeAt(p)),d[d.length]=l[240|f>>18]+l[128|f>>12&63]+l[128|f>>6&63]+l[128|63&f])}a+=d.join("")}return a},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isOverflow:i,isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(r(e)){for(var n=[],o=0;o<e.length;o+=1)n.push(t(e[o]));return n}return t(e)},merge:function e(t,o,l){if(!o)return t;if("object"!=typeof o&&"function"!=typeof o){if(r(t))t.push(o);else{if(!t||"object"!=typeof t)return[t,o];if(i(t)){var c=a(t)+1;t[c]=o,h(t,c)}else(l&&(l.plainObjects||l.allowPrototypes)||!n.call(Object.prototype,o))&&(t[o]=!0)}return t}if(!t||"object"!=typeof t){if(i(o)){for(var d=Object.keys(o),p=l&&l.plainObjects?{__proto__:null,0:t}:{0:t},f=0;f<d.length;f++){p[parseInt(d[f],10)+1]=o[d[f]]}return s(p,a(o)+1)}return[t].concat(o)}var g=t;return r(t)&&!r(o)&&(g=u(t,l)),r(t)&&r(o)?(o.forEach(function(r,o){if(n.call(t,o)){var s=t[o];s&&"object"==typeof s&&r&&"object"==typeof r?t[o]=e(s,r,l):t.push(r)}else t[o]=r}),t):Object.keys(o).reduce(function(t,r){var s=o[r];return n.call(t,r)?t[r]=e(t[r],s,l):t[r]=s,t},g)}},Ge}function Vt(){if(Xe)return Je;Xe=1;var e=Bt(),t=jt(),n=Ht(),r=Object.prototype.hasOwnProperty,o={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Array.isArray,i=Array.prototype.push,a=function(e,t){i.apply(e,s(t)?t:[t])},h=Date.prototype.toISOString,l=n.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:n.formatters[l],indices:!1,serializeDate:function(e){return h.call(e)},skipNulls:!1,strictNullHandling:!1},c={},d=function n(r,o,i,h,l,d,p,f,g,m,y,S,C,v,b,w,x,_){for(var k=r,T=_,O=0,P=!1;void 0!==(T=T.get(c))&&!P;){var E=T.get(r);if(O+=1,void 0!==E){if(E===O)throw new RangeError("Cyclic object value");P=!0}void 0===T.get(c)&&(O=0)}if("function"==typeof m?k=m(o,k):k instanceof Date?k=C(k):"comma"===i&&s(k)&&(k=t.maybeMap(k,function(e){return e instanceof Date?C(e):e})),null===k){if(d)return g&&!w?g(o,u.encoder,x,"key",v):o;k=""}if(function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e}(k)||t.isBuffer(k))return g?[b(w?o:g(o,u.encoder,x,"key",v))+"="+b(g(k,u.encoder,x,"value",v))]:[b(o)+"="+b(String(k))];var D,M=[];if(void 0===k)return M;if("comma"===i&&s(k))w&&g&&(k=t.maybeMap(k,g)),D=[{value:k.length>0?k.join(",")||null:void 0}];else if(s(m))D=m;else{var L=Object.keys(k);D=y?L.sort(y):L}var A=f?String(o).replace(/\./g,"%2E"):String(o),R=h&&s(k)&&1===k.length?A+"[]":A;if(l&&s(k)&&0===k.length)return R+"[]";for(var I=0;I<D.length;++I){var N=D[I],$="object"==typeof N&&N&&void 0!==N.value?N.value:k[N];if(!p||null!==$){var F=S&&f?String(N).replace(/\./g,"%2E"):String(N),B=s(k)?"function"==typeof i?i(R,F):R:R+(S?"."+F:"["+F+"]");_.set(r,O);var H=e();H.set(c,_),a(M,n($,B,i,h,l,d,p,f,"comma"===i&&w&&s(k)?null:g,m,y,S,C,v,b,w,x,H))}}return M};return Je=function(t,i){var h,l=t,c=function(e){if(!e)return u;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||u.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=n.default;if(void 0!==e.format){if(!r.call(n.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var a,h=n.formatters[i],l=u.filter;if(("function"==typeof e.filter||s(e.filter))&&(l=e.filter),a=e.arrayFormat in o?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":u.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var c=void 0===e.allowDots?!0===e.encodeDotInKeys||u.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:u.addQueryPrefix,allowDots:c,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?u.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:u.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:u.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:u.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:u.encodeValuesOnly,filter:l,format:i,formatter:h,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:u.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:u.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:u.strictNullHandling}}(i);"function"==typeof c.filter?l=(0,c.filter)("",l):s(c.filter)&&(h=c.filter);var p=[];if("object"!=typeof l||null===l)return"";var f=o[c.arrayFormat],g="comma"===f&&c.commaRoundTrip;h||(h=Object.keys(l)),c.sort&&h.sort(c.sort);for(var m=e(),y=0;y<h.length;++y){var S=h[y],C=l[S];c.skipNulls&&null===C||a(p,d(C,S,f,g,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,m))}var v=p.join(c.delimiter),b=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),v.length>0?b+v:""},Je}function Ut(){if(et)return Ze;et=1;var e=jt(),t=Object.prototype.hasOwnProperty,n=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:e.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},o=function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},s=function(e,t,n){if(e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1)return e.split(",");if(t.throwOnLimitExceeded&&n>=t.arrayLimit)throw new RangeError("Array limit exceeded. Only "+t.arrayLimit+" element"+(1===t.arrayLimit?"":"s")+" allowed in an array.");return e},i=function(n,r,o,i){if(n){var a=function(e,n){var r=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e;if(n.depth<=0){if(!n.plainObjects&&t.call(Object.prototype,r)&&!n.allowPrototypes)return;return[r]}var o=/(\[[^[\]]*])/g,s=/(\[[^[\]]*])/.exec(r),i=s?r.slice(0,s.index):r,a=[];if(i){if(!n.plainObjects&&t.call(Object.prototype,i)&&!n.allowPrototypes)return;a.push(i)}for(var h=0;null!==(s=o.exec(r))&&h<n.depth;){h+=1;var l=s[1].slice(1,-1);if(!n.plainObjects&&t.call(Object.prototype,l)&&!n.allowPrototypes)return;a.push(s[1])}if(s){if(!0===n.strictDepth)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");a.push("["+r.slice(s.index)+"]")}return a}(n,o);if(a)return function(t,n,r,o){var i=0;if(t.length>0&&"[]"===t[t.length-1]){var a=t.slice(0,-1).join("");i=Array.isArray(n)&&n[a]?n[a].length:0}for(var h=o?n:s(n,r,i),l=t.length-1;l>=0;--l){var u,c=t[l];if("[]"===c&&r.parseArrays)u=e.isOverflow(h)?h:r.allowEmptyArrays&&(""===h||r.strictNullHandling&&null===h)?[]:e.combine([],h,r.arrayLimit,r.plainObjects);else{u=r.plainObjects?{__proto__:null}:{};var d="["===c.charAt(0)&&"]"===c.charAt(c.length-1)?c.slice(1,-1):c,p=r.decodeDotInKeys?d.replace(/%2E/g,"."):d,f=parseInt(p,10);r.parseArrays||""!==p?!isNaN(f)&&c!==p&&String(f)===p&&f>=0&&r.parseArrays&&f<=r.arrayLimit?(u=[])[f]=h:"__proto__"!==p&&(u[p]=h):u={0:h}}h=u}return h}(a,r,o,i)}};return Ze=function(a,h){var l=function(t){if(!t)return r;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.decodeDotInKeys&&"boolean"!=typeof t.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0!==t.throwOnLimitExceeded&&"boolean"!=typeof t.throwOnLimitExceeded)throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var n=void 0===t.charset?r.charset:t.charset,o=void 0===t.duplicates?r.duplicates:t.duplicates;if("combine"!==o&&"first"!==o&&"last"!==o)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===t.allowDots?!0===t.decodeDotInKeys||r.allowDots:!!t.allowDots,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:r.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:r.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:r.arrayLimit,charset:n,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:r.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:r.comma,decodeDotInKeys:"boolean"==typeof t.decodeDotInKeys?t.decodeDotInKeys:r.decodeDotInKeys,decoder:"function"==typeof t.decoder?t.decoder:r.decoder,delimiter:"string"==typeof t.delimiter||e.isRegExp(t.delimiter)?t.delimiter:r.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:r.depth,duplicates:o,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:r.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:r.plainObjects,strictDepth:"boolean"==typeof t.strictDepth?!!t.strictDepth:r.strictDepth,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:"boolean"==typeof t.throwOnLimitExceeded&&t.throwOnLimitExceeded}}(h);if(""===a||null==a)return l.plainObjects?{__proto__:null}:{};for(var u="string"==typeof a?function(i,a){var h={__proto__:null},l=a.ignoreQueryPrefix?i.replace(/^\?/,""):i;l=l.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var u=a.parameterLimit===1/0?void 0:a.parameterLimit,c=l.split(a.delimiter,a.throwOnLimitExceeded?u+1:u);if(a.throwOnLimitExceeded&&c.length>u)throw new RangeError("Parameter limit exceeded. Only "+u+" parameter"+(1===u?"":"s")+" allowed.");var d,p=-1,f=a.charset;if(a.charsetSentinel)for(d=0;d<c.length;++d)0===c[d].indexOf("utf8=")&&("utf8=%E2%9C%93"===c[d]?f="utf-8":"utf8=%26%2310003%3B"===c[d]&&(f="iso-8859-1"),p=d,d=c.length);for(d=0;d<c.length;++d)if(d!==p){var g,m,y=c[d],S=y.indexOf("]="),C=-1===S?y.indexOf("="):S+1;if(-1===C?(g=a.decoder(y,r.decoder,f,"key"),m=a.strictNullHandling?null:""):null!==(g=a.decoder(y.slice(0,C),r.decoder,f,"key"))&&(m=e.maybeMap(s(y.slice(C+1),a,n(h[g])?h[g].length:0),function(e){return a.decoder(e,r.decoder,f,"value")})),m&&a.interpretNumericEntities&&"iso-8859-1"===f&&(m=o(String(m))),y.indexOf("[]=")>-1&&(m=n(m)?[m]:m),null!==g){var v=t.call(h,g);v&&"combine"===a.duplicates?h[g]=e.combine(h[g],m,a.arrayLimit,a.plainObjects):v&&"last"!==a.duplicates||(h[g]=m)}}return h}(a,l):a,c=l.plainObjects?{__proto__:null}:{},d=Object.keys(u),p=0;p<d.length;++p){var f=d[p],g=i(f,u[f],l,"string"==typeof a);c=e.merge(c,g,l)}return!0===l.allowSparse?c:e.compact(c)}}function qt(){if(nt)return tt;nt=1;var e=Vt(),t=Ut();return tt={formats:Ht(),parse:t,stringify:e}}var Wt,zt,Yt=v(qt());var Kt,Gt,Qt,Jt={};var Xt,Zt=function(){if(Qt)return Gt;Qt=1;var e=zt?Wt:(zt=1,Wt=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}),t=function(){if(Kt)return Jt;Kt=1;var e=Object.prototype.hasOwnProperty;function t(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function n(e){try{return encodeURIComponent(e)}catch(e){return null}}return Jt.stringify=function(t,r){r=r||"";var o,s,i=[];for(s in"string"!=typeof r&&(r="?"),t)if(e.call(t,s)){if((o=t[s])||null!=o&&!isNaN(o)||(o=""),s=n(s),o=n(o),null===s||null===o)continue;i.push(s+"="+o)}return i.length?r+i.join("&"):""},Jt.parse=function(e){for(var n,r=/([^=?#&]+)=?([^&]*)/g,o={};n=r.exec(e);){var s=t(n[1]),i=t(n[2]);null===s||null===i||s in o||(o[s]=i)}return o},Jt}(),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,s=/:\d+$/,i=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,a=/^[a-zA-Z]:/;function h(e){return(e||"").toString().replace(n,"")}var l=[["#","hash"],["?","query"],function(e,t){return d(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],u={hash:1,query:1};function c(e){var t,n=("undefined"!=typeof window?window:void 0!==C?C:"undefined"!=typeof self?self:{}).location||{},r={},s=typeof(e=e||n);if("blob:"===e.protocol)r=new f(unescape(e.pathname),{});else if("string"===s)for(t in r=new f(e,{}),u)delete r[t];else if("object"===s){for(t in e)t in u||(r[t]=e[t]);void 0===r.slashes&&(r.slashes=o.test(e.href))}return r}function d(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function p(e,t){e=(e=h(e)).replace(r,""),t=t||{};var n,o=i.exec(e),s=o[1]?o[1].toLowerCase():"",a=!!o[2],l=!!o[3],u=0;return a?l?(n=o[2]+o[3]+o[4],u=o[2].length+o[3].length):(n=o[2]+o[4],u=o[2].length):l?(n=o[3]+o[4],u=o[3].length):n=o[4],"file:"===s?u>=2&&(n=n.slice(2)):d(s)?n=o[4]:s?a&&(n=n.slice(2)):u>=2&&d(t.protocol)&&(n=o[4]),{protocol:s,slashes:a||d(s),slashesCount:u,rest:n}}function f(n,o,s){if(n=(n=h(n)).replace(r,""),!(this instanceof f))return new f(n,o,s);var i,u,g,m,y,S,C=l.slice(),v=typeof o,b=this,w=0;for("object"!==v&&"string"!==v&&(s=o,o=null),s&&"function"!=typeof s&&(s=t.parse),i=!(u=p(n||"",o=c(o))).protocol&&!u.slashes,b.slashes=u.slashes||i&&o.slashes,b.protocol=u.protocol||o.protocol||"",n=u.rest,("file:"===u.protocol&&(2!==u.slashesCount||a.test(n))||!u.slashes&&(u.protocol||u.slashesCount<2||!d(b.protocol)))&&(C[3]=[/(.*)/,"pathname"]);w<C.length;w++)"function"!=typeof(m=C[w])?(g=m[0],S=m[1],g!=g?b[S]=n:"string"==typeof g?~(y="@"===g?n.lastIndexOf(g):n.indexOf(g))&&("number"==typeof m[2]?(b[S]=n.slice(0,y),n=n.slice(y+m[2])):(b[S]=n.slice(y),n=n.slice(0,y))):(y=g.exec(n))&&(b[S]=y[1],n=n.slice(0,y.index)),b[S]=b[S]||i&&m[3]&&o[S]||"",m[4]&&(b[S]=b[S].toLowerCase())):n=m(n,b);s&&(b.query=s(b.query)),i&&o.slashes&&"/"!==b.pathname.charAt(0)&&(""!==b.pathname||""!==o.pathname)&&(b.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,o=n[r-1],s=!1,i=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),i++):i&&(0===r&&(s=!0),n.splice(r,1),i--);return s&&n.unshift(""),"."!==o&&".."!==o||n.push(""),n.join("/")}(b.pathname,o.pathname)),"/"!==b.pathname.charAt(0)&&d(b.protocol)&&(b.pathname="/"+b.pathname),e(b.port,b.protocol)||(b.host=b.hostname,b.port=""),b.username=b.password="",b.auth&&(~(y=b.auth.indexOf(":"))?(b.username=b.auth.slice(0,y),b.username=encodeURIComponent(decodeURIComponent(b.username)),b.password=b.auth.slice(y+1),b.password=encodeURIComponent(decodeURIComponent(b.password))):b.username=encodeURIComponent(decodeURIComponent(b.auth)),b.auth=b.password?b.username+":"+b.password:b.username),b.origin="file:"!==b.protocol&&d(b.protocol)&&b.host?b.protocol+"//"+b.host:"null",b.href=b.toString()}return f.prototype={set:function(n,r,o){var i=this;switch(n){case"query":"string"==typeof r&&r.length&&(r=(o||t.parse)(r)),i[n]=r;break;case"port":i[n]=r,e(r,i.protocol)?r&&(i.host=i.hostname+":"+r):(i.host=i.hostname,i[n]="");break;case"hostname":i[n]=r,i.port&&(r+=":"+i.port),i.host=r;break;case"host":i[n]=r,s.test(r)?(r=r.split(":"),i.port=r.pop(),i.hostname=r.join(":")):(i.hostname=r,i.port="");break;case"protocol":i.protocol=r.toLowerCase(),i.slashes=!o;break;case"pathname":case"hash":if(r){var a="pathname"===n?"/":"#";i[n]=r.charAt(0)!==a?a+r:r}else i[n]=r;break;case"username":case"password":i[n]=encodeURIComponent(r);break;case"auth":var h=r.indexOf(":");~h?(i.username=r.slice(0,h),i.username=encodeURIComponent(decodeURIComponent(i.username)),i.password=r.slice(h+1),i.password=encodeURIComponent(decodeURIComponent(i.password))):i.username=encodeURIComponent(decodeURIComponent(r))}for(var u=0;u<l.length;u++){var c=l[u];c[4]&&(i[c[1]]=i[c[1]].toLowerCase())}return i.auth=i.password?i.username+":"+i.password:i.username,i.origin="file:"!==i.protocol&&d(i.protocol)&&i.host?i.protocol+"//"+i.host:"null",i.href=i.toString(),i},toString:function(e){e&&"function"==typeof e||(e=t.stringify);var n,r=this,o=r.host,i=r.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var a=i+(r.protocol&&r.slashes||d(r.protocol)?"//":"");return r.username?(a+=r.username,r.password&&(a+=":"+r.password),a+="@"):r.password?(a+=":"+r.password,a+="@"):"file:"!==r.protocol&&d(r.protocol)&&!o&&"/"!==r.pathname&&(a+="@"),(":"===o[o.length-1]||s.test(r.hostname)&&!r.port)&&(o+=":"),a+=o+r.pathname,(n="object"==typeof r.query?e(r.query):r.query)&&(a+="?"!==n.charAt(0)?"?"+n:n),r.hash&&(a+=r.hash),a}},f.extractProtocol=p,f.location=c,f.trimLeft=h,f.qs=t,Gt=f}(),en=v(Zt);!function(e){e[e.PushState=0]="PushState",e[e.ReplaceState=1]="ReplaceState",e[e.PopState=2]="PopState",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Reload=5]="Reload",e[e.Start=6]="Start",e[e.PathnameChange=7]="PathnameChange",e[e.Relaunch=8]="Relaunch",e[e.RedirectToHome=9]="RedirectToHome",e[e.HistoriesChange=10]="HistoriesChange"}(Xt||(Xt={}));class tn extends s{static prefix=null;static parse(e){const{pathname:t,query:n,...r}=en(e),o=Yt.parse(n,{ignoreQueryPrefix:!0});return tn.prefix&&t.startsWith(tn.prefix)?{...r,query:o,pathname:t.replace(tn.prefix,"")}:{...r,query:o,pathname:t}}unique_id="NavigatorCore";debug=!1;name="root";pathname="/";query={};params={};location={};href="/";histories=[];prevHistories=[];prevPathname=null;origin="";host="";_pending={pathname:"/",search:"",type:"initialize"};get state(){return{pathname:this.pathname,search:this._pending.search,params:this.params,query:this.query,location:this.location}}async prepare(e){const{host:t,pathname:n,href:r,search:o,origin:s}=e;let i=n;tn.prefix&&tn.prefix.match(/^\/[a-z0-9A-Z]{1,}/)&&(i=n.replace(tn.prefix,"")),this.setPathname(i),this.origin=s,this.host=t,this.location=e;const a=function(e){const[,t]=e.split("?");if(!t)return{};return Yt.parse(t)}(r);this.query=a,this._pending={pathname:i,search:o,type:"initialize"}}start(){const{pathname:e}=this._pending;this.setPathname(e),this.histories=[{pathname:e}],this.emit(Xt.PathnameChange,{...this._pending})}setPrevPathname(e){this.prevPathname=e}setPathname(e){this.pathname=e}pushState(e){const t=(tn.prefix+e).replace(/^\/\//,"/"),n=`${this.origin}${t}`,r=new URL(n),{pathname:o,search:s}=r,i=this.pathname;this.setPrevPathname(i),this.setPathname(o),this.histories.push({pathname:o}),this.emit(Xt.PushState,{from:i,to:o,path:o+s,pathname:o}),this.emit(Xt.HistoriesChange,[...this.histories])}async replaceState(e){const t=`${this.origin}${tn.prefix}${e}`,n=new URL(t),{pathname:r,search:o}=n;this.setPrevPathname(this.pathname),this.setPathname(r),this.histories[this.histories.length-1]={pathname:r},this.emit(Xt.ReplaceState,{from:this.prevPathname,path:r+o,pathname:r}),this.emit(Xt.HistoriesChange,[...this.histories])}handlePopState({type:e,pathname:t,href:n}){if(console.log("[DOMAIN]navigator/index - handlePopState",e,this.pathname,this.prevHistories),"popstate"!==e)return;const r=t,o=this.pathname;this.setPrevPathname(o),this.setPathname(r);const s=(()=>{if(0===this.prevHistories.length)return!1;const e=this.prevHistories[this.prevHistories.length-1];return e?.pathname===r})();if(this._pending={pathname:t,search:"",type:s?"forward":"back"},s){this.setPrevPathname(this.pathname),this.setPathname(r);const e=this.prevHistories.pop();return e&&(this.histories=this.histories.concat([e])),this.emit(Xt.Forward),this.emit(Xt.HistoriesChange,[...this.histories]),void this.emit(Xt.PopState,{type:"forward",pathname:t,href:n})}this.emit(Xt.Back);const i=this.histories[this.histories.length-1];this.prevHistories=this.prevHistories.concat([i]).filter(Boolean),this.setPrevPathname(this.pathname),this.setPathname(r),console.log("[DOMAIN]navigator - before pop",this.histories.map(e=>e.pathname));const a=this.histories.slice(0,this.histories.length-1);this.histories=a.filter(Boolean),this.emit(Xt.HistoriesChange,[...this.histories]),this.emit(Xt.PopState,{type:"back",pathname:t,href:n})}onStart(e){return this.on(Xt.Start,e)}onHistoryChange(e){return this.on(Xt.HistoriesChange,e)}onPushState(e){return this.on(Xt.PushState,e)}onReplaceState(e){return this.on(Xt.ReplaceState,e)}onPopState(e){return this.on(Xt.PopState,e)}onReload(e){return this.on(Xt.Reload,e)}onPathnameChange(e){return this.on(Xt.PathnameChange,e)}onBack(e){return this.on(Xt.Back,e)}onForward(e){return this.on(Xt.Forward,e)}onRelaunch(e){return this.on(Xt.Relaunch,e)}onHistoriesChange(e){return this.on(Xt.HistoriesChange,e)}}var nn,rn={exports:{}};function on(){return nn||(nn=1,function(e){e.exports=function(){var e=1e3,t=6e4,n=36e5,r="millisecond",o="second",s="minute",i="hour",a="day",h="week",l="month",u="quarter",c="year",d="date",p="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},y=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},S={s:y,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),o=n%60;return(t<=0?"+":"-")+y(r,2,"0")+":"+y(o,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),o=t.clone().add(r,l),s=n-o<0,i=t.clone().add(r+(s?-1:1),l);return+(-(r+(n-o)/(s?o-i:i-o))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:c,w:h,d:a,D:d,h:i,m:s,s:o,ms:r,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},C="en",v={};v[C]=m;var b="$isDayjsObject",w=function(e){return e instanceof T||!(!e||!e[b])},x=function e(t,n,r){var o;if(!t)return C;if("string"==typeof t){var s=t.toLowerCase();v[s]&&(o=s),n&&(v[s]=n,o=s);var i=t.split("-");if(!o&&i.length>1)return e(i[0])}else{var a=t.name;v[a]=t,o=a}return!r&&o&&(C=o),o||!r&&C},_=function(e,t){if(w(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new T(n)},k=S;k.l=x,k.i=w,k.w=function(e,t){return _(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var T=function(){function m(e){this.$L=x(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[b]=!0}var y=m.prototype;return y.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(k.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(f);if(r){var o=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],o,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],o,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(t)}(e),this.init()},y.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},y.$utils=function(){return k},y.isValid=function(){return!(this.$d.toString()===p)},y.isSame=function(e,t){var n=_(e);return this.startOf(t)<=n&&n<=this.endOf(t)},y.isAfter=function(e,t){return _(e)<this.startOf(t)},y.isBefore=function(e,t){return this.endOf(t)<_(e)},y.$g=function(e,t,n){return k.u(e)?this[t]:this.set(n,e)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(e,t){var n=this,r=!!k.u(t)||t,u=k.p(e),p=function(e,t){var o=k.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?o:o.endOf(a)},f=function(e,t){return k.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,m=this.$M,y=this.$D,S="set"+(this.$u?"UTC":"");switch(u){case c:return r?p(1,0):p(31,11);case l:return r?p(1,m):p(0,m+1);case h:var C=this.$locale().weekStart||0,v=(g<C?g+7:g)-C;return p(r?y-v:y+(6-v),m);case a:case d:return f(S+"Hours",0);case i:return f(S+"Minutes",1);case s:return f(S+"Seconds",2);case o:return f(S+"Milliseconds",3);default:return this.clone()}},y.endOf=function(e){return this.startOf(e,!1)},y.$set=function(e,t){var n,h=k.p(e),u="set"+(this.$u?"UTC":""),p=(n={},n[a]=u+"Date",n[d]=u+"Date",n[l]=u+"Month",n[c]=u+"FullYear",n[i]=u+"Hours",n[s]=u+"Minutes",n[o]=u+"Seconds",n[r]=u+"Milliseconds",n)[h],f=h===a?this.$D+(t-this.$W):t;if(h===l||h===c){var g=this.clone().set(d,1);g.$d[p](f),g.init(),this.$d=g.set(d,Math.min(this.$D,g.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},y.set=function(e,t){return this.clone().$set(e,t)},y.get=function(e){return this[k.p(e)]()},y.add=function(r,u){var d,p=this;r=Number(r);var f=k.p(u),g=function(e){var t=_(p);return k.w(t.date(t.date()+Math.round(e*r)),p)};if(f===l)return this.set(l,this.$M+r);if(f===c)return this.set(c,this.$y+r);if(f===a)return g(1);if(f===h)return g(7);var m=(d={},d[s]=t,d[i]=n,d[o]=e,d)[f]||1,y=this.$d.getTime()+r*m;return k.w(y,this)},y.subtract=function(e,t){return this.add(-1*e,t)},y.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var r=e||"YYYY-MM-DDTHH:mm:ssZ",o=k.z(this),s=this.$H,i=this.$m,a=this.$M,h=n.weekdays,l=n.months,u=n.meridiem,c=function(e,n,o,s){return e&&(e[n]||e(t,r))||o[n].slice(0,s)},d=function(e){return k.s(s%12||12,e,"0")},f=u||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(g,function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return k.s(t.$y,4,"0");case"M":return a+1;case"MM":return k.s(a+1,2,"0");case"MMM":return c(n.monthsShort,a,l,3);case"MMMM":return c(l,a);case"D":return t.$D;case"DD":return k.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return c(n.weekdaysMin,t.$W,h,2);case"ddd":return c(n.weekdaysShort,t.$W,h,3);case"dddd":return h[t.$W];case"H":return String(s);case"HH":return k.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return f(s,i,!0);case"A":return f(s,i,!1);case"m":return String(i);case"mm":return k.s(i,2,"0");case"s":return String(t.$s);case"ss":return k.s(t.$s,2,"0");case"SSS":return k.s(t.$ms,3,"0");case"Z":return o}return null}(e)||o.replace(":","")})},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(r,d,p){var f,g=this,m=k.p(d),y=_(r),S=(y.utcOffset()-this.utcOffset())*t,C=this-y,v=function(){return k.m(g,y)};switch(m){case c:f=v()/12;break;case l:f=v();break;case u:f=v()/3;break;case h:f=(C-S)/6048e5;break;case a:f=(C-S)/864e5;break;case i:f=C/n;break;case s:f=C/t;break;case o:f=C/e;break;default:f=C}return p?f:k.a(f)},y.daysInMonth=function(){return this.endOf(l).$D},y.$locale=function(){return v[this.$L]},y.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=x(e,t,!0);return r&&(n.$L=r),n},y.clone=function(){return k.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},m}(),O=T.prototype;return _.prototype=O,[["$ms",r],["$s",o],["$m",s],["$H",i],["$W",a],["$M",l],["$y",c],["$D",d]].forEach(function(e){O[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),_.extend=function(e,t){return e.$i||(e(t,T,_),e.$i=!0),_},_.locale=x,_.isDayjs=w,_.unix=function(e){return _(1e3*e)},_.en=v[C],_.Ls=v,_.p={},_}()}(rn)),rn.exports}var sn,an=v(on()),hn={exports:{}};sn||(sn=1,function(e){e.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e),r={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,t){return"W"===t?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,t){var n=100*e+t;return n<600?"凌晨":n<900?"早上":n<1100?"上午":n<1300?"中午":n<1800?"下午":"晚上"}};return n.default.locale(r,null,!0),r}(on())}(hn));var ln,un={exports:{}};var cn,dn=(ln||(ln=1,function(e){e.exports=function(e,t,n){e=e||{};var r=t.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function s(e,t,n,o){return r.fromToBase(e,t,n,o)}n.en.relativeTime=o,r.fromToBase=function(t,r,s,i,a){for(var h,l,u,c=s.$locale().relativeTime||o,d=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],p=d.length,f=0;f<p;f+=1){var g=d[f];g.d&&(h=i?n(t).diff(s,g.d,!0):s.diff(t,g.d,!0));var m=(e.rounding||Math.round)(Math.abs(h));if(u=h>0,m<=g.r||!g.r){m<=1&&f>0&&(g=d[f-1]);var y=c[g.l];a&&(m=a(""+m)),l="string"==typeof y?y.replace("%d",m):y(m,r,g.l,u);break}}if(r)return l;var S=u?c.future:c.past;return"function"==typeof S?S(l):S.replace("%s",l)},r.to=function(e,t){return s(e,t,this,!0)},r.from=function(e,t){return s(e,t,this)};var i=function(e){return e.$u?n.utc():n()};r.toNow=function(e){return this.to(i(this),e)},r.fromNow=function(e){return this.from(i(this),e)}}}(un)),un.exports),pn=v(dn);function fn(e){return 1===String(e).length?`0${e}`:String(e)}function gn(e,t){return-1===t?[...e]:[...e.slice(0,t),...e.slice(t+1)]}function mn(e){return null==e?"":Object.keys(e).filter(t=>void 0!==e[t]).map(t=>`${t}=${encodeURIComponent(e[t])}`).join("&")}function yn(e=1e3){return new Promise(t=>{setTimeout(()=>{t(null)},e)})}function Sn(e,t,n){const r=n&&0!==Object.keys(n).length?"?"+mn(n):"";return e.match(/:[a-z]{1,}/)&&t&&0!==Object.keys(t).length?e.replace(/:([a-z]{1,})/g,(...e)=>{const[,n]=e;return String(t[n]||"")})+r:e+r}function Cn(e,t=null){return Object.keys(e).map(n=>{const r=e[n],{title:o,pathname:s,options:i,children:a}=r,h=t?[t.name,n].filter(Boolean).join("."):n;if(a){const e=Cn(a,{name:h});return[{title:o,name:h,pathname:s,options:i,layout:!0,parent:t?{name:t.name}:null},...e]}return[{title:o,name:h,pathname:s,options:i,parent:t?{name:t.name}:null}]}).reduce((e,t)=>e.concat(t),[])}an.extend(pn),an.locale("zh-cn"),function(e){e[e.SubViewChanged=0]="SubViewChanged",e[e.SubViewRemoved=1]="SubViewRemoved",e[e.SubViewAppended=2]="SubViewAppended",e[e.SubViewsChange=3]="SubViewsChange",e[e.CurSubViewChange=4]="CurSubViewChange",e[e.ViewShow=5]="ViewShow",e[e.Ready=6]="Ready",e[e.Mounted=7]="Mounted",e[e.BeforeShow=8]="BeforeShow",e[e.Show=9]="Show",e[e.BeforeHide=10]="BeforeHide",e[e.Hidden=11]="Hidden",e[e.Unmounted=12]="Unmounted",e[e.Layered=13]="Layered",e[e.Uncover=14]="Uncover",e[e.Start=15]="Start",e[e.StateChange=16]="StateChange",e[e.Match=17]="Match",e[e.NotFound=18]="NotFound"}(cn||(cn={}));class vn extends s{unique_id="ViewCore";debug=!1;id=this.uid();name;pathname;title;animation={in:"fade-in",out:"fade-out"};query={};params={};_showed=!1;loaded=!1;mounted=!0;layered=!1;isRoot=!1;parent;curView=null;subViews=[];$presence=new m;get state(){return{mounted:this.mounted,visible:this.visible,layered:this.layered}}get href(){return[this.pathname,mn(this.query)].filter(Boolean).join("?")}get visible(){return this.$presence.visible}constructor(e){super(e);const{name:t,pathname:n,title:r,query:o={},visible:s=!1,animation:i={},parent:a=null,views:h=[]}=e;this.name=t,this.pathname=n,this.parent=a,this.title=r,this.unique_id=r,this.animation=i,this.subViews=h,h.length&&(this.curView=h[0]),this.query=o,s&&(this.mounted=!0);for(let e=0;e<h.length;e+=1){h[e].parent=this}this.$presence.onStateChange(e=>{const{visible:t,mounted:n}=e,r=this.state.visible;!1===r&&t&&this.setShow(),r&&!1===t&&this.setHidden(),this.mounted=!!n,this.emit(cn.StateChange,{...this.state})}),this.$presence.onUnmounted(()=>{this.emit(cn.Unmounted)}),function(e){if(!bn)return;bn(e)}(this)}appendView(e){e.parent=this,0===this.subViews.length&&e.visible&&(this.curView=e),this.subViews.includes(e)||(this.emit(cn.SubViewAppended,e),this.subViews.push(e)),this.emit(cn.SubViewsChange,[...this.subViews])}replaceViews(e){this.subViews=e,this.emit(cn.SubViewsChange,[...this.subViews])}removeView(e,t={}){this.subViews.includes(e)?(e.onUnmounted(()=>{e.destroy(),this.subViews=this.subViews.filter(t=>t!==e),t.callback&&t.callback(),this.emit(cn.SubViewRemoved,e),this.emit(cn.SubViewsChange,[...this.subViews])}),e.hide({reason:t.reason,destroy:t.destroy}),this.emit(cn.SubViewChanged,e),this.emit(cn.SubViewsChange,[...this.subViews])):console.warn("the view is not the child view")}findCurView(){return this.curView?this.curView.findCurView():this}ready(){this.emit(cn.Ready)}showView(e,t={}){e!==this?e.visible?console.warn("the sub view has been visible",e.name):((()=>{if(!this.visible){if(!this.parent)return void(this.isRoot||console.warn("no parent"));this.parent.showView(this,t)}})(),"show_sibling"===t.reason&&this.curView&&this.curView.hide(t),this.appendView(e),this.emit(cn.BeforeShow),this.curView=e,e.show(),this.emit(cn.CurSubViewChange,this.curView)):console.warn("cannot show self")}show(){this.visible?this.$presence.state.mounted=!0:this.$presence.show()}hide(e={}){if(!1!==this.visible){for(let t=0;t<this.subViews.length;t+=1){this.subViews[t].hide(e)}this.emit(cn.BeforeHide),this.$presence.hide({reason:e.reason,destroy:e.destroy})}else console.warn("has been hide")}setShow(){this._showed||(this._showed=!0,this.emit(cn.Show))}setHidden(){console.log("[DOMAIN]route_view/index - hidden",this.title,this._showed),this._showed=!1,this.emit(cn.Hidden)}mount(){this.setMounted()}unmount(){this.subViews=[],this.emit(cn.StateChange,{...this.state})}setMounted(){this.mounted||(this.mounted=!0,this.emit(cn.Mounted))}setUnmounted(){this.mounted=!1,this.emit(cn.Unmounted)}setLoaded(){this.loaded=!0}setUnload(){this.loaded=!1}buildUrl(e){return Sn(this.pathname,this.params,e)}buildUrlWithPrefix(e){const t=Sn(this.pathname,this.params,e);return[tn.prefix,t].join("")}onStart(e){return this.on(cn.Start,e)}onReady(e){return this.on(cn.Ready,e)}onMounted(e){return this.on(cn.Mounted,e)}onViewShow(e){return this.on(cn.ViewShow,e)}onBeforeShow(e){return this.on(cn.BeforeShow,e)}onShow(e){return this.on(cn.Show,e)}onBeforeHide(e){return this.on(cn.BeforeHide,e)}onHidden(e){return this.on(cn.Hidden,e)}onLayered(e){return this.on(cn.Layered,e)}onUncover(e){return this.on(cn.Uncover,e)}onUnmounted(e){return this.on(cn.Unmounted,e)}onSubViewChanged(e){return this.on(cn.SubViewChanged,e)}onSubViewAppended(e){return this.on(cn.SubViewAppended,e)}onSubViewRemoved(e){return this.on(cn.SubViewRemoved,e)}onSubViewsChange(e){return this.on(cn.SubViewsChange,e)}onCurViewChange(e){return this.on(cn.CurSubViewChange,e)}onMatched(e){return this.on(cn.Match,e)}onNotFound(e){return this.on(cn.NotFound,e)}onStateChange(e){return this.on(cn.StateChange,e)}}let bn=null;var wn,xn,_n,kn,Tn,On,Pn,En,Dn,Mn,Ln,An,Rn,In,Nn,$n,Fn,Bn,Hn,jn;!function(e){e[e.TopViewChange=0]="TopViewChange",e[e.RouteChange=1]="RouteChange",e[e.ClickLink=2]="ClickLink",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.StateChange=5]="StateChange"}(wn||(wn={}));!function(e){e[e.StateChange=0]="StateChange"}(xn||(xn={}));!function(e){e[e.StateChange=0]="StateChange"}(_n||(_n={}));class Vn extends s{value=null;get state(){return this.value}constructor(e={}){super(e);const{defaultValue:t,onChange:n}=e;t&&(this.value=t),n&&this.onStateChange(n)}select(e){this.value=e,this.emit(_n.StateChange,this.value)}patch(e){this.value={...this.value,...e},this.emit(_n.StateChange,this.value)}isEmpty(){return null===this.value}clear(){this.value=null,this.emit(_n.StateChange)}onStateChange(e){return this.on(_n.StateChange,e)}}!function(e){e[e.Click=0]="Click",e[e.StateChange=1]="StateChange"}(kn||(kn={}));class Un extends s{id=this.uid();cur;state={text:"Click it",loading:!1,disabled:!1};constructor(e={}){super(e),void 0!==e.disabled&&(this.state.disabled=e.disabled),this.cur=new Vn,e.onClick&&this.onClick(()=>{e.onClick?.(this.cur.value)})}click(){this.state.loading||this.state.disabled||this.emit(kn.Click)}disable(){this.state.disabled=!0,this.emit(kn.StateChange,{...this.state})}enable(){this.state.disabled=!1,this.emit(kn.StateChange,{...this.state})}bind(e){return this.cur.select(e),this}setLoading(e){this.state.loading!==e&&(this.state.loading=e,this.emit(kn.StateChange,{...this.state}))}onClick(e){this.on(kn.Click,e)}onStateChange(e){this.on(kn.StateChange,e)}}!function(e){e[e.StateChange=0]="StateChange",e[e.Change=1]="Change"}(Tn||(Tn={}));class qn extends s{shape="checkbox";label;disabled;checked;defaultChecked;presence;get state(){return{label:this.label,checked:this.checked,value:this.checked,disabled:this.disabled}}get value(){return this.state.value}get defaultValue(){return this.defaultChecked}prev_checked=!1;constructor(e={}){super(e);const{label:t="",disabled:n=!1,checked:r=!1,onChange:o}=e;this.label=t,this.disabled=n,this.checked=r,this.defaultChecked=r,this.presence=new m,o&&this.onChange(o)}toggle(){const e=this.checked;(()=>{e?this.presence.hide():this.presence.show()})(),this.checked=!0,e&&(this.checked=!1),this.prev_checked=e,this.emit(Tn.Change,this.checked),this.emit(Tn.StateChange,{...this.state})}check(){!0!==this.checked&&(this.presence.show(),this.prev_checked=this.checked,this.checked=!0,this.emit(Tn.StateChange,{...this.state}))}uncheck(){!1!==this.checked&&(this.presence.hide(),this.prev_checked=this.checked,this.checked=!1,this.emit(Tn.StateChange,{...this.state}))}reset(){this.checked=this.defaultChecked}setValue(e){this.checked=e}onChange(e){return this.on(Tn.Change,e)}onStateChange(e){return this.on(Tn.StateChange,e)}}!function(e){e[e.ReferenceMounted=0]="ReferenceMounted",e[e.FloatingMounted=1]="FloatingMounted",e[e.Placed=2]="Placed",e[e.Enter=3]="Enter",e[e.Leave=4]="Leave",e[e.StateChange=5]="StateChange",e[e.ContainerChange=6]="ContainerChange"}(On||(On={}));class Wn extends s{unique_id="PopperCore";debug=!0;placement="bottom";strategy="absolute";middleware=[];reference=null;floating=null;container=null;arrow=null;state={strategy:"absolute",x:0,y:0,isPlaced:!1,placedSide:"bottom",placedAlign:"center",reference:!1};_enter=!1;_focus=!1;constructor(e={}){super(e);const{_name:t,side:n="bottom",align:r="center",strategy:o="absolute",middleware:s=[]}=e;t&&(this.unique_id=t),this.strategy=o,this.placement=n+("center"!==r?"-"+r:"")}setReference(e,t={}){(null===this.reference||t.force)&&(this.reference=e,this.state.reference=!0,this.emit(On.ReferenceMounted,e),this.emit(On.StateChange,{...this.state}))}updateReference(e){this.reference=e}removeReference(){null!==this.reference&&(this.state.reference=!1,this.reference=null,this.emit(On.StateChange,{...this.state}))}setFloating(e){null!==e&&(this.floating=e,this.emit(On.FloatingMounted,e))}setArrow(e){this.arrow=e}setContainer(e){}setConfig(e){}setState(e){this.state.x=e.x,this.state.y=e.y,this.state.isPlaced=!0,this.emit(On.StateChange,{...this.state})}place2(e){const t=this.reference;if(!t)return;const n=t.getRect(),{clientHeight:r,clientWidth:o}=window.document.documentElement,s={x:n.x,y:n.y+n.height+4};r-s.y<e.height+24&&(s.y=n.y-e.height-4),o-s.x<e.width+24&&(s.x=n.x+n.width-e.width-4),s.y<=0&&(s.y=12),this.setState(s)}async place(){if(this.middleware=[],null===this.reference||null===this.floating)return;const e=await this.computePosition(),{x:t,y:n,middlewareData:r}=e,[o,s]=function(e){const[t,n="center"]=e.split("-");return[t,n]}(this.placement);this.state={x:t,y:n,strategy:this.strategy,isPlaced:!0,placedSide:o,placedAlign:s,reference:!0},this.emit(On.StateChange,{...this.state})}async computePosition(){const{placement:e,strategy:t}=this;let n=e;const r=this.reference.getRect(),o=this.floating.getRect(),s={reference:r,floating:o};let{x:i,y:a}=this.computeCoordsFromPlacement(s,e,!0),h={};for(let l=0;l<this.middleware.length;l++){const{name:u,fn:c}=this.middleware[l],{x:d,y:p,data:f,reset:g}=await c({x:i,y:a,initialPlacement:e,placement:n,strategy:t,middlewareData:h,rects:s,elements:{reference:r,floating:o}});i=d??i,a=p??a,h={...h,[u]:{...h[u],...f}}}return{x:i,y:a,placement:n,strategy:t,middlewareData:h}}computeCoordsFromPlacement(e,t,n){const{reference:r,floating:o}=e;console.log("computeCoordsFromPlacement",r,o);const s=r.x+r.width/2-o.width/2,i=r.y+r.height/2-o.height/2,a=function(e){return["top","bottom"].includes(zn(e))?"x":"y"}(t),h="y"===a?"height":"width";const l=r[h]/2-o[h]/2,u="x"===a;let c;switch(zn(t)){case"top":c={x:s,y:r.y-o.height};break;case"bottom":c={x:s,y:r.y+r.height};break;case"right":c={x:r.x+r.width,y:i};break;case"left":c={x:r.x-o.width,y:i};break;default:c={x:r.x,y:r.y}}switch(function(e){return e.split("-")[1]}(t)){case"start":c[a]-=l*(n&&u?-1:1);break;case"end":c[a]+=l*(n&&u?-1:1)}return c}handleEnter(){!0!==this._enter&&(this._enter=!0,this.emit(On.Enter))}handleLeave(){!1!==this._enter&&(this._enter=!1,this.emit(On.Leave))}reset(){this._enter=!1,this._focus=!1}onReferenceMounted(e){return this.on(On.ReferenceMounted,e)}onFloatingMounted(e){return this.on(On.FloatingMounted,e)}onContainerChange(e){return this.on(On.ContainerChange,e)}onEnter(e){return this.on(On.Enter,e)}onLeave(e){return this.on(On.Leave,e)}onPlaced(e){return this.on(On.Placed,e)}onStateChange(e){return this.on(On.StateChange,e)}get[Symbol.toStringTag](){return"PopperCore"}}function zn(e){return e.split("-")[0]}!function(e){e[e.Dismiss=0]="Dismiss",e[e.FocusOutside=1]="FocusOutside",e[e.PointerDownOutside=2]="PointerDownOutside",e[e.InteractOutside=3]="InteractOutside"}(Pn||(Pn={}));class Yn extends s{name="DismissableLayerCore";layers=new Set;layersWithOutsidePointerEventsDisabled=new Set;branches=new Set;isPointerInside=!1;state={};constructor(e={}){super(e)}handlePointerOutside(e){}pointerDown(){this.isPointerInside=!0}handlePointerDownOnTop(e){!0!==this.isPointerInside?(this.emit(Pn.PointerDownOutside),this.emit(Pn.InteractOutside),this.emit(Pn.Dismiss)):this.isPointerInside=!1}onDismiss(e){return this.on(Pn.Dismiss,e)}}!function(e){e[e.Show=0]="Show",e[e.Hidden=1]="Hidden",e[e.EnterItem=2]="EnterItem",e[e.LeaveItem=3]="LeaveItem",e[e.EnterMenu=4]="EnterMenu",e[e.LeaveMenu=5]="LeaveMenu",e[e.StateChange=6]="StateChange"}(En||(En={}));class Kn extends s{_name="MenuCore";debug=!1;popper;presence;layer;open_timer=null;state={open:!1,hover:!1,items:[]};constructor(e={}){super(e);const{_name:t,items:n=[],side:r,align:o,strategy:s}=e;t&&(this._name=t),this.state.items=n,this.items=n,this.popper=new Wn({side:r,align:o,strategy:s,_name:t?`${t}__popper`:"menu__popper"}),this.presence=new m,this.layer=new Yn,this.listen_items(n),this.popper.onEnter(()=>{this.state.hover=!0,this.emit(En.EnterMenu)}),this.popper.onLeave(()=>{this.state.hover=!1,this.emit(En.LeaveMenu)}),this.layer.onDismiss(()=>{this.hide()}),this.presence.onHidden(()=>{this.reset(),this.cur_item&&this.cur_item.blur(),this.cur_sub&&this.cur_sub.hide()})}items=[];cur_sub=null;cur_item=null;inside=!1;in_sub_menu=!1;maybe_hide_sub=!1;hide_sub_timer=null;toggle(){const{open:e}=this.state;console.log("[DOMAIN]ui/dropdown-menu - toggle",e),e?this.hide():this.show()}show(){this.state.open||(this.state.open=!0,this.presence.show(),this.popper.place(),this.emit(En.Show),this.emit(En.StateChange,{...this.state}))}hide(){!1!==this.state.open&&(this.state.open=!1,this.presence.hide(),this.emit(En.Hidden),this.emit(En.StateChange,{...this.state}))}listen_item(e){e.onEnter(()=>{console.log("[DOMAIN]ui/menu/index - item.onEnter",e.label,e.menu,this.cur_item?.label),this.emit(En.EnterItem,e),e.menu&&e.menu.show(),this.cur_item&&this.cur_item!==e&&(this.cur_item.blur(),this.cur_item.menu&&this.cur_item.menu.hide()),this.cur_item=e}),e.onLeave(()=>{if(console.log("[DOMAIN]ui/menu/index - item.onLeave",e.label,{open:e._open,focused:e._focused},e.menu?.state),this.emit(En.LeaveItem,e),e.blur(),e.menu){let t=setTimeout(()=>{e.menu.hide()},0);return void e.menu.onEnter(()=>{console.log("[DOMAIN]ui/menu/index - item.menu.onEnter"),t&&clearTimeout(t)})}}),e.menu&&e.menu}listen_items(e){for(let t=0;t<e.length;t+=1)this.listen_item(e[t])}setItems(e){console.log("[DOMAIN]ui/menu - set items",e),this.state.items=e,this.items=e,this.listen_items(e),this.emit(En.StateChange,{...this.state})}checkNeedHideSubMenu(e){}reset(){this.in_sub_menu=!1,this.cur_sub=null,this.maybe_hide_sub=!1,this.hide_sub_timer=null,this.state.open=!1,this.presence.reset(),this.popper.reset();for(let e=0;e<this.items.length;e+=1)this.items[e].reset()}unmount(){super.destroy(),this.layer.destroy(),this.popper.destroy(),this.presence.unmount();for(let e=0;e<this.items.length;e+=1)this.items[e].unmount();this.reset()}onShow(e){return this.on(En.Show,e)}onHide(e){return this.on(En.Hidden,e)}onEnterItem(e){return this.on(En.EnterItem,e)}onLeaveItem(e){return this.on(En.LeaveItem,e)}onEnter(e){return this.on(En.EnterMenu,e)}onLeave(e){return this.on(En.LeaveMenu,e)}onStateChange(e){return this.on(En.StateChange,e)}get[Symbol.toStringTag](){return"Menu"}}!function(e){e[e.StateChange=0]="StateChange",e[e.Show=1]="Show",e[e.Hidden=2]="Hidden"}(Dn||(Dn={}));!function(e){e[e.BeforeShow=0]="BeforeShow",e[e.Show=1]="Show",e[e.BeforeHidden=2]="BeforeHidden",e[e.Hidden=3]="Hidden",e[e.Unmounted=4]="Unmounted",e[e.VisibleChange=5]="VisibleChange",e[e.Cancel=6]="Cancel",e[e.OK=7]="OK",e[e.AnimationStart=8]="AnimationStart",e[e.AnimationEnd=9]="AnimationEnd",e[e.StateChange=10]="StateChange"}(Mn||(Mn={}));class Gn extends s{open=!1;title="";footer=!0;closeable=!0;mask=!0;present=new m;okBtn=new Un;cancelBtn=new Un;get state(){return{open:this.open,title:this.title,footer:this.footer,closeable:this.closeable,mask:this.mask,enter:this.present.state.enter,visible:this.present.state.visible,exit:this.present.state.exit}}constructor(e={}){super(e);const{title:t,footer:n=!0,open:r=!1,mask:o=!0,closeable:s=!0,onOk:i,onCancel:a,onUnmounted:h}=e;t&&(this.title=t),this.footer=n,this.closeable=s,this.mask=o,this.open=r,r&&this.present.show(),i&&this.onOk(i),a&&this.onCancel(a),h&&this.onUnmounted(h),this.present.onShow(async()=>{this.open=!0,this.emit(Mn.VisibleChange,!0),this.emit(Mn.Show),this.emit(Mn.StateChange,{...this.state})}),this.present.onHidden(async()=>{this.open=!1,this.emit(Mn.Cancel),this.emit(Mn.Hidden),this.emit(Mn.VisibleChange,!1),this.emit(Mn.StateChange,{...this.state})}),this.present.onUnmounted(()=>{this.emit(Mn.Unmounted)}),this.present.onStateChange(()=>{this.emit(Mn.StateChange,{...this.state})}),this.okBtn.onClick(()=>{this.ok()}),this.cancelBtn.onClick(()=>{this.hide()})}toggle(){this.open?this.present.hide():this.present.show()}show(){this.open||this.present.show()}hide(e={}){this.present.hide(e)}ok(){this.emit(Mn.OK)}cancel(){this.emit(Mn.Cancel)}setTitle(e){this.title=e,this.emit(Mn.StateChange,{...this.state})}onShow(e){return this.on(Mn.Show,e)}onHidden(e){return this.on(Mn.Hidden,e)}onUnmounted(e){return this.on(Mn.Unmounted,e)}onVisibleChange(e){return this.on(Mn.VisibleChange,e)}onOk(e){return this.on(Mn.OK,e)}onCancel(e){return this.on(Mn.Cancel,e)}onStateChange(e){return this.on(Mn.StateChange,e)}get[Symbol.toStringTag](){return"Dialog"}}!function(e){e[e.StateChange=0]="StateChange"}(Ln||(Ln={}));!function(e){e[e.StateChange=0]="StateChange",e[e.Focusin=1]="Focusin",e[e.Focusout=2]="Focusout"}(An||(An={}));!function(e){e[e.Change=0]="Change",e[e.StateChange=1]="StateChange"}(Rn||(Rn={}));!function(e){e[e.Change=0]="Change",e[e.StateChange=1]="StateChange"}(In||(In={}));!function(e){e[e.Change=0]="Change",e[e.StateChange=1]="StateChange"}(Nn||(Nn={}));!function(e){e[e.StateChange=0]="StateChange",e[e.StartLoad=1]="StartLoad",e[e.Loaded=2]="Loaded",e[e.Error=3]="Error"}($n||($n={})),function(e){e[e.Pending=0]="Pending",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Failed=3]="Failed"}(Fn||(Fn={}));class Qn extends s{static prefix="";static url(e){return e?e.includes("http")||e.startsWith("data:image")?e:Qn.prefix+e:""}unique_uid;src;width;height;scale=null;fit;step=Fn.Pending;realSrc;get state(){return{src:this.src,step:this.step,width:this.width,height:this.height,scale:this.scale}}constructor(e){super();const{unique_id:t,width:n=200,height:r=200,src:o,scale:s,fit:i="cover"}=e;this.width=n,this.height=r,this.src="",this.fit=i,this.realSrc=o,s&&(this.scale=s),t&&(this.unique_uid=t)}setURL(e){if(e){if(this.realSrc&&e!==this.realSrc)return this.realSrc=e,void this.handleShow();this.realSrc=e,this.step===Fn.Loaded&&(this.src=Qn.url(this.realSrc),this.emit($n.StateChange,{...this.state}))}}setLoaded(){this.step=Fn.Loaded,this.emit($n.Loaded),this.emit($n.StateChange,{...this.state})}handleShow(){if(!this.realSrc)return this.step=Fn.Failed,void this.emit($n.StateChange,{...this.state});this.step=Fn.Loading,this.src=Qn.url(this.realSrc),this.emit($n.StateChange,{...this.state})}handleLoaded(){this.setLoaded()}handleError(){this.step=Fn.Failed,this.emit($n.StateChange,{...this.state}),this.emit($n.Error)}onStateChange(e){return this.on($n.StateChange,e)}onStartLoad(e){return this.on($n.StartLoad,e)}onLoad(e){return this.on($n.Loaded,e)}onError(e){return this.on($n.Error,e)}}!function(e){e[e.Change=10]="Change",e[e.StateChange=11]="StateChange",e[e.Mounted=12]="Mounted",e[e.Focus=13]="Focus",e[e.Blur=14]="Blur",e[e.Enter=15]="Enter",e[e.KeyDown=16]="KeyDown",e[e.Clear=17]="Clear",e[e.Click=18]="Click"}(Bn||(Bn={}));class Jn extends s{shape="input";defaultValue;value;placeholder;disabled;allowClear=!0;autoComplete=!1;autoFocus=!1;ignoreEnterEvent=!1;isFocus=!1;type;loading=!1;valueUsed;tmpType="";get state(){return{value:this.value,placeholder:this.placeholder,disabled:this.disabled,focus:this.isFocus,loading:this.loading,type:this.type,tmpType:this.tmpType,autoComplete:this.autoComplete,autoFocus:this.autoFocus,allowClear:this.allowClear}}constructor(e){super(e);const{unique_id:t,defaultValue:n,placeholder:r="请输入",type:o="string",disabled:s=!1,autoFocus:i=!1,autoComplete:a=!1,ignoreEnterEvent:h=!1,onChange:l,onBlur:u,onEnter:c,onClear:d,onMounted:p}=e;t&&(this.unique_id=t),this.placeholder=r,this.type=o,this.disabled=s,this.autoComplete=a,this.ignoreEnterEvent=h,this.autoFocus=i,this.defaultValue=n,this.value=n,l&&this.onChange(l),c&&this.onEnter(()=>{c(this.value)}),e.onKeyDown&&this.onKeyDown(e.onKeyDown),u&&this.onBlur(u),d&&this.onClear(d),p&&this.onMounted(p)}setMounted(){this.emit(Bn.Mounted)}handleKeyDown(e){this.ignoreEnterEvent||"Enter"!==e.key?this.emit(Bn.KeyDown,e):this.handleEnter()}handleEnter(){this.valueUsed=this.value,this.emit(Bn.Enter,this.value)}handleFocus(){this.isFocus=!0}handleBlur(){this.value!==this.valueUsed&&(this.valueUsed=this.value,this.emit(Bn.Blur,this.value))}handleClick(e){this.emit(Bn.Click,e)}handleChange(e){if("file"===this.type){const{target:t}=e,{files:n}=t;return void this.setValue(n)}const{target:t}=e,{value:n}=t;this.setValue(n)}setValue(e,t={}){this.value=e,"number"===this.type&&(this.value=Number(e)),t.silence||(this.emit(Bn.Change,e),this.emit(Bn.StateChange,{...this.state}))}setPlaceholder(e){this.placeholder=e,this.emit(Bn.StateChange,{...this.state})}setLoading(e){this.loading=e,this.emit(Bn.StateChange,{...this.state})}setFocus(){this.isFocus=!0,this.emit(Bn.StateChange,{...this.state})}focus(){console.log("请在 connect 中实现 focus 方法")}enable(){this.disabled=!0,this.emit(Bn.StateChange,{...this.state})}disable(){this.disabled=!1,this.emit(Bn.StateChange,{...this.state})}showText(){this.tmpType="text",this.emit(Bn.StateChange,{...this.state})}hideText(){this.tmpType="",this.emit(Bn.StateChange,{...this.state})}clear(){this.value=this.defaultValue,this.emit(Bn.Clear),this.emit(Bn.StateChange,{...this.state})}reset(){this.value=this.defaultValue,this.emit(Bn.StateChange,{...this.state})}enter(){this.emit(Bn.Enter)}onChange(e){return this.on(Bn.Change,e)}onStateChange(e){return this.on(Bn.StateChange,e)}onMounted(e){return this.on(Bn.Mounted,e)}onFocus(e){return this.on(Bn.Focus,e)}onBlur(e){return this.on(Bn.Blur,e)}onKeyDown(e){return this.on(Bn.KeyDown,e)}onEnter(e){return this.on(Bn.Enter,e)}onClick(e){return this.on(Bn.Click,e)}onClear(e){return this.on(Bn.Clear,e)}}!function(e){e[e.Click=0]="Click",e[e.ContextMenu=1]="ContextMenu",e[e.Mounted=2]="Mounted",e[e.EnterViewport=3]="EnterViewport"}(Hn||(Hn={}));!function(e){e[e.Show=0]="Show",e[e.Hidden=1]="Hidden",e[e.StateChange=2]="StateChange"}(jn||(jn={}));class Xn extends s{popper;present;layer;_side;_align;_closeable;visible=!1;enter=!1;exit=!1;get state(){return{isPlaced:this.popper.state.isPlaced,closeable:this._closeable,x:this.popper.state.x,y:this.popper.state.y,enter:this.present.state.enter,visible:this.present.state.visible,exit:this.present.state.exit}}constructor(e={}){super();const{side:t="bottom",align:n="end",strategy:r,closeable:o=!0}=e;this._side=t,this._align=n,this._closeable=o,this.popper=new Wn({side:t,align:n,strategy:r}),this.present=new m,this.layer=new Yn,this.layer.onDismiss(()=>{console.log("[DOMAIN/ui]popover/index - onDismiss"),this.hide()}),this.present.onStateChange(()=>{this.emit(jn.StateChange,{...this.state})}),this.popper.onStateChange(()=>{this.emit(jn.StateChange,{...this.state})})}ready(){}destroy(){}toggle(e){console.log("[DOMAIN/ui]popover/index - toggle");const{visible:t}=this;if(t)this.hide();else{if(e){const{x:t,y:n,width:r=8,height:o=8}=e;this.popper.updateReference({getRect:()=>({width:r,height:o,x:t,y:n})})}this.show()}}show(e){console.log(this.popper.reference?.getRect()),e&&this.popper.updateReference({getRect(){const{x:t=0,y:n=0,width:r=0,height:o=0,left:s=0,top:i=0,right:a=0,bottom:h=0}=e;return{width:r,height:o,x:t,y:n,left:s,top:i,right:a,bottom:h}}}),this.visible=!0,this.present.show(),this.popper.place(),this.emit(jn.Show)}hide(){!1!==this.visible&&(this.visible=!1,this.present.hide(),this.emit(jn.Hidden))}unmount(){super.destroy(),this.layer.destroy(),this.popper.destroy(),this.present.unmount()}onShow(e){return this.on(jn.Show,e)}onHide(e){return this.on(jn.Hidden,e)}onStateChange(e){return this.on(jn.StateChange,e)}get[Symbol.toStringTag](){return"PopoverCore"}}var Zn,er;!function(e){e[e.ValueChange=0]="ValueChange",e[e.StateChange=1]="StateChange"}(Zn||(Zn={}));function tr(e,t){return`${Math.round(e/t*100)}%`}function nr(e){return"number"==typeof e}class rr extends s{itemMap=new Map;setWrap(e){}add(e,t){this.itemMap.set(e,t)}remove(e){this.itemMap.delete(e)}getItems(){return Array.from(this.itemMap.values())}}!function(e){e[e.ItemFocus=0]="ItemFocus",e[e.ItemShiftTab=1]="ItemShiftTab",e[e.FocusableItemAdd=2]="FocusableItemAdd",e[e.FocusableItemRemove=3]="FocusableItemRemove",e[e.StateChange=4]="StateChange"}(er||(er={}));class or extends s{collection;state={currentTabStopId:null,orientation:"horizontal",dir:"ltr"};constructor(e={}){super(e);const{_name:t}=e;this.collection=new rr}focusItem(e){this.emit(er.ItemFocus,e)}shiftTab(){this.emit(er.ItemShiftTab)}addFocusableItem(){this.emit(er.FocusableItemAdd)}removeFocusableItem(){this.emit(er.FocusableItemRemove)}onStateChange(e){this.on(er.StateChange,e)}onItemFocus(e){this.on(er.ItemFocus,e)}onItemShiftTab(e){this.on(er.ItemShiftTab,e)}onFocusableItemAdd(e){this.on(er.FocusableItemAdd,e)}onFocusableItemRemove(e){this.on(er.FocusableItemRemove,e)}}function sr(e){return e.touches?{x:e.touches[0].pageX,y:e.touches[0].pageY}:e.clientX&&e.clientY?{x:e.clientX,y:e.clientY}:{x:0,y:0}}function ir(e){e&&e.cancelable&&!e.defaultPrevented&&e.preventDefault&&e.preventDefault()}function ar(e,t){let n=Math.abs(e);return n=.82231*t/(1+4338.47/Math.pow(n,1.14791)),Math.round(e<0?-n:n)}function hr(e,t){const n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),o=Math.sqrt(n*n+r*r);if(0!==o){return Math.asin(r/o)/Math.PI*180}return 0}let lr=null;var ur,cr,dr,pr,fr;!function(e){e[e.InDownOffset=0]="InDownOffset",e[e.OutDownOffset=1]="OutDownOffset",e[e.Pulling=2]="Pulling",e[e.PullToRefresh=3]="PullToRefresh",e[e.PullToRefreshFinished=4]="PullToRefreshFinished",e[e.InUpOffset=5]="InUpOffset",e[e.OutUpOffset=6]="OutUpOffset",e[e.Scrolling=7]="Scrolling",e[e.ReachBottom=8]="ReachBottom",e[e.Mounted=9]="Mounted"}(ur||(ur={}));class gr extends s{os={android:!0,ios:!1,pc:!1,wechat:!1};rect={width:0,height:0,scrollTop:0,contentHeight:0};disabled=!1;canPullToRefresh;canReachBottom=!0;needHideIndicator=!1;scrollable=!0;pullToRefresh={step:"pending",pullStartX:0,pullStartY:0,pullMoveX:0,pullMoveY:0,distX:0,distY:0,distResisted:0};threshold=120;options;pullToRefreshOptions;isPullToRefreshing=!1;isLoadingMore=!1;startPoint=null;lastPoint={x:0,y:0};downHight=0;upHight=0;maxTouchMoveInstanceY=0;inTouchEnd=!1;inTopWhenPointDown=!1;inBottomWhenPointDown=!1;isMoveDown=!1;isMoveUp=!1;isScrollTo=!1;movetype="pending";preScrollY=0;isUpAutoLoad=!1;get state(){return{top:0,left:0,step:this.movetype,scrollTop:this.downHight,pullToRefresh:this.canPullToRefresh,scrollable:this.scrollable}}constructor(e={}){super(e);const{os:t,offset:n=80,disabled:r=!1,onScroll:o,onReachBottom:s,onPullToRefresh:i,onPullToBack:a}=e;this.options=e,this.disabled=r,t&&(this.os=t),this.pullToRefreshOptions={isLock:!1,offset:n,bottomOffset:20,minAngle:45},this.canPullToRefresh=!!i,this.canPullToRefresh||(this.needHideIndicator=!0),this.needHideIndicator&&(this.pullToRefreshOptions.offset=9999),o&&this.onScroll(o),s&&this.onReachBottom(s),i&&this.onPullToRefresh(i),lr&&lr(this)}setReady(){this.emit(ur.Mounted)}setRect(e){this.rect={...this.rect,...e}}startPullToRefresh=()=>{this.isPullToRefreshing||(this.isPullToRefreshing=!0,this.downHight=this.pullToRefreshOptions.offset,this.setIndicatorHeightTransition(!0),this.changeIndicatorHeight(this.downHight),this.emit(ur.PullToRefresh))};finishPullToRefresh=()=>{this.isPullToRefreshing&&(this.downHight=0,this.changeIndicatorHeight(0),this.isPullToRefreshing=!1,this.emit(ur.PullToRefreshFinished))};disablePullToRefresh=()=>{this.pullToRefreshOptions.isLock=!0};enablePullToRefresh=()=>{this.pullToRefreshOptions.isLock=!1};handleMouseDown=e=>{this.handlePointDown(e)};handleMouseMove=e=>{this.handlePointMove(e)};handleTouchStart=e=>{this.handlePointDown(e)};handleTouchMove=e=>{this.handlePointMove(e)};handlePointDown=e=>{this.isScrollTo&&ir(e);const t=sr(e);if(t.x<30)return this.startPoint=null,void ir(e);this.startPoint=t,this.lastPoint=this.startPoint,this.maxTouchMoveInstanceY=this.getBodyHeight()-this.pullToRefreshOptions.bottomOffset,this.inTouchEnd=!1;const n=this.getScrollTop();this.inTopWhenPointDown=0===n};handlePointMove=e=>{if(!this.startPoint)return;const t=this.getScrollTop();t>0&&(this.inTopWhenPointDown=!1);const n=sr(e),r=n.y-this.startPoint.y;if(r>0&&t<=0&&(ir(e),this.canPullToRefresh&&!this.inTouchEnd&&!this.isPullToRefreshing)){if(!this.inTopWhenPointDown)return;const e=hr(this.lastPoint,n);if(e&&e<this.pullToRefreshOptions.minAngle)return;if(this.maxTouchMoveInstanceY>0&&n.y>=this.maxTouchMoveInstanceY)return this.inTouchEnd=!0,void this.handleTouchEnd();this.downHight<this.pullToRefreshOptions.offset?"pulling"!==this.movetype&&("pending"===this.movetype&&(this.setIndicatorHeightTransition(!1),this.os.ios&&!this.inTopWhenPointDown&&this.optimizeScroll(!0)),this.movetype,this.movetype="pulling",this.emit(ur.InDownOffset),this.isMoveDown=!0):"releasing"!==this.movetype&&(this.movetype="releasing",this.emit(ur.OutDownOffset),this.isMoveDown=!0),this.downHight=ar(n.y-this.startPoint.y,1e3),this.changeIndicatorHeight(this.downHight),this.emit(ur.Pulling,{instance:this.downHight})}if(r<0){this.getScrollHeight()-this.getScrollClientHeight()-t<=0&&ir(e)}this.lastPoint=n};handleTouchEnd=()=>{this.canPullToRefresh&&this.isMoveDown&&(this.downHight>=this.pullToRefreshOptions.offset?this.startPullToRefresh():(this.downHight=0,this.setIndicatorHeightTransition(!0),this.changeIndicatorHeight(0)),this.optimizeScroll(!1),this.movetype="pending",this.isMoveDown=!1)};handleScrolling=()=>{const e=this.getScrollTop(),t=e-this.preScrollY>0;if(!this.isLoadingMore){this.getScrollHeight()-this.getScrollClientHeight()-e<=this.threshold&&t&&(this.isLoadingMore=!0,this.emit(ur.ReachBottom))}this.emit(ur.Scrolling,{scrollTop:e})};finishLoadingMore(){this.isLoadingMore=!1}setMounted(){this.emit(ur.Mounted)}refreshRect(){console.log("请在 connect 中实现 refreshRect 方法")}setBounce=e=>{console.log("请在 connect 中实现 setBounce 方法")};changeIndicatorHeight(e){console.log("请在 connect 中实现 changeDownIndicatorHeight 方法")}setIndicatorHeightTransition(e){console.log("请在 connect 中实现 addDownIndicatorHeightTransition 方法")}optimizeScroll(e){console.log("请在 connect 中实现 optimizeScroll 方法")}hideIndicator=()=>{console.log("请在 connect 中实现 hideIndicator 方法")};scrollTo=(e,t=300)=>{console.log("请在 connect 中实现 scrollTo 方法")};getToBottom(){return this.getScrollHeight()-this.getScrollClientHeight()-this.getScrollTop()}getOffsetTop(e){return console.log("请在 connect 中实现 getScrollHeight 方法"),0}getScrollHeight(){return console.log("请在 connect 中实现 getScrollHeight 方法"),0}getScrollClientHeight(){return console.log("请在 connect 中实现 getClientHeight 方法"),0}getScrollTop(){return console.log("请在 connect 中实现 getScrollTop 方法"),0}addScrollTop(e){this.setScrollTop(this.getScrollTop()+e)}setScrollTop(e){console.log("请在 connect 中实现 setScrollTop 方法")}getBodyHeight(){return console.log("请在 connect 中实现 getBodyHeight 方法"),0}destroy=()=>{console.error("请在 connect 中实现 destroy 方法")};inDownOffset(e){return this.on(ur.InDownOffset,e)}outDownOffset(e){return this.on(ur.OutDownOffset,e)}onPulling(e){return this.on(ur.Pulling,e)}onScroll(e){return this.on(ur.Scrolling,e)}onReachBottom(e){return this.on(ur.ReachBottom,e)}onPullToRefresh(e){return this.canPullToRefresh=!0,this.on(ur.PullToRefresh,e)}onMounted(e){return this.on(ur.Mounted,e)}}!function(e){e[e.StateChange=0]="StateChange",e[e.Change=1]="Change",e[e.Focus=2]="Focus",e[e.Placed=3]="Placed"}(cr||(cr={}));class mr extends s{shape="select";name="SelectCore";debug=!0;placeholder;options=[];defaultValue=null;value=null;disabled=!1;open=!1;popper;popover;presence=new m;collection;layer;position="popper";triggerPos={x:0,y:0};reference=null;trigger=null;wrap=null;content=null;viewport=null;selectedItem=null;_findFirstValidItem=!1;get state(){return{options:this.options,value:this.value,value2:this.options.find(e=>e.value===this.value)??null,open:this.open,disabled:this.disabled,placeholder:this.placeholder,required:!1,dir:"ltr",styles:{},enter:this.presence.state.enter,visible:this.presence.state.visible,exit:this.presence.state.exit}}constructor(e){super(e);const{defaultValue:t,placeholder:n="点击选择",options:r=[],onChange:o}=e;this.options=r.map(e=>({label:e.label,value:e.value,selected:e.value===t})),this.value=t,this.defaultValue=t,this.placeholder=n;this.options.find(e=>e.value===t)&&(this.emit(cr.StateChange,{...this.state}),this.emit(cr.Change,t)),this.popper=new Wn,this.popover=new Xn,this.layer=new Yn,this.collection=new rr,this.popper.onReferenceMounted(e=>{const{x:t,y:n,width:r,height:o}=e.getRect();this.reference={width:r,height:o,x:t,y:n,left:t,right:t+r,top:n,bottom:n+o}}),this.layer.onDismiss(()=>{console.log(...this.log("this.layer.onDismiss")),this.hide()}),this.presence.onStateChange(()=>this.emit(cr.StateChange,{...this.state})),o&&this.onChange(o)}mapViewModelWithIndex(e){return this.options[e]}setTriggerPointerDownPos(e){this.triggerPos=e}setTrigger(e){this.trigger=e}setWrap(e){this.wrap=e}setContent(e){this.content=e}setViewport(e){this.viewport=e}setSelectedItem(e){this.selectedItem=e}async show(){this.disabled||(this.popper.place(),this.open=!0,this.emit(cr.StateChange,{...this.state}))}hide(){this.presence.hide(),!1!==this.open&&(this.open=!1,this.emit(cr.StateChange,{...this.state}))}addNativeOption(){}removeNativeOption(){}select(e){if(this.value!==e){this.value=e;for(let t=0;t<this.options.length;t+=1){const n=this.options[t];n.selected=!1,n.value===e&&(n.selected=!0)}this.emit(cr.Change,e),this.emit(cr.StateChange,{...this.state}),this.hide()}}focus(){this.emit(cr.Focus)}setOptions(e){if(this.options=e.map(e=>({label:e.label,value:e.value,selected:e.value===this.value})),null===this.value)return;this.options.find(e=>e.value===this.value)||(this.value=null,this.emit(cr.StateChange,{...this.state}),this.emit(cr.Change,this.value))}setValue(e){if(null===e)return this.value=null,this.emit(cr.StateChange,{...this.state}),void this.emit(cr.Change,e);this.value=e,this.options=this.options.map(e=>({label:e.label,value:e.value,selected:e.value===this.value})),this.emit(cr.Change,e),this.emit(cr.StateChange,{...this.state})}clear(){this.value=null,this.emit(cr.StateChange,{...this.state}),this.emit(cr.Change,this.value)}setPosition(){}onStateChange(e){return this.on(cr.StateChange,e)}onValueChange(e){return this.on(cr.Change,e)}onChange(e){return this.on(cr.Change,e)}onFocus(e){return this.on(cr.Focus,e)}}!function(e){e[e.StateChange=0]="StateChange",e[e.ValueChange=1]="ValueChange"}(dr||(dr={}));!function(e){e[e.BeforeShow=0]="BeforeShow",e[e.Show=1]="Show",e[e.BeforeHidden=2]="BeforeHidden",e[e.Hidden=3]="Hidden",e[e.OpenChange=4]="OpenChange",e[e.AnimationStart=5]="AnimationStart",e[e.AnimationEnd=6]="AnimationEnd",e[e.StateChange=7]="StateChange"}(pr||(pr={}));class yr extends s{name="ToastCore";present=new m;delay=1200;timer=null;open=!1;_mask=!1;_icon=null;_texts=[];get state(){return{mask:this._mask,icon:this._icon,texts:this._texts,enter:this.present.state.enter,visible:this.present.state.visible,exit:this.present.state.exit}}constructor(e={}){super(e);const{delay:t}=e;t&&(this.delay=t),this.present.onShow(()=>{this.open=!0,this.emit(pr.OpenChange,!0)}),this.present.onHidden(()=>{this.open=!1,this.emit(pr.OpenChange,!1)}),this.present.onStateChange(()=>this.emit(pr.StateChange,{...this.state}))}async show(e){const{mask:t=!1,icon:n,texts:r}=e;if(this._mask=t,this._icon=n,this._texts=r,this.emit(pr.StateChange,{...this.state}),null===this.timer)this.present.show(),"loading"!==this._icon&&(this.timer=setTimeout(()=>{this.hide()},this.delay));else{if(this.clearTimer(),"loading"===this._icon)return;this.timer=setTimeout(()=>{this.hide()},this.delay)}}clearTimer(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}hide(){this.present.hide(),this.clearTimer()}onShow(e){return this.on(pr.Show,e)}onHide(e){return this.on(pr.Hidden,e)}onOpenChange(e){return this.on(pr.OpenChange,e)}onStateChange(e){return this.on(pr.StateChange,e)}get[Symbol.toStringTag](){return"ToastCore"}}!function(e){e[e.TOP=1]="TOP",e[e.BOTTOM=-1]="BOTTOM",e[e.CONTENT=0]="CONTENT"}(fr||(fr={}));const Sr=(e,t=1,n)=>e.map((e,r)=>{const{key:o,title:s,...i}=e,a={...i,key:o,title:s,pos:void 0===n?String(r):`${n}-${r}`};if(e.children&&e.children.length){const n=t+1;a.children=Sr(e.children,n,a.pos)}return a});function Cr(e=[],t){!function e(n,r,o,s){let i=n;n&&n.length&&(i=n.filter(Boolean)),i.forEach((n,r)=>{if(!n.isTreeNode)return;const{pos:i}=n;o.push(i);const a=[];n.$children&&e(n.$children,i,a,i),t(n,r,i,n.rckey||i,a,s)})}(e,0,[])}function vr(e,t){return e.every((e,n)=>e===t[n])}function br(e){if(!e.getClientRects().length)return{top:0,left:0};const t=e.getBoundingClientRect();if(t.width||t.height){const n=e.ownerDocument,r=n.defaultView,o=n.documentElement;return{top:t.top+r.pageYOffset-o.clientTop,left:t.left+r.pageXOffset-o.clientLeft}}return t}const wr=(e,t,n)=>{e.forEach((e,r,o)=>e.key===t?n(e,r,o):!!e.children&&wr(e.children,t,n))};var xr,_r,kr,Tr=Object.freeze({__proto__:null,calcDropPosition:function(e,t){const{selectHandle:n}=t.$refs,r=br(n).top,o=n.offsetHeight,s=e.pageY;return s>r+o-2?fr.BOTTOM:s<r+2?fr.TOP:fr.CONTENT},computeMoveNeededParams:function(e,t,n,r){const o=r!==fr.CONTENT;let s,i,a;wr(e,t,(e,t,n)=>{i=n,a=t,s=e});let h,l=null;if(!o){let t=null;return wr(e,n,e=>{t=e}),{targetSourceNode:t,originSourceNode:s,originSourceNodeIndex:a,originSourceNodes:i}}return wr(e,n,(e,t,n)=>{l=n,h=t}),{targetSourceNodes:l,targetSourceNodeIndex:h,originSourceNode:s,originSourceNodeIndex:a,originSourceNodes:i}},findSourceNodeByKey:wr,formatSourceNodes:Sr,getDraggingNodesKey:function(e){const t=[],n=e.pos.split("-");return Cr(e.$children,(r,o,s,i)=>{const a=s.split("-");(e.pos===s||n.length<a.length)&&vr(n,a)&&t.push(i)}),t.push(e.rckey),t},getOffset:br,insertToBottom:function(e,t,n,r,o){let s=e+1;return o===t&&e>r&&(s=e),o.splice(r,1),t.splice(s,0,n),{targetSourceNodes:t,originSourceNodes:o}},insertToTop:function(e,t,n,r,o){return o!==t||r>e?(o.splice(r,1),t.splice(e,0,n),{targetSourceNodes:t,originSourceNodes:o}):(t.splice(e,0,n),o.splice(r,1),{targetSourceNodes:t,originSourceNodes:o})},isInclude:vr,noop:function(){},traverseTreeNodes:Cr});!function(e){e[e.StateChange=0]="StateChange"}(xr||(xr={}));!function(e){e[e.Enter=0]="Enter",e[e.Leave=1]="Leave",e[e.Focus=2]="Focus",e[e.Blur=3]="Blur",e[e.Click=4]="Click",e[e.Change=5]="Change"}(_r||(_r={}));class Or extends s{_name="MenuItemCore";debug=!0;label;tooltip;icon;shortcut;menu=null;_open=!1;_hidden=!1;_enter=!1;_focused=!1;_disabled=!1;get state(){return{label:this.label,icon:this.icon,shortcut:this.shortcut,open:this._open,disabled:this._disabled,focused:this._focused||this._open}}get hidden(){return this._hidden}constructor(e){super(e);const{_name:t,tooltip:n,label:r,icon:o,shortcut:s,disabled:i=!1,hidden:a=!1,menu:h,onClick:l}=e;this.label=r,this.tooltip=n,this.icon=o,this.shortcut=s,this._hidden=a,this._disabled=i,t&&(this._name=t),h&&(this.menu=h,h.onShow(()=>{this._open=!0,this.emit(_r.Change,{...this.state})}),h.onHide(()=>{this._open=!1,this.emit(_r.Change,{...this.state})})),l&&this.onClick(l.bind(this))}setIcon(e){this.icon=e,this.emit(_r.Change,{...this.state})}disable(){this._disabled=!0,this.emit(_r.Change,{...this.state})}enable(){this._disabled=!1,this.emit(_r.Change,{...this.state})}handlePointerEnter(){this._enter||(this._enter=!0,this._focused=!0,this.emit(_r.Enter),this.emit(_r.Change,{...this.state}))}handlePointerMove(){}handlePointerLeave(){!1!==this._enter&&(this._enter=!1,this._focused=!1,this.emit(_r.Leave),this.emit(_r.Change,{...this.state}))}handleFocus(){this._focused||(this._focused=!0,this.emit(_r.Focus),this.emit(_r.Change,{...this.state}))}handleBlur(){!1!==this._focused&&(this._enter=!1,this.blur())}handleClick(){this._disabled||this.emit(_r.Click)}blur(){this._focused=!1,this.emit(_r.Blur),this.emit(_r.Change,{...this.state})}reset(){this._focused=!1,this._open=!1,this._enter=!1,this.menu&&this.menu.reset()}hide(){this._hidden=!0}show(){this._hidden=!1}unmount(){super.destroy(),this.menu&&this.menu.unmount(),this.reset()}onEnter(e){return this.on(_r.Enter,e)}onLeave(e){return this.on(_r.Leave,e)}onFocus(e){return this.on(_r.Focus,e)}onBlur(e){return this.on(_r.Blur,e)}onClick(e){return this.on(_r.Click,e)}onStateChange(e){return this.on(_r.Change,e)}get[Symbol.toStringTag](){return"MenuItem"}}!function(e){e[e.StateChange=0]="StateChange",e[e.Change=1]="Change"}(kr||(kr={}));function Pr(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}function Er(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Dr(e){const t=Pr(e);return t.setDate(1),t.setHours(0,0,0,0),t}function Mr(e,t,n){const r=n?.ISOWeek?Br(t):Hr(t,n),o=n?.ISOWeek?Ir(e):qr(e,n),s=Jr(r,o),i=[];for(let e=0;e<=s;e++)i.push(Gr(o,e));return i.reduce((e,t)=>{const r=n?.ISOWeek?Nr(t):Lr(t,n),o=e.find(e=>e.weekNumber===r);return o?(o.dates.push(t),e):(e.push({weekNumber:r,dates:[t]}),e)},[])}function Lr(e,t){const n=Pr(e),r=qr(n,t).getTime()-Ar(n,t).getTime();return Math.round(r/to)+1}function Ar(e,t){const n=zr(),r=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=Rr(e,t),s=Er(e,0);s.setFullYear(o,0,r),s.setHours(0,0,0,0);return qr(s,t)}function Rr(e,t){const n=Pr(e),r=n.getFullYear(),o=zr(),s=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??o.firstWeekContainsDate??o.locale?.options?.firstWeekContainsDate??1,i=Er(e,0);i.setFullYear(r+1,0,s),i.setHours(0,0,0,0);const a=qr(i,t),h=Er(e,0);h.setFullYear(r,0,s),h.setHours(0,0,0,0);const l=qr(h,t);return n.getTime()>=a.getTime()?r+1:n.getTime()>=l.getTime()?r:r-1}function Ir(e){return qr(e,{weekStartsOn:1})}function Nr(e){const t=Pr(e),n=Ir(t).getTime()-$r(t).getTime();return Math.round(n/to)+1}function $r(e){const t=Fr(e),n=Er(e,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),Ir(n)}function Fr(e){const t=Pr(e),n=t.getFullYear(),r=Er(e,0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);const o=Ir(r),s=Er(e,0);s.setFullYear(n,0,4),s.setHours(0,0,0,0);const i=Ir(s);return t.getTime()>=o.getTime()?n+1:t.getTime()>=i.getTime()?n:n-1}function Br(e){return Hr(e,{weekStartsOn:1})}function Hr(e,t){const n=zr(),r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,o=Pr(e),s=o.getDay(),i=6+(s<r?-7:0)-(s-r);return o.setDate(o.getDate()+i),o.setHours(23,59,59,999),o}function jr(e,t){const n=Mr(Dr(e),Qr(e),t);if(t?.useFixedWeeks){const r=Vr(e,t);if(r<6){const e=n[n.length-1],o=e.dates[e.dates.length-1],s=Kr(o,6-r),i=Mr(Kr(o,1),s,t);n.push(...i)}}return n}function Vr(e,t){return Ur(Yr(e),Dr(e),t)+1}function Ur(e,t,n){const r=qr(e,n),o=qr(t,n),s=r.getTime()-Xr(r),i=o.getTime()-Xr(o);return Math.round((s-i)/to)}function qr(e,t){const n=zr(),r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,o=Pr(e),s=o.getDay(),i=(s<r?7:0)+s-r;return o.setDate(o.getDate()-i),o.setHours(0,0,0,0),o}let Wr={};function zr(){return Wr}function Yr(e){const t=Pr(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(0,0,0,0),t}function Kr(e,t){return Gr(e,7*t)}function Gr(e,t){const n=Pr(e);return isNaN(t)?Er(e,NaN):t?(n.setDate(n.getDate()+t),n):n}function Qr(e){const t=Pr(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Jr(e,t){const n=Zr(e),r=Zr(t),o=n.getTime()-Xr(n),s=r.getTime()-Xr(r);return Math.round((o-s)/eo)}function Xr(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Zr(e){const t=Pr(e);return t.setHours(0,0,0,0),t}const eo=864e5,to=6048e5;var no,ro=Object.freeze({__proto__:null,ArrayFieldCore:class{symbol="ArrayFieldCore";_label;_hidden=!1;fields=[];_field;_bus=o();get state(){return{label:this._label,hidden:this._hidden,fields:this.fields.map(e=>({id:e.id,idx:e.idx,label:e.field.label}))}}constructor(e){const{label:t="",field:n,hidden:r=!1}=e;this._label=t,this._field=n,this._hidden=r,this.fields=[]}mapFieldWithIndex(e){const t=this.fields[e];return t||null}getFieldWithId(e){return this.fields.find(t=>t.id===e)??null}showField(e){console.log("[BIZ]formv2/field - showField",e,this.fields);for(let t=0;t<this.fields.length;t+=1)(()=>{let n=this.fields[t];n&&n.field.showField(e)})();this._bus.emit(In.StateChange,{...this.state})}hideField(e){for(let t=0;t<this.fields.length;t+=1)(()=>{let n=this.fields[t];n&&n.field.hideField(e)})();this._bus.emit(In.StateChange,{...this.state})}setFieldValue(e,t){for(let n=0;n<this.fields.length;n+=1)(()=>{let r=this.fields[n];r&&r.field.setFieldValue(e,t)})();this._bus.emit(In.StateChange,{...this.state})}get label(){return this._label}get hidden(){return this._hidden}get value(){return this.fields.map(e=>e.field.value)}refresh(){this._bus.emit(In.StateChange,{...this.state})}hide(){this._hidden=!0,this._bus.emit(In.StateChange,{...this.state})}show(){this._hidden=!1,this._bus.emit(In.StateChange,{...this.state})}setValue(e,t={}){console.log("[DOMAIN]ArrayFieldCore - setValue",t.key,e,this.fields);let n=0;for(;n<e.length;n+=1)(()=>{const r=e[n];let o=this.fields[n];if(!o){const e=this._field(n);o={id:this.fields.length,idx:n,field:e},this.fields[n]=o}o.field.setValue(r,{idx:n,silence:t.silence,key:t.key})})();this.fields=this.fields.slice(0,n),console.log("[DOMAIN]ArrayFieldCore - after setValue",this.fields),this._bus.emit(In.StateChange,{...this.state})}clear(){this.setValue([])}async validate(){const e=[],t=[];for(let n=0;n<this.fields.length;n+=1)await(async()=>{const r=this.fields[n],o=await r.field.validate();o.error?t.push(...o.error.messages):e.push(o.data)})();return t.length>0?a.Err(t):a.Ok(e)}insertBefore(e){const t=this.fields.findIndex(t=>t.id===e)??0,n=this._field(this.fields.length),r=this.fields.length;let o=t;return o<0&&(o=0),n.onChange(()=>{this._bus.emit(In.Change,{id:r,idx:o})}),this.fields.splice(o,0,{id:this.fields.length,idx:o,field:n}),this._bus.emit(In.StateChange,{...this.state}),n}insertAfter(e){const t=this.fields.findIndex(t=>t.id===e)??this.fields.length-1,n=this._field(this.fields.length),r=this.fields.length;let o=t+1;return o>this.fields.length&&(o=this.fields.length),n.onChange(()=>{this._bus.emit(In.Change,{id:r,idx:o})}),this.fields.splice(o,0,{id:r,idx:o,field:n}),this._bus.emit(In.StateChange,{...this.state}),n}append(e={}){let t=this._field(this.fields.length);const n=this.fields.length,r=this.fields.length;return setTimeout(()=>{t.onChange(()=>{this._bus.emit(In.Change,{id:n,idx:r})})},800),this.fields.push({id:n,idx:r,field:t}),e.silence||this._bus.emit(In.StateChange,{...this.state}),t}remove(e){const t=this.fields.findIndex(t=>t.id===e);if(console.log("[BIZ]formv2/field - remove",e,t),-1===t)return;const n=this.fields[t];n&&"SingleFieldCore"===n.field.symbol&&n.field.input.destroy(),this.fields=gn(this.fields,t),this._bus.emit(In.StateChange,{...this.state})}removeByIndex(e){const t=this.fields[e];console.log("[BIZ]formv2/field - remove",e,t),t&&"SingleFieldCore"===t.field.symbol&&t.field.destroy(),this.fields=gn(this.fields,e),this._bus.emit(In.StateChange,{...this.state})}upIdx(e){const t=this.fields.findIndex(t=>t.id===e);if(-1===t)return;if(0===t)return;const n=this.fields[t-1];n&&(this.fields[t-1]=this.fields[t],this.fields[t]=n,this._bus.emit(In.StateChange,{...this.state}))}downIdx(e){const t=this.fields.findIndex(t=>t.id===e);if(-1===t)return;if(t===this.fields.length-1)return;const n=this.fields[t+1];n&&(this.fields[t+1]=this.fields[t],this.fields[t]=n,this._bus.emit(In.StateChange,{...this.state}))}ready(){}destroy(){for(let e=0;e<this.fields.length;e+=1){this.fields[e].field.destroy()}this._bus.destroy()}onChange(e){return this._bus.on(In.Change,e)}onStateChange(e){return this._bus.on(In.StateChange,e)}},ButtonCore:Un,ButtonInListCore:class extends s{btns=[];cur=null;constructor(e={}){super(e);const{onClick:t}=e;t&&this.onClick(t)}bind(e){const t=this.btns.find(t=>t.cur.value===e);if(t)return t;const n=new Un({onClick:e=>{this.cur=n,this.emit(kn.Click,e)}});return n.bind(e),this.btns.push(n),n}clear(){this.cur=null}setLoading(e){if(null!==this.cur)this.cur.setLoading(e);else for(let t=0;t<this.btns.length;t+=1){this.btns[t].setLoading(e)}}click(){null!==this.cur&&this.cur.click()}onClick(e){this.on(kn.Click,e)}onStateChange(e){this.on(kn.StateChange,e)}},CalendarCore:function(e){const{today:t}=e;function n(e){return`${e.getMonth()+1}月`}function r(e){l=[];const t=jr(e,{locale:{code:""},weekStartsOn:1});for(let n=0;n<t.length;n+=1){const{dates:r}=t[n];let o=!1;const s={id:n,dates:r.map((t,n)=>{t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);const r=t.valueOf()===e.valueOf();return r&&(o=!0),{id:n,text:t.getDate().toString(),yyyy:`${t.getFullYear()}-${fn(t.getMonth()+1)}-${fn(t.getDate())}`,is_prev_month:t.getMonth()<e.getMonth(),is_next_month:t.getMonth()>e.getMonth(),is_today:r,value:t,time:t.valueOf()}})};l.push(s),o&&(u=s.dates)}}t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);let s={text:t.getDate().toString(),value:t,time:t.valueOf()},i={text:n(t),value:t,time:t.valueOf()},a={text:t.getFullYear(),value:t,time:t.valueOf()},h={text:t.toLocaleDateString()+t.toLocaleTimeString(),value:t,time:t.valueOf()},l=[],u=[];r(t);let c,d={get day(){return s},get month(){return i},get year(){return a},get weekdays(){return u},get weeks(){return l},get selectedDay(){return h}};!function(e){e[e.SelectDay=0]="SelectDay",e[e.Change=1]="Change"}(c||(c={}));const p=o();return{state:d,get value(){return h?h.value:null},selectDay(e){if(s.value!==e){if(e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),s={text:e.getDate().toString(),value:e,time:e.valueOf()},p.emit(c.SelectDay,e),h){const t=h.value.getFullYear(),o=e.getFullYear(),s=h.value.getMonth(),l=e.getMonth();t===o&&s===l||(i={text:n(e),value:e,time:e.valueOf()},a={text:e.getFullYear(),value:e,time:e.valueOf()},r(e))}h={text:e.toLocaleDateString()+e.toLocaleTimeString(),value:e,time:e.valueOf()},p.emit(c.Change,{...d})}},nextMonth(){},prevMonth(){},buildMonthText:n,onSelectDay:e=>p.on(c.SelectDay,e),onChange:e=>p.on(c.Change,e)}},CheckboxCore:qn,CheckboxGroupCore:class extends s{shape="checkbox-group";options=[];disabled;values=[];get indeterminate(){return this.values.length===this.options.length}get state(){return{values:this.values,options:this.options,disabled:this.disabled,indeterminate:this.indeterminate}}prevChecked=!1;constructor(e={}){super(e);const{options:t=[],disabled:n=!1,onChange:r}=e;this.disabled=n,this.options=t.map(e=>{const{label:t,value:n,checked:r,disabled:o}=e,s=new qn({label:t,checked:r,disabled:o,onChange:e=>{const t=this.values.includes(n);!e||t?!e&&t&&this.uncheckOption(n):this.checkOption(n)}});return{label:t,value:n,core:s}}),r&&this.onChange(r)}checkOption(e){console.log("[DOMAIN]domains/ui/checkbox/group - checkOption",e),this.values=this.values.concat(e),this.emit(kr.Change,[...this.values]),this.emit(kr.StateChange,{...this.state})}uncheckOption(e){console.log("[DOMAIN]domains/ui/checkbox/group - uncheckOption",e),this.values=this.values.filter(t=>t!==e),this.emit(kr.Change,[...this.values]),this.emit(kr.StateChange,{...this.state})}reset(){this.values=[],this.emit(kr.Change,[...this.values]),this.emit(kr.StateChange,{...this.state})}setOptions(e){for(let e=0;e<this.options.length;e+=1){this.options[e].core.destroy()}this.options=e.map(e=>{const{label:t,value:n,checked:r,disabled:o}=e,s=new qn({label:t,checked:r,disabled:o,onChange:e=>{const t=this.values.includes(n);!e||t?!e&&t&&this.uncheckOption(n):this.checkOption(n)}});return{label:t,value:n,core:s}}),console.log("[DOMAIN]ui/checkbox/group - setOptions",this.options.length),this.emit(kr.StateChange,{...this.state})}onChange(e){return this.on(kr.Change,e)}onStateChange(e){return this.on(kr.StateChange,e)}},ContextMenuCore:class extends s{menu;state={items:[]};constructor(e){super(e);const{_name:t,items:n=[]}=e;this.state.items=n,this.menu=new Kn({...e,_name:t?`${t}__menu`:"menu-in-context-menu",side:"right",align:"start"})}show(e={}){const{x:t,y:n}=e;this.updateReference({...this.menu.popper.reference,getRect:()=>({width:5,height:5,left:t,top:n,x:t,y:n})}),this.menu.show()}hide(){console.log("[]ContextMenuCore - hide"),this.menu.hide()}setReference(e){this.menu.popper.setReference(e)}updateReference(e){this.menu.popper.updateReference(e)}setItems(e){this.state.items=e,this.emit(Dn.StateChange,{...this.state})}onStateChange(e){this.on(Dn.StateChange,e)}onShow(e){this.on(Dn.Show,e)}onHide(e){this.on(Dn.Hidden,e)}},DialogCore:Gn,DismissableLayerCore:Yn,DropdownMenuCore:class extends s{open=!1;disabled=!1;get state(){return{items:this.items,open:this.open,disabled:this.disabled,enter:this.menu.presence?.state.enter,visible:this.menu.presence?.state.visible,exit:this.menu.presence?.state.exit}}menu;subs=[];items=[];constructor(e={}){super(e);const{_name:t,side:n,align:r,items:o=[],onHidden:s}=e;this.items=o,this.menu=new Kn({side:n,align:r,items:o,_name:t?`${t}__menu`:"menu-in-dropdown"}),this.menu.onHide(()=>{this.menu.reset(),s&&s()}),this.menu.presence.onStateChange(()=>{this.emit(Ln.StateChange,{...this.state})})}listenItems(e){for(let t=0;t<e.length;t+=1)e[t]}setItems(e){this.items=e,this.emit(Ln.StateChange,{...this.state})}showMenuItem(e){const t=this.items.find(t=>t.label===e);t&&t.show()}toggle(e){if(e){const{x:t,y:n,width:r=8,height:o=8}=e;this.menu.popper.updateReference({getRect:()=>({width:r,height:o,x:t,y:n})})}this.menu.toggle()}hide(){this.menu.hide()}unmount(){super.destroy(),this.menu.unmount()}onStateChange(e){this.on(Ln.StateChange,e)}},FocusScopeCore:class extends s{name="FocusScopeCore";state={paused:!1};constructor(e={}){super(e)}pause(){this.state.paused=!0,this.emit(An.StateChange,{...this.state})}resume(){this.state.paused=!1,this.emit(An.StateChange,{...this.state})}focusin(){this.emit(An.Focusin)}focusout(){this.emit(An.Focusout)}onFocusin(e){this.on(An.Focusin,e)}onFocusout(e){this.on(An.Focusout,e)}onStateChange(e){this.on(An.StateChange,e)}},FormCore:function(e){const{fields:t}=e;let n=t,r={},s=!1;const i={get value(){return r},get fields(){return Object.values(n)},get inline(){return s}};let h;!function(e){e[e.Input=0]="Input",e[e.Submit=1]="Submit",e[e.Change=2]="Change",e[e.StateChange=3]="StateChange"}(h||(h={}));const l=o();function u(e,t){r[e]=t}function c(e,t){r[e]=t,l.emit(h.Change,{...i.value})}const d=Object.keys(n);for(let e=0;e<d.length;e+=1){const t=n[d[e]];u(t.name,t.$input.value),t.$input.onChange(e=>{console.log("[DOMAIN]ui/form/index - updateValues",t.name,e),c(t.name,e)}),t.onShow(()=>{c(t.name,t.$input.value)}),t.onHide(()=>{delete r[t.name],l.emit(h.Change,{...i.value})})}return{symbol:"FormCore",shape:"form",state:i,get value(){return r},get fields(){return n},setValue(e,t={}){const o=Object.keys(n);for(let t=0;t<o.length;t+=1){n[o[t]].$input.setValue(e[o[t]],{silence:!0})}r=e,t.silence||l.emit(h.Change,i.value)},setInline(e){s=e,l.emit(h.StateChange,{...i})},input(e,t){r[e]=t,l.emit(h.Change,i.value)},submit(){l.emit(h.Submit,i.value)},validate:()=>a.Ok(r),onSubmit(e){l.on(h.Submit,e)},onInput(e){l.on(h.Change,e)},onChange:e=>l.on(h.Change,e),onStateChange:e=>l.on(h.StateChange,e)}},ImageCore:Qn,ImageInListCore:class extends s{btns=[];cur=null;scale=null;constructor(e={}){super(e);const{scale:t}=e;t&&(this.scale=t)}bind(e){const t=this.btns.find(t=>t.unique_id===e);if(t)return t;const n=new Qn({src:e,scale:this.scale||void 0});return this.btns.push(n),n}select(e){const t=this.btns.find(t=>t.unique_id===e);t&&(this.cur=t)}clear(){this.cur=null}onStateChange(e){this.on($n.StateChange,e)}},get ImageStep(){return Fn},InputCore:Jn,InputInListCore:class extends s{defaultValue;list=[];cached={};values=new Map;constructor(e){super(e);const{defaultValue:t}=e;this.defaultValue=t}bind(e,t={}){const{defaultValue:n=this.defaultValue}=t,r=this.cached[e];if(r)return r;const o=new Jn({defaultValue:n,onChange:t=>{this.values.set(e,t),this.emit(Bn.Change,[e,t])}});return this.list.push(o),this.values.set(e,n),this.cached[e]=o,o}getCur(e){const t=this.cached[e];return t||null}setValue(e){for(let t=0;t<this.list.length;t+=1){this.list[t].setValue(e)}}clear(){this.list=[],this.cached={},this.values=new Map}getValueByUniqueId(e){return this.values.get(e)??null}toJson(e){const t=[];for(const[n,r]of this.values){const o=e([n,r]);t.push(o)}return t}onChange(e){this.on(Bn.Change,e)}onStateChange(e){this.on(Bn.StateChange,e)}},MenuCore:Kn,MenuItemCore:Or,NodeCore:class extends s{handleShow(){this.emit(Hn.EnterViewport)}onVisible(e){return this.on(Hn.EnterViewport,e)}onClick(e){return this.on(Hn.Click,e)}},ObjectFieldCore:class{symbol="ObjectFieldCore";_label;_hidden=!1;_dirty=!1;fields;rules;_bus=o();get state(){const e=function(e){return Object.keys(e).map(t=>{const n=e[t];return{symbol:n.symbol,label:n.label,name:t,hidden:n.hidden}})}(this.fields);return{label:this._label,hidden:this._hidden,fields:e}}constructor(e){const{label:t="",hidden:n=!1,fields:r,rules:o=[]}=e;this._label=t,this._hidden=n,this.fields=r,this.rules=o,setTimeout(()=>{const e=Object.values(r);for(let t=0;t<e.length;t+=1){e[t].onChange(()=>{this._bus.emit(Nn.Change)})}},800)}get label(){return this._label}get hidden(){return this._hidden}get dirty(){return this._dirty}get value(){return Object.keys(this.fields).reduce((e,t)=>(e[t]=this.fields[t].value,e),{})}mapFieldWithName(e){const t=this.fields[e];return t||null}setField(e,t){this.fields[e]=t,this._bus.emit(Nn.StateChange,{...this.state})}showField(e){const t=this.fields[e];t&&t.show()}hideField(e){const t=this.fields[e];t&&(t.hide(),this._bus.emit(Nn.StateChange,{...this.state}))}setFieldValue(e,t){const n=this.fields[e];n&&(n.setValue(t),this._bus.emit(Nn.StateChange,{...this.state}))}hide(){this._hidden=!0,this._bus.emit(Nn.StateChange,{...this.state})}show(){this._hidden=!1,this._bus.emit(Nn.StateChange,{...this.state})}setValue(e,t={}){if(t.key){const n=this.fields[t.key];return void(n&&n.setValue(e[t.key]))}const n=Object.keys(this.fields);for(let t=0;t<n.length;t+=1){const r=n[t];this.fields[r].setValue(e[r])}}refresh(){this._bus.emit(Nn.StateChange,{...this.state})}clear(){const e=Object.keys(this.fields);for(let t=0;t<e.length;t+=1){const n=e[t];this.fields[n].clear()}}async validate(){const e={},t=[],n=Object.keys(this.fields);for(let r=0;r<n.length;r+=1)await(async()=>{const o=n[r],s=this.fields[o],i=await s.validate();i.error?t.push(...i.error.messages):e[o]=i.data})();if(t.length>0)return a.Err(t);const r=[];for(let t=0;t<this.rules.length;t+=1){const n=this.rules[t];if(n.custom){const t=await n.custom(e);t.error&&r.push(...t.error.messages)}}return r.length>0?a.Err(r):a.Ok(e)}handleValueChange(e,t){this._dirty=!0;const n=this.fields[e];n&&(n.setValue(t,{key:e}),this._bus.emit(Nn.Change,this.value))}toJSON(){return Object.keys(this.fields).map(e=>({[e]:this.fields[e].value})).reduce((e,t)=>({...e,...t}),{})}ready(){}destroy(){const e=Object.values(this.fields);for(let t=0;t<e.length;t+=1){e[t].destroy()}this._bus.destroy()}onChange(e){return this._bus.on(Nn.Change,e)}onStateChange(e){return this._bus.on(Nn.StateChange,e)}},PopoverCore:Xn,PresenceCore:m,ProgressCore:class extends s{_value;_label;_max;constructor(e){super();const{value:t,max:n,getValueLabel:r=tr}=e,o=function(e){return nr(e)&&!isNaN(e)&&e>0}(n)?n:100;this._max=o;const s=function(e,t){return nr(e)&&!isNaN(e)&&e<=t&&e>=0}(t,o)?t:null;this._value=s;const i=nr(s)?r(s,o):void 0;this._label=i}get state(){return{state:(e=this._value,t=this._max,null==e?"indeterminate":e===t?"complete":"loading"),value:this._value??void 0,max:this._max,label:this._label};var e,t}setValue(e){this._value=e,this.emit(Zn.ValueChange,e),this.emit(Zn.StateChange,this.state)}update(e){this._value=e,this.emit(Zn.ValueChange,e),this.emit(Zn.StateChange,this.state)}onValueChange(e){this.on(Zn.ValueChange,e)}onStateChange(e){this.on(Zn.StateChange,e)}},RovingFocusCore:or,ScrollViewCore:gr,SelectCore:mr,SelectInListCore:class extends s{options=[];list=[];cached=new Map;values=new Map;constructor(e={}){super(e);const{options:t=[]}=e;this.options=t}bind(e,t){const{defaultValue:n}=t||{defaultValue:null},r=this.cached.get(e);if(r)return r;const o=new mr({defaultValue:n,options:this.options,onChange:t=>{this.values.set(e,t),this.emit(cr.Change,[e,t])}});return this.list.push(o),this.values.set(e,n),this.cached.set(e,o),o}setOptions(e){if(this.options=e,0!==this.list.length)for(let t=0;t<this.list.length;t+=1){this.list[t].setOptions(e)}}setValue(e){for(let t=0;t<this.list.length;t+=1){this.list[t].setValue(e)}}getValue(e){return this.values.get(e)??null}clear(){this.list=[],this.cached=new Map,this.values=new Map}toJson(e){const t=[];for(const[n,r]of this.values){const o=e([n,r]);t.push(o)}return t}onChange(e){this.on(cr.Change,e)}onStateChange(e){this.on(cr.StateChange,e)}},SingleFieldCore:class{symbol="SingleFieldCore";_label;_hidden=!1;_error=null;_status="normal";_focus=!1;_input;_rules;_dirty=!1;_bus=o();get state(){return{symbol:this.symbol,label:this._label,hidden:this._hidden,focus:this._focus,error:this._error,status:this._status,input:{shape:this._input.shape,value:this._input.value,type:this._input.type,options:"select"===this._input.shape?this._input.options:void 0}}}constructor(e){const{label:t="",rules:n=[],input:r,hidden:o=!1}=e;this._label=t,this._input=r,this._rules=n,this._hidden=o,setTimeout(()=>{this._input.onChange(()=>{this._bus.emit(Rn.Change,this._input.value)})},800)}get label(){return this._label}get hidden(){return this._hidden}get dirty(){return this._dirty}get input(){return this._input}get value(){return this._input.value}hide(){this._hidden=!0}show(){this._hidden=!1}showField(e){this._hidden=!1}hideField(e){this._hidden=!0}setFieldValue(e,t){this.input.setValue(t)}clear(){this.setValue(this._input.defaultValue)}async validate(){const e=this._input.value,t=[];for(let n=0;n<this._rules.length;n+=1){const r=this._rules[n];if(r.required&&!e&&t.push(`${this._label}不能为空`),r.maxLength&&e&&String(e).length>r.maxLength&&t.push(`${this._label}长度不能超过${r.maxLength}个字符`),r.minLength&&e&&String(e).length<r.minLength&&t.push(`${this._label}长度不能小于${r.minLength}个字符`),r.max&&"number"==typeof e&&e>r.max&&t.push(`${this._label}不能大于${r.max}`),r.min&&"number"==typeof e&&e<r.min&&t.push(`${this._label}不能小于${r.min}`),r.mode&&e){if("email"===r.mode){e.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||t.push(`${this._label}格式错误`)}if("number"===r.mode){!Number.isNaN(Number(e))||t.push(`${this._label}格式错误`)}}if(r.custom){const n=r.custom(e);n.error&&t.push(...n.error.messages)}}return t.length>0?a.Err(new i(t)):a.Ok(e)}setValue(e,t={}){const n=(()=>void 0!==e?e:this._input.defaultValue)();this._input.setValue(n)}setStatus(e){this._status=e,this._bus.emit(Rn.StateChange,{...this.state})}setFocus(e){this._focus=e,this._bus.emit(Rn.StateChange,{...this.state})}handleValueChange(e){this._dirty=!0,this._input.setValue(e)}ready(){}destroy(){this._input.destroy&&this._input.destroy(),this._bus.destroy()}onChange(e){return this._bus.on(Rn.Change,e)}onStateChange(e){return this._bus.on(Rn.StateChange,e)}},TabsCore:class extends s{roving;prevContent=null;contents=[];state={curValue:null,orientation:"horizontal",dir:"ltr"};constructor(e={}){super(e),this.roving=new or}selectTab(e){const t=this.contents.find(t=>t.value===e);t&&(this.prevContent&&this.prevContent.presence.hide(),t.presence.show(),this.prevContent=t,this.emit(dr.ValueChange,e))}appendContent(e){this.contents.includes(e)||this.contents.push(e)}onStateChange(e){this.on(dr.StateChange,e)}onValueChange(e){this.on(dr.ValueChange,e)}},ToastCore:yr,TreeCore:class extends s{onStateChange(e){return this.on(xr.StateChange,e)}},Utils:Tr,addDays:Gr,addWeeks:Kr,clamp:function(e,[t,n]){return Math.min(n,Math.max(t,e))},constructFrom:Er,damping:ar,daysToMonthWeeks:Mr,differenceInCalendarDays:Jr,differenceInCalendarMonths:function(e,t){const n=Pr(e),r=Pr(t);return 12*(n.getFullYear()-r.getFullYear())+(n.getMonth()-r.getMonth())},differenceInCalendarWeeks:Ur,endOfISOWeek:Br,endOfMonth:Qr,endOfWeek:Hr,getAngleByPoints:hr,getDefaultOptions:zr,getISOWeek:Nr,getISOWeekYear:Fr,getMonthWeeks:jr,getPoint:sr,getTimezoneOffsetInMilliseconds:Xr,getWeek:Lr,getWeekYear:Rr,getWeeksInMonth:Vr,lastDayOfMonth:Yr,millisecondsInDay:eo,millisecondsInWeek:to,onCreateScrollView:function(e){lr=e},preventDefault:ir,startOfDay:Zr,startOfISOWeek:Ir,startOfISOWeekYear:$r,startOfMonth:Dr,startOfWeek:qr,startOfWeekYear:Ar,toDate:Pr});!function(e){e[e.BeforeRequest=0]="BeforeRequest",e[e.AfterRequest=1]="AfterRequest",e[e.LoadingChange=2]="LoadingChange",e[e.Success=3]="Success",e[e.Failed=4]="Failed",e[e.Completed=5]="Completed",e[e.Canceled=6]="Canceled",e[e.StateChange=7]="StateChange",e[e.ResponseChange=8]="ResponseChange"}(no||(no={}));let oo=null;class so extends s{_name="RequestCore";debug=!1;defaultResponse=null;service;process;client;delay=null;loading=!1;initial=!0;pending=null;args=[];response=null;error=null;id=String(this.uid());get state(){return{initial:this.initial,loading:this.loading,error:this.error,response:this.response}}constructor(e,t={}){super({unique_id:t._name});const{_name:n,client:r,delay:o,defaultResponse:s,loading:i,process:a,onSuccess:h,onFailed:l,onCompleted:u,onCanceled:c,onLoading:d,beforeRequest:p}=t;this.service=e,this.process=a,this.client=r,void 0!==o&&(this.delay=o),void 0!==i&&(this.loading=i),s&&(this.defaultResponse=s,this.response=s),n&&(this._name=n),h&&this.onSuccess(h),u&&this.onCompleted(u),c&&this.onCanceled(c),d&&this.onLoadingChange(d),p&&this.beforeRequest(p),oo&&oo(this),l&&this.onFailed(l,{override:!0})}async run(...e){if(!this.service)return a.Err("缺少 service");if("function"!=typeof this.service)return a.Err("service 不是函数");if(!this.client)return a.Err("缺少 client");if(null!==this.pending){const e=await this.pending;this.loading=!1;const t=e.data;return this.pending=null,a.Ok(t)}this.loading=!0,this.initial=!1,this.response=this.defaultResponse,this.args=e,this.error=null,this.emit(no.LoadingChange,!0),this.emit(no.StateChange,{...this.state}),this.emit(no.BeforeRequest);let t=null;const n=(()=>{const{hostname:n="",url:r,method:o,query:s,body:i,headers:h,process:l}=this.service(...e);if(l&&(t=l),"GET"===o){const e=this.client.get(r,s,{id:this.id,headers:h});return a.Ok(e)}if("POST"===o){const e=this.client.post(r,i,{id:this.id,headers:h});return a.Ok(e)}return a.Err(`未知的 method '${o}'`)})();if(n.error)return a.Err(n.error);this.pending=n.data;const[r]=await Promise.all([this.pending,null===this.delay?null:yn(this.delay)]);this.loading=!1;const o=t?t(r):r,s=this.process?this.process(o):o;if(this.emit(no.LoadingChange,!1),this.emit(no.StateChange,{...this.state}),this.emit(no.Completed),this.pending=null,s.error)return"CANCEL"===s.error.code?(this.emit(no.Canceled),a.Err(s.error)):(this.error=s.error,this.emit(no.Failed,s.error),this.emit(no.StateChange,{...this.state}),a.Err(s.error));const i=s.data;return this.response=i,this.emit(no.Success,i),this.emit(no.StateChange,{...this.state}),this.emit(no.ResponseChange,i),a.Ok(i)}reload(){this.run(...this.args)}cancel(){if(!this.client)return a.Err("缺少 client");this.client.cancel(this.id)}clear(){this.response=null,this.emit(no.StateChange,{...this.state}),this.emit(no.ResponseChange,this.response)}setError(e){this.error=e,this.emit(no.StateChange,{...this.state})}modifyResponse(e){if(null===this.response)return;const t=e(this.response);this.response=t,this.emit(no.StateChange,{...this.state}),this.emit(no.ResponseChange,this.response)}onLoadingChange(e){return this.on(no.LoadingChange,e)}beforeRequest(e){return this.on(no.BeforeRequest,e)}onSuccess(e){return this.on(no.Success,e)}onFailed(e,t={}){return t.override&&this.offEvent(no.Failed),this.on(no.Failed,e)}onCanceled(e){return this.on(no.Canceled,e)}onError(e){return this.on(no.Failed,e)}onCompleted(e){return this.on(no.Completed,e)}onStateChange(e){return this.on(no.StateChange,e)}onResponseChange(e){return this.on(no.ResponseChange,e)}}function io(e,t){let n;return function(...r){n&&clearTimeout(n),n=setTimeout(()=>{t(...r),n=null},e)}}const ao={dataSource:[],page:1,pageSize:10,total:0,search:{},initial:!0,noMore:!1,loading:!1,refreshing:null,empty:!1,error:null},ho={page:1,pageSize:10,next_marker:""};function lo(e,t){const n={...e};return t.forEach(e=>{delete n[e]}),n}function uo(e,t){return e[t]}const co={parse(e){if(""===e||"?"===e)return{};let t=e;"?"===e[0]&&(t=e.slice(1));return t.split("&").map(e=>{const[t,n]=e.split("=");return{[t]:n}}).reduce((e,t)=>({...e,...t}),{})},stringify:e=>"object"!=typeof e?"":Object.keys(e).map(t=>`${t}=${e[t]}`).join("&")},po=e=>{if(null===e)return{dataSource:[],page:1,pageSize:10,total:0,noMore:!1,empty:!1,error:new Error("process response fail, because response is null")};try{const t=e,{list:n,page:r=1,pageSize:o=10,total:s=0,isEnd:i}=t,a={dataSource:n,page:r,pageSize:o,total:s,noMore:!1,empty:!1,error:null};return s&&o&&r&&s<=o*r&&(a.noMore=!0),void 0!==i&&(a.noMore=i),o&&n.length<o&&(a.noMore=!0),0===n.length&&1===r&&(a.empty=!0),a}catch(e){return{dataSource:[],page:1,pageSize:10,total:0,noMore:!1,empty:!1,error:new Error(`process response fail, because ${e.message}`)}}};var fo,go;!function(e){e[e.LoadingChange=0]="LoadingChange",e[e.BeforeSearch=1]="BeforeSearch",e[e.AfterSearch=2]="AfterSearch",e[e.ParamsChange=3]="ParamsChange",e[e.DataSourceChange=4]="DataSourceChange",e[e.DataSourceAdded=5]="DataSourceAdded",e[e.StateChange=6]="StateChange",e[e.Error=7]="Error",e[e.Completed=8]="Completed"}(fo||(fo={}));class mo extends s{debug=!1;static defaultResponse=()=>({...ao});static commonProcessor=po;request;beforeRequest=(e,t)=>({...t,...e});processor;initialParams;extraResponse;extraDatSource=[];insertExtraDataSource=!1;params={...ho};response={...ao};rowKey;constructor(e,t={}){if(super(),!(e instanceof so))throw new Error("fetch must be a instance of RequestCore");const{debug:n,rowKey:r="id",beforeRequest:o,processor:s,extraDefaultResponse:i,extraDataSource:a,onLoadingChange:h,onStateChange:l,beforeSearch:u,afterSearch:c}=t;this.debug=!!n,this.rowKey=r,this.request=e,this.processor=e=>{const t={...this.response,...mo.commonProcessor(e)};if(s){const n=s(t,e);if(void 0!==n)return n}return t},void 0!==o&&(this.beforeRequest=o),this.initialParams={...ho},this.extraResponse={...i},this.extraDatSource=t.extraDataSource??[],h&&this.onLoadingChange(h),l&&this.onStateChange(l),u&&this.onBeforeSearch(u),c&&this.onAfterSearch(c),this.initialize(t)}initialize(e){const{search:t,dataSource:n,page:r,pageSize:o,initial:s}=e;void 0!==t&&(this.initialParams={...this.initialParams,...t},this.extraResponse.search=t),void 0!==n&&(this.extraResponse.dataSource=n),void 0!==r&&(this.initialParams.page=r,this.extraResponse.page=r),void 0!==o&&(this.initialParams.pageSize=o,this.extraResponse.pageSize=o),void 0!==s&&(this.extraResponse.initial=s),this.params={...this.initialParams},this.response={...mo.defaultResponse(),...this.extraResponse};const{page:i,pageSize:a,...h}=this.params,l={search:h};i&&(l.page=i),a&&(l.pageSize=a),this.response={...this.response,...l,search:{...this.response.search}}}setParams(e){let t={...this.params,...e};"function"==typeof e&&(t=e(this.params)),this.params=t,this.emit(fo.ParamsChange,{...this.params})}setDataSource(e){this.response.dataSource=e,this.emit(fo.StateChange,{...this.response})}async fetch(e,...t){this.response.loading=!0,this.emit(fo.LoadingChange,!0),this.emit(fo.StateChange,{...this.response});const n={...this.params,...e};let r=this.beforeRequest({...n},this.params);void 0===r&&(r=n);const o=[r,...t],s=await this.request.run(...o);if(this.response.error=null,this.response.loading=!1,this.response.search=lo({...n},["page","pageSize"]),this.response.initial&&(this.response.initial=!1),this.params={...r},this.emit(fo.LoadingChange,!1),this.emit(fo.ParamsChange,{...this.params}),this.emit(fo.Completed),s.error)return a.Err(s.error);const i=s.data;let h=this.processor(i);return void 0===h.dataSource&&(h.dataSource=[]),0!==this.extraDatSource.length&&!1===this.insertExtraDataSource&&(this.insertExtraDataSource=!0,h.dataSource=[...this.extraDatSource,...h.dataSource]),1===e.page&&0===h.dataSource.length&&(h.empty=!0),h.next_marker&&(this.params.next_marker=h.next_marker),a.Ok(h)}async init(e={}){const t=await this.fetch({...this.initialParams,...e});return t.error?(this.response.error=t.error,this.emit(fo.Error,t.error),this.emit(fo.StateChange,{...this.response}),a.Err(t.error)):(this.response={...this.response,...t.data},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"init"}),a.Ok({...this.response}))}async initAny(){return this.response.initial?this.init():(this.emit(fo.StateChange,{...this.response}),a.Ok(this.response))}async next(){const{page:e,...t}=this.params,n=await this.fetch({...t,page:e+1});return n.error?(this.response.error=n.error,this.emit(fo.Error,n.error),this.emit(fo.StateChange,{...this.response}),a.Err(n.error)):(this.response={...this.response,...n.data},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"next"}),a.Ok({...this.response}))}async prev(){const{page:e,...t}=this.params,n=await this.fetch({...t,page:e<=1?1:e-1});return n.error?(this.response.error=n.error,this.emit(fo.Error,n.error),this.emit(fo.StateChange,{...this.response}),a.Err(n.error)):(this.response={...this.response,...n.data},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"prev"}),a.Ok({...this.response}))}nextWithCursor(){}async loadMoreForce(){const{page:e,...t}=this.params,n=await this.fetch({...t,page:e+1});if(n.error)return this.response.error=n.error,this.emit(fo.Error,n.error),this.emit(fo.StateChange,{...this.response}),a.Err(n.error);0===n.data.dataSource.length&&(this.params.page-=1);const r=this.response.dataSource;return this.response={...this.response,...n.data},this.response.dataSource=r.concat(n.data.dataSource),this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceAdded,[...n.data.dataSource]),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"load_more"}),a.Ok({...this.response})}async loadMore(){if(this.response.loading||this.response.noMore)return;const{page:e,...t}=this.params,n=await this.fetch({...t,page:e+1});if(n.error)return this.response.error=n.error,this.emit(fo.Error,n.error),this.emit(fo.StateChange,{...this.response}),a.Err(n.error);const r=this.response.dataSource;return this.response={...this.response,...n.data},this.response.dataSource=r.concat(n.data.dataSource),this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceAdded,[...n.data.dataSource]),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"load_more"}),a.Ok({...this.response})}async goto(e,t){const{page:n,pageSize:r,...o}=this.params,s=await this.fetch({...o,page:e<=1?1:e,pageSize:void 0!==t?t:r});return s.error?(this.response.error=s.error,this.emit(fo.Error,s.error),this.emit(fo.StateChange,{...this.response}),a.Err(s.error)):(this.response={...this.response,...s.data},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"goto"}),a.Ok({...this.response}))}async search(...e){this.emit(fo.BeforeSearch);const t=await this.fetch({...this.initialParams,...e[0]});return this.emit(fo.AfterSearch,{params:e[0]}),t.error?(this.response.error=t.error,this.emit(fo.Error,t.error),this.emit(fo.StateChange,{...this.response}),a.Err(t.error)):(this.response={...this.response,...t.data},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"search"}),a.Ok({...this.response}))}searchDebounce=io(800,(...e)=>this.search(...e));async reset(e={}){this.params={...this.initialParams};const t=await this.fetch(e);return t.error?(this.response.error=t.error,this.emit(fo.Error,t.error),this.emit(fo.StateChange,{...this.response}),a.Err(t.error)):(this.response={...this.response,...t.data},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"reset"}),a.Ok({...this.response}))}async reload(){return await this.fetch({})}async refresh(){const{page:e,...t}=this.params;this.response.refreshing=!0,this.emit(fo.StateChange,{...this.response});const n=await this.fetch({...t,page:1,next_marker:""});return this.response.refreshing=!1,n.error?(this.response.error=n.error,this.emit(fo.Error,n.error),this.emit(fo.StateChange,{...this.response}),a.Err(n.error)):(this.response={...this.response,...n.data},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"refresh"}),a.Ok({...this.response}))}clear(){this.response={...ao},this.params={...ho},this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"clear"})}deleteItem(e){const{dataSource:t}=this.response,n=t.filter(t=>!e(t));this.response.total=n.length,this.response.dataSource=n,this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"manually"})}async deleteItems(e){const{dataSource:t}=this.response,n=t.filter(t=>!e.includes(t));this.response.total=n.length,this.response.dataSource=n,this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"manually"})}modifyItem(e){const{dataSource:t}=this.response,n=[];for(let r=0;r<t.length;r+=1){const o=t[r];let s=e(o);s||(s=o),n.push(s)}this.response.dataSource=n,this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"manually"})}replaceDataSource(e){this.response.dataSource=e,this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"manually"})}modifyDataSource(e){this.response.dataSource=this.response.dataSource.map(t=>e(t)),this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"manually"})}modifyResponse(e){this.response=e({...this.response}),this.emit(fo.StateChange,{...this.response}),this.emit(fo.DataSourceChange,{dataSource:[...this.response.dataSource],reason:"manually"})}modifyParams(e){this.params=e(this.params),this.emit(fo.ParamsChange,{...this.params})}modifySearch(e){this.params={...e(this.params),page:this.params.page,pageSize:this.params.pageSize},this.emit(fo.ParamsChange,{...this.params})}onStateChange(e){return this.on(fo.StateChange,e)}onLoadingChange(e){return this.on(fo.LoadingChange,e)}onBeforeSearch(e){return this.on(fo.BeforeSearch,e)}onAfterSearch(e){return this.on(fo.AfterSearch,e)}onDataSourceChange(e){return this.on(fo.DataSourceChange,e)}onDataSourceAdded(e){return this.on(fo.DataSourceAdded,e)}onError(e){return this.on(fo.Error,e)}onComplete(e){return this.on(fo.Completed,e)}}!function(e){e[e.Change=0]="Change",e[e.StateChange=1]="StateChange"}(go||(go={}));var yo=1,So=2,Co=4,vo=8,bo={L:1,M:0,Q:3,H:2},wo=0,xo=1,_o=2,ko=3,To=4,Oo=5,Po=6,Eo=7,Do={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo(e){let t=e<<10;for(;Do.getBCHDigit(t)-Do.getBCHDigit(Do.G15)>=0;)t^=Do.G15<<Do.getBCHDigit(t)-Do.getBCHDigit(Do.G15);return(e<<10|t)^Do.G15_MASK},getBCHTypeNumber(e){let t=e<<12;for(;Do.getBCHDigit(t)-Do.getBCHDigit(Do.G18)>=0;)t^=Do.G18<<Do.getBCHDigit(t)-Do.getBCHDigit(Do.G18);return e<<12|t},getBCHDigit(e){let t=0;for(;0!=e;)t++,e>>>=1;return t},getPatternPosition:e=>Do.PATTERN_POSITION_TABLE[e-1],getMask(e,t,n){switch(e){case wo:return(t+n)%2==0;case xo:return t%2==0;case _o:return n%3==0;case ko:return(t+n)%3==0;case To:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case Oo:return t*n%2+t*n%3==0;case Po:return(t*n%2+t*n%3)%2==0;case Eo:return(t*n%3+(t+n)%2)%2==0;default:throw new Error(`bad maskPattern:${e}`)}},getErrorCorrectPolynomial(e){let t=new Lo([1],0);for(let n=0;n<e;n++)t=t.multiply(new Lo([1,Mo.gexp(n)],0));return t},getLengthInBits(e,t){if(t>=1&&t<10)switch(e){case yo:return 10;case So:return 9;case Co:case vo:return 8;default:throw new Error(`mode:${e}`)}else if(t<27)switch(e){case yo:return 12;case So:return 11;case Co:return 16;case vo:return 10;default:throw new Error(`mode:${e}`)}else{if(!(t<41))throw new Error(`type:${t}`);switch(e){case yo:return 14;case So:return 13;case Co:return 16;case vo:return 12;default:throw new Error(`mode:${e}`)}}},getLostPoint(e){let t=e.getModuleCount(),n=0;for(var r=0;r<t;r++)for(var o=0;o<t;o++){let s=0,i=e.isDark(r,o);for(let n=-1;n<=1;n++)if(!(r+n<0||t<=r+n))for(let a=-1;a<=1;a++)o+a<0||t<=o+a||0==n&&0==a||i==e.isDark(r+n,o+a)&&s++;s>5&&(n+=3+s-5)}for(let r=0;r<t-1;r+=1)for(let o=0;o<t-1;o+=1){let t=0;e.isDark(r,o)&&t++,e.isDark(r+1,o)&&t++,e.isDark(r,o+1)&&t++,e.isDark(r+1,o+1)&&t++,(0==t||4==t)&&(n+=3)}for(r=0;r<t;r++)for(o=0;o<t-6;o++)e.isDark(r,o)&&!e.isDark(r,o+1)&&e.isDark(r,o+2)&&e.isDark(r,o+3)&&e.isDark(r,o+4)&&!e.isDark(r,o+5)&&e.isDark(r,o+6)&&(n+=40);for(o=0;o<t;o++)for(r=0;r<t-6;r++)e.isDark(r,o)&&!e.isDark(r+1,o)&&e.isDark(r+2,o)&&e.isDark(r+3,o)&&e.isDark(r+4,o)&&!e.isDark(r+5,o)&&e.isDark(r+6,o)&&(n+=40);let s=0;for(o=0;o<t;o++)for(r=0;r<t;r++)e.isDark(r,o)&&s++;return n+=10*(Math.abs(100*s/t/t-50)/5),n}},Mo={glog(e){if(e<1)throw new Error(`glog(${e})`);return Mo.LOG_TABLE[e]},gexp(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return Mo.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};(()=>{for(let e=0;e<8;e+=1)Mo.EXP_TABLE[e]=1<<e;for(let e=8;e<256;e+=1)Mo.EXP_TABLE[e]=Mo.EXP_TABLE[e-4]^Mo.EXP_TABLE[e-5]^Mo.EXP_TABLE[e-6]^Mo.EXP_TABLE[e-8];for(let e=0;e<255;e+=1)Mo.LOG_TABLE[Mo.EXP_TABLE[e]]=e})();var Lo=class e{num;constructor(e,t){if(void 0===e.length)throw new Error(`${e.length}/${t}`);let n=0;for(;n<e.length&&0===e[n];)n++;this.num=new Array(e.length-n+t);for(let t=0;t<e.length-n;t+=1)this.num[t]=e[t+n]}get(e){return this.num[e]}getLength(){return this.num.length}multiply(t){let n=new Array(this.getLength()+t.getLength()-1);for(let e=0;e<this.getLength();e++)for(let r=0;r<t.getLength();r++)n[e+r]^=Mo.gexp(Mo.glog(this.get(e))+Mo.glog(t.get(r)));return new e(n,0)}mod(t){if(this.getLength()-t.getLength()<0)return this;let n=Mo.glog(this.get(0))-Mo.glog(t.get(0)),r=new Array(this.getLength());for(let e=0;e<this.getLength();e++)r[e]=this.get(e);for(let e=0;e<t.getLength();e++)r[e]^=Mo.gexp(Mo.glog(t.get(e))+n);return new e(r,0).mod(t)}},Ao=class{mode;parsedData;data;constructor(e){this.mode=Co,this.data=e,this.parsedData=[];for(let e=0,t=this.data.length;e<t;e++){let t=[],n=this.data.charCodeAt(e);n>65536?(t[0]=240|(1835008&n)>>>18,t[1]=128|(258048&n)>>>12,t[2]=128|(4032&n)>>>6,t[3]=128|63&n):n>2048?(t[0]=224|(61440&n)>>>12,t[1]=128|(4032&n)>>>6,t[2]=128|63&n):n>128?(t[0]=192|(1984&n)>>>6,t[1]=128|63&n):t[0]=n,this.parsedData.push(t)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}getLength(){return this.parsedData.length}write(e){for(let t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}},Ro=class e{static PAD0=236;static PAD1=17;static createData=function(t,n,r){let o=Io.getRSBlocks(t,n),s=new No;for(let e=0;e<r.length;e+=1){let n=r[e];s.put(n.mode,4),s.put(n.getLength(),Do.getLengthInBits(n.mode,t)),n.write(s)}let i=0;for(let e=0;e<o.length;e+=1)i+=o[e].dataCount;if(s.getLengthInBits()>8*i)throw new Error(`code length overflow. (${s.getLengthInBits()}>${8*i})`);for(s.getLengthInBits()+4<=8*i&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*i||(s.put(e.PAD0,8),s.getLengthInBits()>=8*i));)s.put(e.PAD1,8);return e.createBytes(s,o)};static createBytes=function(e,t){let n=0,r=0,o=0,s=new Array(t.length),i=new Array(t.length);for(let a=0;a<t.length;a+=1){let h=t[a].dataCount,l=t[a].totalCount-h;r=Math.max(r,h),o=Math.max(o,l),s[a]=new Array(h);for(let t=0;t<s[a].length;t+=1)s[a][t]=255&e.buffer[t+n];n+=h;let u=Do.getErrorCorrectPolynomial(l),c=new Lo(s[a],u.getLength()-1).mod(u);i[a]=new Array(u.getLength()-1);for(let e=0;e<i[a].length;e+=1){let t=e+c.getLength()-i[a].length;i[a][e]=t>=0?c.get(t):0}}let a=0;for(let e=0;e<t.length;e+=1)a+=t[e].totalCount;let h=new Array(a),l=0;for(let e=0;e<r;e+=1)for(let n=0;n<t.length;n+=1)e<s[n].length&&(h[l++]=s[n][e]);for(var u=0;u<o;u++)for(var c=0;c<t.length;c++)u<i[c].length&&(h[l++]=i[c][u]);return h};typeNumber;errorCorrectLevel;modules=[];moduleCount;dataCache;dataList;constructor(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=[],this.moduleCount=0,this.dataCache=null,this.dataList=[]}addData(e){let t=new Ao(e);this.dataList.push(t),this.dataCache=null}isDark(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(`${e},${t}`);return this.modules[e][t]}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}makeImpl(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(let e=0;e<this.moduleCount;e++){this.modules[e]=new Array(this.moduleCount);for(let t=0;t<this.moduleCount;t++)this.modules[e][t]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)}setupPositionProbePattern(e,t){for(let n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(let r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[e+n][t+r]=n>=0&&n<=6&&(0==r||6==r)||r>=0&&r<=6&&(0==n||6==n)||n>=2&&n<=4&&r>=2&&r<=4)}getBestMaskPattern(){let e=0,t=0;for(let n=0;n<8;n++){this.makeImpl(!0,n);let r=Do.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t}setupTimingPattern(){for(let e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(let e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)}setupPositionAdjustPattern(){let e=Do.getPatternPosition(this.typeNumber);for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++){let r=e[t],o=e[n];if(null==this.modules[r][o])for(let e=-2;e<=2;e++)for(let t=-2;t<=2;t++)this.modules[r+e][o+t]=-2==e||2==e||-2==t||2==t||0==e&&0==t}}setupTypeNumber(e){let t=Do.getBCHTypeNumber(this.typeNumber);for(var n=0;n<18;n++){var r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++){r=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}}setupTypeInfo(e,t){let n=this.errorCorrectLevel<<3|t,r=Do.getBCHTypeInfo(n);for(var o=0;o<15;o++){var s=!e&&1==(r>>o&1);o<6?this.modules[o][8]=s:o<8?this.modules[o+1][8]=s:this.modules[this.moduleCount-15+o][8]=s}for(o=0;o<15;o++){s=!e&&1==(r>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=s:o<9?this.modules[8][15-o-1+1]=s:this.modules[8][15-o-1]=s}this.modules[this.moduleCount-8][8]=!e}mapData(e,t){let n=-1,r=this.moduleCount-1,o=7,s=0;for(let i=this.moduleCount-1;i>0;i-=2)for(6==i&&i--;;){for(let n=0;n<2;n++)if(null==this.modules[r][i-n]){let a=!1;s<e.length&&(a=1==(e[s]>>>o&1)),Do.getMask(t,r,i-n)&&(a=!a),this.modules[r][i-n]=a,o--,-1==o&&(s++,o=7)}if(r+=n,r<0||this.moduleCount<=r){r-=n,n=-n;break}}}},Io=class e{static RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];static getRSBlocks=function(t,n){let r=e.getRsBlockTable(t,n);if(null==r)throw new Error(`bad rs block @ typeNumber:${t}/errorCorrectLevel:${n}`);let o=r.length/3,s=[];for(let t=0;t<o;t++){let n=r[3*t+0],o=r[3*t+1],i=r[3*t+2];for(let t=0;t<n;t++)s.push(new e(o,i))}return s};static getRsBlockTable=function(t,n){switch(n){case bo.L:return e.RS_BLOCK_TABLE[4*(t-1)+0];case bo.M:return e.RS_BLOCK_TABLE[4*(t-1)+1];case bo.Q:return e.RS_BLOCK_TABLE[4*(t-1)+2];case bo.H:return e.RS_BLOCK_TABLE[4*(t-1)+3];default:return}};totalCount;dataCount;constructor(e,t){this.totalCount=e,this.dataCount=t}},No=class{length;buffer;constructor(){this.buffer=[],this.length=0}get(e){let t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)}put(e,t){for(let n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))}getLengthInBits(){return this.length}putBit(e){let t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},$o=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function Fo(e,t){let n=1,r=function(e){let t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e);for(let e=0,o=$o.length;e<=o;e++){let o=0;switch(t){case bo.L:o=$o[e][0];break;case bo.M:o=$o[e][1];break;case bo.Q:o=$o[e][2];break;case bo.H:o=$o[e][3]}if(r<=o)break;n++}if(n>$o.length)throw new Error("Too long data");return n}var Bo=class{static CorrectLevel=bo;_htOption;_oQRCode=null;constructor(e){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:bo.H,text:""};let t="string"==typeof e?{text:e}:e||{};for(let e in t)this._htOption[e]=t[e];this._oQRCode=null}fetchModel(e,t={}){return[void 0,null,""].includes(e)?(console.error("二维码内容不能为空"),null):(this._oQRCode=new Ro(Fo(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._oQRCode)}};class Ho{ctx;isPainted=!1;options;constructor(e){const{ctx:t}=e;this.options=e,this.ctx=t}draw(e){const{ctx:t}=this,{options:n}=this,r=e.getModuleCount(),o=n.width/r,s=n.height/r,i=Math.round(o),a=Math.round(s);console.log("count",r,i,a),this.clear();for(let n=0;n<r;n++)for(let h=0;h<r;h++){const r=e.isDark(n,h),l=h*o,u=n*s;t.strokeStyle=r?"#000000":"#ffffff",t.lineWidth=1,t.fillStyle=r?"#000000":"#ffffff",t.fillRect(l,u,o,s),t.strokeRect(Math.floor(l)+.5,Math.floor(u)+.5,i,a),t.strokeRect(Math.ceil(l)-.5,Math.ceil(u)-.5,i,a)}this.isPainted=!0}clear(){this.ctx.clearRect(0,0,this.options.width,this.options.height),this.isPainted=!1}round(e){return e?Math.floor(1e3*e)/1e3:e}}let jo=null;let Vo=null;const Uo={get(e,t,n={}){const{headers:r}=n,o={url:[e,t?"?"+mn(t):""].join(""),method:"GET",headers:r};return Vo&&Vo(o),o},post(e,t,n={}){const{headers:r}=n,o={url:e,method:"POST",body:t,headers:r};return jo&&jo(o),o}};var qo,Wo=Object.freeze({__proto__:null,onCreateGetPayload:function(e){Vo=e},onCreatePostPayload:function(e){jo=e},request:Uo,request_factory:function(e={}){const{hostnames:t={}}=e;let n=t.prod||"",r=e.headers??{},o="prod",s=e.debug??!1;return{getHostname:()=>n,setHostname(e){s&&console.log("[REQUEST]utils - setHostname",e),n=e},setHeaders(e){s&&console.log("[REQUEST]utils - setHeaders",e),r=e},deleteHeaders(e){delete r[e]},appendHeaders(e){s&&console.log("[REQUEST]utils - appendHeaders",e),r={...r,...e}},setEnv(e){s&&console.log("[REQUEST]utils - setEnv",e);const{prod:r="",dev:i=r,test:a=r,beta:h=r}=t;o=e,"dev"===e&&(n=i),"test"===e&&(n=a),"beta"===e&&(n=h),"prod"===e&&(n=r)},setDebug(e){s=e},get(...t){const i=Uo.get(...t),{url:a,method:h,query:l,params:u,body:c,headers:d}=i;s&&(console.log("create GET payload"),console.log(i),console.log("current hostname is",n),console.log("current headers is",d),console.log("current env is",o));return{hostname:n,url:a,method:h,query:l,params:u,body:c,headers:{...i.headers,...r},process:e.process}},post(...t){const o=Uo.post(...t),{url:i,method:a,query:h,params:l,body:u={}}=o;s&&(console.log("create POST payload"),console.log(o),console.log("current hostname is",n),console.log("current headers is",r));return{hostname:n,url:i,method:a,query:h,params:l,body:u,headers:{...o.headers,...r},process:e.process}}}}});!function(e){e[e.StateChange=0]="StateChange"}(qo||(qo={}));class zo{connection="unknown";constructor(){"undefined"!=typeof window&&(this.connection=this.query_network())}query_network(){if(navigator.connection)return navigator.connection.type;const e=navigator.userAgent.match(/NetType\/(\S*)/);return e?e[1]:"unknown"}}const Yo=new zo;function Ko(e={}){const t={refresh(){u.emit(n.StateChange,{...l})},register(e){const t=Object.keys(e);for(let n=0;n<t.length;n+=1){const o=t[n],s=o.split(",");for(let t=0;t<s.length;t+=1)r[s[t]]=e[o]}},clearPressedKeys(){null!==h&&(clearTimeout(h),h=null),h=setTimeout(()=>{s=[]},200)},invokeHandlers(e,t){const n=r[t];n&&n(e)},buildShortcut:()=>({key1:Object.keys(a).join("+"),key2:s.join("")}),setRecordingCodes(e){console.log("[DOMAIN]shortcut - setRecordingCodes",e),e.split("+").forEach(e=>{i[e]=!0}),t.refresh()},reset(){a={},i={},t.refresh()},testShortcut(e,t){const{key1:n,key2:o,step:s}=e;if("keydown"===s&&n.includes("+")){const e=r[n];if(e)return t.step=s,void e(t)}if("keydown"===s&&o){const e=r[o];return void(e&&e(t))}},handleKeydown(e){s.join("")===e.code&&r[[e.code,e.code].join("")]?s.push(e.code):s=[e.code],a[e.code]=!0,i[e.code]=!0,t.refresh(),t.testShortcut({...t.buildShortcut(),step:"keydown"},e),t.clearPressedKeys()},handleKeyup(r,o={}){t.testShortcut({...t.buildShortcut(),step:"keyup"},r),["MetaLeft","MetaRight"].includes(r.code)&&(a={}),delete a[r.code],0===Object.keys(a).length&&"recording"===e.mode&&u.emit(n.ShortcutComplete,{codes:Object.keys(i)}),t.refresh()}};let n,r={},s=[],i={},a={},h=null,l={get codes(){return Object.keys(a)},get codes2(){return Object.keys(i)}};!function(e){e[e.Shortcut=0]="Shortcut",e[e.Keydown=1]="Keydown",e[e.ShortcutComplete=2]="ShortcutComplete",e[e.StateChange=3]="StateChange",e[e.Error=4]="Error"}(n||(n={}));const u=o();return{methods:t,ui:{},state:l,ready(){},destroy(){u.destroy()},onShortcut:e=>()=>{},onShortcutComplete:e=>u.on(n.ShortcutComplete,e),onStateChange:e=>u.on(n.StateChange,e),onError:e=>u.on(n.Error,e)}}var Go,Qo;function Jo(e){const t={refresh(){s.emit(n.StateChange,{...r})}};let n,r={};!function(e){e[e.StateChange=0]="StateChange",e[e.Error=1]="Error"}(n||(n={}));const s=o();return{methods:t,ui:{},state:r,ready(){},destroy(){s.destroy()},onStateChange:e=>s.on(n.StateChange,e),onError:e=>s.on(n.Error,e)}}function Xo(e,t,n){return 0===t.length?e:e.substring(0,n)+e.substring(n+t.length)}function Zo(e,t,n){return""===e?t:e.substring(0,n)+t+e.substring(n)}!function(e){e.Text="text",e.Paragraph="paragraph"}(Go||(Go={})),function(e){e.InsertText="insert_text",e.ReplaceText="replace_text",e.RemoveText="remove_text",e.InsertLines="insert_line",e.RemoveLines="remove_lines",e.MergeNode="merge_node",e.SplitNode="split_node",e.SetSelection="set_selection",e.Unknown="unknown"}(Qo||(Qo={})),Jo.isSamePoint=function(e,t){return e.path.join("_")===t.path.join("_")&&e.offset===t.offset},Jo.isAtLineHead=function(e){return 0===e.offset},Jo.isAtFirstLineHead=function(e){return 0===e.path[0]&&0===e.offset};const es={insertText(e,t){if(t.type!==Qo.InsertText)return e;const n=ts(e,t.path);return n&&n.type===Go.Text&&(n.text=Zo(n.text,t.text,t.offset)),e},replaceText(e,t){if(t.type!==Qo.ReplaceText)return e;const n=ts(e,t.path);return n&&n.type===Go.Text&&(n.text=Zo(t.original_text,t.text,t.offset)),e},removeText(e,t){if(t.type!==Qo.RemoveText)return e;const n=ts(e,t.path);if(!n||n.type!==Go.Text)return e;const r=n.text;return n.text=Xo(r,t.text,t.offset),e},splitNode(e,t){if(t.type!==Qo.SplitNode)return e;const n=ts(e,t.path);if(!n||n.type!==Go.Text)return e;const r=n.text,o=r.slice(0,t.offset),s=r.slice(t.offset);n.text=o;const i={type:Go.Paragraph,children:[{type:Go.Text,text:s}]},a=t.path[0]+1,h=t.path[0]+1;return console.log("[op.node]before insert created_node",e,a,h),[...e.slice(0,a),i,...e.slice(h)]},mergeNode(e,t){if(t.type!==Qo.MergeNode)return e;const n=ts(e,t.path),r=ts(e,t.end.path);return n&&r&&n.type===Go.Text&&r.type===Go.Text&&(n.text=n.text+r.text,e=rs.removeLine(e,t.end.path[0])),e},insertLines:(e,t)=>t.type!==Qo.InsertLines?e:[...e.slice(0,t.path[0]+1),...t.node,...e.slice(t.path[0]+1)],removeLines:(e,t)=>t.type!==Qo.RemoveLines?e:[...e.slice(0,t.path[0]),...e.slice(t.path[0]+t.node.length)],exec:(e,t)=>t.type===Qo.InsertText?es.insertText(e,t):t.type===Qo.ReplaceText?es.replaceText(e,t):t.type===Qo.RemoveText?es.removeText(e,t):t.type===Qo.InsertLines?es.insertLines(e,t):t.type===Qo.RemoveLines?es.removeLines(e,t):t.type===Qo.MergeNode?es.mergeNode(e,t):t.type===Qo.SplitNode?es.splitNode(e,t):e};function ts(e,t){let n=0,r=e[t[n]];if(!r)return null;for(;n<t.length-1;)n+=1,r.type===Go.Paragraph&&(r=r.children[t[n]]);return r??null}var ns=Object.freeze({__proto__:null,SlateNodeOperations:es,findNodeByPathWithNode:ts});function rs(){const e={refresh(){h.emit(i.StateChange,{...a})},moveForward(r={}){const{step:o=1,collapse:s=!0}=r;t.offset+=o,n.offset=t.offset,e.setStartAndEnd({start:t,end:n})},moveBackward(r={}){const{step:o=1,min:s=0}=r;t.offset-=o,t.offset<s&&(t.offset=s),n.offset=t.offset,e.setStartAndEnd({start:t,end:n})},moveToPrevLineHead(){t={path:[t.path[0]-1,0],offset:0},n={...t},e.refresh()},calcNextLineHead(){const e={path:[t.path[0]+1,0],offset:0};return{start:e,end:{...e}}},moveToNextLineHead(){const r=e.calcNextLineHead();t=r.start,n=r.end,e.refresh()},collapseToHead(){n={...t},e.setStartAndEnd({start:t,end:n})},collapseToEnd(){t={...n},e.setStartAndEnd({start:t,end:n})},collapseToOffset(r){t.offset=r.offset,n={...t},e.setStartAndEnd({start:t,end:n})},setToHead(){t={path:[0],offset:0},n={path:[0],offset:0},e.refresh()},setStartAndEnd(o){t={...o.start},n={...o.end},r=Jo.isSamePoint(o.start,o.end),s=!0,setTimeout(()=>{s=!1},0),e.refresh()},handleChange(o){t=o.start,n=o.end,r=o.collapsed,e.refresh()}};let t={path:[],offset:0},n={path:[],offset:0},r=!0,s=!1;let i,a={get start(){return{...t,line:t.path[0]}},get end(){return{...n,line:n.path[0]}},get collapsed(){return r},get dirty(){return s}};!function(e){e[e.StateChange=0]="StateChange",e[e.Error=1]="Error"}(i||(i={}));const h=o();return{methods:e,ui:{},state:a,get dirty(){return a.dirty},get start(){return a.start},get end(){return a.end},get collapsed(){return a.collapsed},print:()=>({start:`line: ${t.path[0]} col: ${t.offset}`,end:`line: ${n.path[0]} col: ${n.offset}`}),ready(){},destroy(){h.destroy()},onStateChange:e=>h.on(i.StateChange,e),onError:e=>h.on(i.Error,e)}}function os(){const e={refresh(){a.emit(t.StateChange,{...i})},mark(){s=!0},push(t,n){const o=r[r.length-1];o&&o.operations[o.operations.length-1];let i=!1;if(o?0!=o.operations.length&&(i=!0):i=!1,s&&(i=!1,s=!1),o&&i)o.operations.push(...t);else{const e={operations:t,selectionBefore:n};r.push(e)}console.log("[]slate/history - push",r),e.refresh()},undo(){const e=r[r.length-1];console.log("[]slate/history - undo after .last(",e);const t=e?e.operations.reverse():[],n=[];for(let e=0;e<t.length;e+=1){const r=t[e];switch(r.type){case Qo.InsertText:n.push({type:Qo.RemoveText,text:r.text,original_text:"",path:r.path,offset:r.offset});break;case Qo.RemoveText:n.push({type:Qo.InsertText,text:r.text,original_text:"",path:r.path,offset:r.offset});break;case Qo.InsertLines:n.push({type:Qo.RemoveLines,node:r.node,path:[r.path[0]+1]});break;case Qo.RemoveLines:n.push({type:Qo.InsertLines,node:r.node,path:[r.path[0]-1]});break;case Qo.SplitNode:n.push({type:Qo.MergeNode,path:r.path,offset:r.offset,start:{path:r.start.path,offset:r.start.offset},end:{path:r.end.path,offset:r.end.offset}});break;case Qo.MergeNode:n.push({type:Qo.SplitNode,path:r.path,offset:r.offset,start:{path:r.start.path,offset:r.start.offset},end:{path:r.end.path,offset:r.end.offset}})}}return r.pop(),console.log("[]slate/history - undo before return(",n),{operations:n,selection:e?.selectionBefore??null}}};let t,n=[],r=[],s=!1,i={get stacks(){return n.map(e=>({type:e.type,created_at:e.created_at}))}};!function(e){e[e.StateChange=0]="StateChange",e[e.Error=1]="Error"}(t||(t={}));const a=o();return{methods:e,ui:{},state:i,ready(){},destroy(){a.destroy()},onStateChange:e=>a.on(t.StateChange,e),onError:e=>a.on(t.Error,e)}}function ss(e){const t={refresh(){s.emit(n.StateChange,{...r})}};let n,r={};!function(e){e[e.StateChange=0]="StateChange",e[e.Error=1]="Error"}(n||(n={}));const s=o();return{methods:t,ui:{},state:r,ready(){},destroy(){s.destroy()},onStateChange:e=>s.on(n.StateChange,e),onError:e=>s.on(n.Error,e)}}rs.getLineLastPoint=function(e,t){const n=[t];let r=0,o=e[t];for(;o;)o.type===Go.Paragraph?(n.push(o.children.length-1),o=o.children[o.children.length-1]):o.type===Go.Text&&(r=o.text.length,o=null);return{path:n,offset:r}},rs.getLineLastNode=function(e,t){const n=[t];let r=0,o=e[t],s=o;for(;o;)o.type===Go.Paragraph?(n.push(o.children.length-1),o=o.children[o.children.length-1]):o.type===Go.Text&&(r=o.text.length,s=o,o=null);return{path:n,offset:r,node:s}},rs.getLineFirstNode=function(e,t){const n=[t];let r=e[t],o=r;for(;r;)r.type===Go.Paragraph?(n.push(0),r=r.children[0]):r.type===Go.Text&&(o=r,r=null);return{path:n,offset:0,node:o}},rs.isCaretAtLineEnd=function(e,t){const n=ts(e,t.path);return!!n&&(n.type===Go.Text&&t.offset===n.text.length)},rs.isCaretAtLineHead=function(e,t){const n=ts(e,t.path);return!!n&&(n.type===Go.Text&&0===t.offset)},rs.removeLine=function(e,t){return[...e.slice(0,t),...e.slice(t+1)]},rs.removeLinesBetweenStartAndEnd=function(e,t,n){return[...e.slice(0,t.path[0]+1),...e.slice(n.path[0]+1)]},rs.removeNode=function(e,t){},ss.isPath=function(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])},ss.equals=function(e,t){return e.length===t.length&&e.every((e,n)=>e===t[n])},ss.previous=function(e){const t=e[e.length-1];return e.slice(0,-1).concat(t-1)},ss.endsBefore=function(e,t){const n=e.length-1,r=e.slice(0,n),o=t.slice(0,n),s=e[n],i=t[n];return ss.equals(r,o)&&s<i},ss.compare=function(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return 0},ss.isAncestor=function(e,t){return e.length<t.length&&0===ss.compare(e,t)},ss.parent=function(e){return e.slice(0,-1)},ss.isSameParent=function(e,t){const n=e.length-1,r=e.slice(0,n),o=t.slice(0,n);return ss.equals(r,o)};const is=e=>"object"==typeof e&&null!==e;function as(e,t){for(const n of e){if(n.key===t)return n;if(n.type===Go.Paragraph&&n.children){const e=as(n.children,t);if(e)return e}}return null}function hs(e){return is(e)&&"string"==typeof e.text}function ls(e,t={}){const{deep:n=!1}=t;if(!is(e))return!1;if("function"==typeof e.apply)return!1;const r=n?function(e){return Array.isArray(e)&&e.every(e=>function(e,t){return hs(e)||ls(e,t)}(e,{deep:!0}))}(e.children):Array.isArray(e.children);return r}const us=function(){let e=0;return function(){return e+=1,e}}();function cs(e){return e&&0!==e.length?e.map(e=>{const t=us();return e.type===Go.Text?{...e,key:t}:e.type===Go.Paragraph?{...e,key:t,children:cs(e.children)}:{...e,key:t}}):[{key:us(),type:Go.Paragraph,children:[{key:us(),type:Go.Text,text:""}]}]}const ds={insertText(e,t){if(t.type!==Qo.InsertText)return;const n=bs(e,t.path);if(console.log("[op.dom]insertText 1.",n?.nodeName,t.path,t.offset,t.text,t.original_text),!n)return;const r=ms(n);console.log("[op.dom]insertText 2. content in current node",r);const o=Zo(r,t.text,t.offset);if("BR"===n.nodeName&&n.parentNode){const e=document.createElement("span");e.textContent=o,n.parentNode.replaceChild(e,n)}else"#text"===n.nodeName&&n.parentElement?n.parentElement.innerHTML=`<span data-slate-node="text">${o}</span>`:n.textContent=o},replaceText(e,t){if(t.type!==Qo.ReplaceText)return;const n=bs(e,t.path);console.log("[op.dom]replaceText 1.",n?.nodeName,t.path,t.offset,t.text,t.original_text),n&&(n.textContent=Zo(t.original_text,t.text,t.offset))},removeText(e,t){if(t.type!==Qo.RemoveText)return;const n=bs(e,t.path);if(console.log("[op.dom]deleteText 1. find $target",t.original_text,t.text),!n||t.ignore)return;const r=ms(n);console.log("[op.dom]deleteText 2. content in current node",r),n.innerHTML=Ss(Xo(r,t.text,t.offset))},splitNode(e,t){if(t.type!==Qo.SplitNode)return;const n=bs(e,t.path);if(!n)return;const r=ms(n);console.log("[op.dom]splitNode - 1. original text",r);const o=r.slice(0,t.offset),s=r.slice(t.offset);console.log("[op.dom]splitNode - 2. split",o,s),n.textContent=Ss(o),Cs(e,{node:{type:Go.Paragraph,children:[{type:Go.Text,text:s}]},path:[t.path[0]]})},mergeNode(e,t){if(t.type!==Qo.MergeNode)return;const n=bs(e,t.path),r=bs(e,t.end.path);if(console.log("[op.dom]mergeNode 0. find nodes",n,r),!n||!r)return;const o=ms(n),s=ms(r);if(r){const e=r.parentElement;r.remove(),e&&0===e.childNodes.length&&e.remove()}const i=o+s;n.textContent=i},insertLines(e,t){t.type===Qo.InsertLines&&vs(e,t)},removeLines(e,t){if(t.type!==Qo.RemoveLines)return;const n=bs(e,[t.path[0]]);if(!n)return;if(!n.parentNode)return;const r=n.parentNode,o=t.node.length;console.log("[op.dom]removeLines - ",o);let s=t.path[0];const i=[];for(let e=0;e<o;e+=1)console.log("[op.dom]removeLines - ",e,s,r),i.push(r.childNodes[s]),s+=1;for(let e=0;e<i.length;e+=1)i[e].remove()},exec(e,t){t.type!==Qo.InsertText?t.type!==Qo.ReplaceText?t.type!==Qo.RemoveText?t.type!==Qo.InsertLines?t.type!==Qo.RemoveLines?t.type!==Qo.MergeNode?t.type!==Qo.SplitNode||ds.splitNode(e,t):ds.mergeNode(e,t):ds.removeLines(e,t):ds.insertLines(e,t):ds.removeText(e,t):ds.replaceText(e,t):ds.insertText(e,t)}};function ps(e,t={}){if(e.type===Go.Text){const n=document.createElement("span");return n.setAttribute("data-slate-node","text"),e.key&&n.setAttribute("data-slate-node-key",String(e.key)),t.text?n.textContent=e.text:n.innerHTML=Ss(e.text),n}return null}function fs(e,t={}){if(e.type!==Go.Paragraph)return null;const n=document.createElement("p");n.setAttribute("data-slate-node","element"),e.key&&n.setAttribute("data-slate-node-key",String(e.key));const r=document.createDocumentFragment();for(let n=0;n<e.children.length;n+=1){const o=e.children[n];if(o.type===Go.Text){const o=ps(e.children[n],t);o&&r.appendChild(o)}if(o.type===Go.Paragraph){const o=fs(e.children[n],t);o&&r.appendChild(o)}}return n.appendChild(r),n}const gs="<br>";function ms(e){if("#text"===e.nodeName)return e;return ys(e.textContent)}function ys(e){return e===gs?"":e}function Ss(e){return""===e?gs:e}function Cs(e,t){console.log("[SlateView]renderNodeThenInsertLine - ",t.node,t.path);const n=fs(t.node);if(!n)return;const r=t.path[0]+1;r>e.children.length-1?e.appendChild(n):(console.log("[SlateView]renderNodeThenInsertLine - insertBefore",n,e.childNodes[r]),e.insertBefore(n,e.children[r]))}function vs(e,t){console.log("[SlateView]renderNodeThenInsertLine - ",t.node,t.path);const n=document.createDocumentFragment();for(let e=0;e<t.node.length;e+=1){const r=fs(t.node[e]);r&&n.appendChild(r)}const r=t.path[0]+1;r>e.children.length-1?e.appendChild(n):(console.log("[SlateView]renderNodeThenInsertLine - insertBefore",e.childNodes[r]),e.insertBefore(n,e.children[r]))}function bs(e,t){if(0===t.length)return e;const n=e.childNodes[t[0]];return n?bs(n,t.slice(1)):null}var ws,xs=Object.freeze({__proto__:null,SlateDOMOperations:ds,buildInnerHTML:function(e,t=[],n=0){const r=document.createDocumentFragment();for(let t=0;t<e.length;t+=1){const n=e[t];if(hs(n)){const e=ps(n);e&&r.appendChild(e)}else if(ls(n)){const e=fs(n);e&&r.appendChild(e)}}return r},findInnerTextNode:function(e){if(!e)return null;for(;e;){if("SPAN"===e.tagName)return e;if(!(e=e.childNodes[0]))return null}return null},findNodeByPathWithElement:bs,formatInnerHTML:ys,getNodePath:function(e,t){const n=[];let r=e;for(;r&&r!==t;){const e=r.parentNode;if(!e)break;const t=Array.from(e.children).indexOf(r);-1!==t&&n.unshift(t),r=e}return n},getNodeText:ms,refreshSelection:function(e,t,n){const r=bs(e,t.path),o=bs(e,n.path);if(!r||!o)return;const s=window.getSelection();if(!s)return;const i=document.createRange();if(console.log("[]refresh selection - start",r,r.childNodes[0],t.offset),console.log("[]refresh selection - end",o.childNodes[0],n.offset),""===r.textContent){const e=r.childNodes[0];console.log("[]refresh selection - find $br",r.parentElement,e),i.setStartBefore(e),i.setEndBefore(e)}else i.setStart(r.childNodes[0],t.offset),i.setEnd(o.childNodes[0],n.offset);s.removeAllRanges(),s.addRange(i)},renderElement:fs,renderHTML:Ss,renderLineNodesThenInsert:vs,renderNodeThenInsertLine:Cs,renderText:ps});e.BizFileType=void 0,(ws=e.BizFileType||(e.BizFileType={}))[ws.File=1]="File",ws[ws.Folder=2]="Folder",e.ApplicationModel=class extends s{$user;$storage;lifetimes;ready=!1;screen={width:0,height:0};env={wechat:!1,ios:!1,android:!1,pc:!1,weapp:!1,prod:"develop"};orientation=h.Vertical;curDeviceSize="md";height=0;theme="system";safeArea=!1;Events=f;get state(){return{ready:this.ready,theme:this.theme,env:this.env,deviceSize:this.curDeviceSize,height:this.height}}constructor(e){super();const{user:t,storage:n,beforeReady:r,onReady:o}=e;this.$user=t,this.$storage=n,this.lifetimes={beforeReady:r,onReady:o}}async start(e){const{width:t,height:n}=e;this.screen={...this.screen,width:t,height:n},this.curDeviceSize=p(t);const{beforeReady:r}=this.lifetimes;if(r){const e=await r();if(e.error)return a.Err(e.error)}return this.ready=!0,this.emit(f.Ready),this.emit(f.StateChange,{...this.state}),a.Ok(null)}setTheme(e){const t="请在 connect.web 中实现 setTheme 方法";return console.warn(t),a.Err(t)}getTheme(){return console.warn("请在 connect.web 中实现 getTheme 方法"),"light"}tipUpdate(){this.emit(f.ForceUpdate)}tip(e){return this.emit(f.Tip,e),e.text.join("\n")}loading(e){return this.emit(f.Loading,e),{hideLoading:()=>{this.emit(f.HideLoading)}}}hideLoading(){this.emit(f.HideLoading)}vibrate(){}setSize(e){this.screen=e}setTitle(e){throw new Error("请实现 setTitle 方法")}openWindow(e){throw new Error("请实现 openWindow 方法")}setEnv(e){this.env={...this.env,...e}}setHeight(e){this.height=e,this.emit(f.StateChange,{...this.state})}copy(e){throw new Error("请实现 copy 方法")}getComputedStyle(e){throw new Error("请实现 getComputedStyle 方法")}notify(e){console.log("请实现 notify 方法")}disablePointer(){throw new Error("请实现 disablePointer 方法")}enablePointer(){throw new Error("请实现 enablePointer 方法")}keydown(e){"Escape"===e.code&&this.escape(),this.emit(f.Keydown,e)}escape(){this.emit(f.EscapeKeyDown)}resize(e){this.screen=e,this.emit(f.Resize,e)}blur(){this.emit(f.Blur)}handleScreenOrientationChange(e){if(0===e)return this.orientation=h.Vertical,void this.emit(f.OrientationChange,this.orientation);this.orientation=h.Horizontal,this.emit(f.OrientationChange,this.orientation)}handleResize(e){this.screen=e;const t=p(e.width);t!==this.curDeviceSize&&(this.curDeviceSize=t,this.emit(f.DeviceSizeChange,this.curDeviceSize)),this.emit(f.Resize,e)}onReady(e){return this.on(f.Ready,e)}onDeviceSizeChange(e){return this.on(f.DeviceSizeChange,e)}onUpdate(e){return this.on(f.ForceUpdate,e)}onOrientationChange(e){return this.on(f.OrientationChange,e)}onResize(e){return this.on(f.Resize,e)}onBlur(e){return this.on(f.Blur,e)}onShow(e){return this.on(f.Show,e)}onHidden(e){return this.on(f.Hidden,e)}onKeydown(e){return this.on(f.Keydown,e)}onEscapeKeyDown(e){return this.on(f.EscapeKeyDown,e)}onTip(e){return this.on(f.Tip,e)}onLoading(e){return this.on(f.Loading,e)}onHideLoading(e){return this.on(f.HideLoading,e)}onStateChange(e){return this.on(f.StateChange,e)}onError(e){return this.on(f.Error,e)}},e.BaseDomain=s,e.BizError=i,e.CanvasDrawing=Ho,e.CurSystem=zo,e.FileBrowserModel=function(t){const n={refresh(){p.emit(d.StateChange,{...c})},createColumn(e){const n=new mo(new so(t.service,{client:t.client,onFailed:e=>{p.emit(d.Error,new i([e.message]))}}),{pageSize:50,search:{...t.extra||{},...e}});n.onStateChange(e=>{e.error?p.emit(d.Error,new i([e.error.message])):!1===e.initial&&(s=!0)}),n.onLoadingChange(e=>{r=e,p.emit(d.LoadingChange,e)});const o=new gr({async onReachBottom(){await n.loadMore(),o.finishLoadingMore()}});n.init();return{list:n,view:o}},appendColumn(e){u.push(n.createColumn(e)),p.emit(d.FoldersChange,[...u])},replaceColumn(e,t){u=[...u.slice(0,t+1),n.createColumn(e)],p.emit(d.FoldersChange,[...u])},clearFolderColumns(){u=[],p.emit(d.FoldersChange,[...u])},select(t,r){a=t,p.emit(d.SelectFolder,[t,r]);const[o,s]=r,i=u[o].list.response.dataSource[s];t.type!==e.BizFileType.File&&(o<u.length-1?n.replaceColumn(t,o):n.appendColumn(i),l=(()=>{if(l[o+1]){const e=l.slice(0,o+2);return e[o+1]=t,e}return l.concat(i)})(),p.emit(d.PathsChange,[...l]))},virtualSelect(e,t){p.emit(d.SelectFolder,[e,t]);const[n,r]=t,o=u[n];h=o,o.list.modifyItem(t=>({...t,hover:t.id===e.id}))},clear(){a=null},clearVirtualSelected(){if(!h)return;const e=h;h=null,e.list.modifyItem(e=>({...e,hover:!1}))}};let r=!1,s=!1,a=null,h=null,l=t.paths||[{id:"root",type:e.BizFileType.Folder,filename:"文件",filepath:"/"}],u=[];const c={get loading(){return r},get initialized(){return s},get curFolder(){return a},get paths(){return l},get columns(){return u}};let d;!function(e){e[e.Initialized=0]="Initialized",e[e.FoldersChange=1]="FoldersChange",e[e.PathsChange=2]="PathsChange",e[e.SelectFolder=3]="SelectFolder",e[e.LoadingChange=4]="LoadingChange",e[e.StateChange=5]="StateChange",e[e.Error=6]="Error"}(d||(d={}));const p=o();return{methods:n,state:c,onFolderColumnChange:e=>p.on(d.FoldersChange,e),onPathsChange:e=>p.on(d.PathsChange,e),onSelectFolder:e=>p.on(d.SelectFolder,e),onLoadingChange:e=>p.on(d.LoadingChange,e),onError:e=>p.on(d.Error,e),onStateChange:e=>p.on(d.StateChange,e)}},e.HistoryCore=class extends s{virtual=!1;routes;views;stacks=[];cursor=-1;$router;$view;get state(){return{href:this.$router.href,stacks:this.stacks.map(e=>{const{id:t,pathname:n,title:r,query:o,visible:s}=e;return{id:[n,mn(o)].filter(Boolean).join("?"),key:n,title:r,query:JSON.stringify(o,null,2),visible:s}}),cursor:this.cursor}}constructor(e){super(e);const{virtual:t=!1,view:n,router:r,routes:o,views:s}=e;this.$view=n,this.$router=r,this.routes=o,this.views=s,this.virtual=t}push(e,t={},n={}){const{ignore:r}=n;if(this.isLayout(e))return void console.log("[DOMAIN]history/index - the target url is layout",e);const o=this.routes[e];if(!o)return void console.log("[DOMAIN]history/index - push 2. no matched route",e);const s=[o.pathname,mn(t)].filter(Boolean).join("?");if(s===this.$router.href)return;const i=this.views[s];if(i)return this.ensureParent(i),i.query=t,i.parent?(this.$router.href=i.href,this.$router.name=i.name,this.stacks=this.stacks.slice(0,this.cursor+1).concat(i),this.cursor+=1,i.parent.showView(i,{reason:"show_sibling",destroy:!1}),this.emit(wn.RouteChange,{reason:"push",view:i,name:e,href:i.href,pathname:i.pathname,query:i.query,ignore:r}),void this.emit(wn.StateChange,{...this.state})):void console.log("[DOMAIN]history/index - error1");const a=(()=>{const t=this.routes[e];return t||null})();if(!a)return console.log("[DOMAIN]history/index - push 2. no matched route",s),null;const h=new vn({name:a.name,pathname:a.pathname,title:a.title,query:t,animation:a.options?.animation,parent:null});this.views[s]=h,this.ensureParent(h),h.parent?(this.$router.href=h.href,this.$router.name=h.name,this.stacks=this.stacks.slice(0,this.cursor+1).concat(h),this.cursor+=1,h.parent.showView(h,{reason:"show_sibling",destroy:!1}),this.emit(wn.RouteChange,{reason:"push",view:h,name:e,href:h.href,pathname:h.pathname,query:h.query,ignore:r}),this.emit(wn.StateChange,{...this.state})):console.log("[DOMAIN]history/index - push 3. ",a.name)}replace(e,t={}){const n=[e,mn(t)].filter(Boolean).join("?");if(n===this.$router.href)return void console.log("[DOMAIN]history/index - replace target url is",n,"and cur href is",this.$router.href);const r=this.views[n];if(r){if(this.ensureParent(r),r.query=t,!r.parent)return void console.log("[DOMAIN]history/index - replace 1");this.$router.href=r.href,this.$router.name=r.name;const e=this.stacks[this.stacks.length-1];return e&&e.parent?.removeView(e),this.stacks[this.stacks.length-1]=r,r.parent.showView(r),this.emit(wn.RouteChange,{reason:"replace",view:r,name:r.name,href:r.href,pathname:r.pathname,query:r.query}),void this.emit(wn.StateChange,{...this.state})}const o=(()=>{const t=this.routes[e];return t||null})();if(!o)return console.log("[DOMAIN]history/index - replace 2. no matched route"),null;const s=new vn({name:o.name,pathname:o.pathname,title:o.title,query:t,animation:o.options?.animation,parent:null});if(this.views[n]=s,this.ensureParent(s),!s.parent)return void console.log("[DOMAIN]history/index - replace 3. ");this.$router.href=s.href,this.$router.name=s.name;const i=this.stacks[this.stacks.length-1];i&&i.parent?.removeView(i,{reason:"show_sibling",callback:()=>{delete this.views[n]}}),this.stacks[this.stacks.length-1]=s,s.parent.showView(s),this.emit(wn.RouteChange,{reason:"replace",view:s,name:s.name,href:s.href,pathname:s.pathname,query:s.query}),this.emit(wn.StateChange,{...this.state})}back(e={}){const t=this.cursor-1,n=this.stacks[t];if(!n)return;const r=n.href;if(!n.parent)return;this.$router.href=r,this.$router.name=n.name,this.cursor=t;const o=this.stacks.slice(t+1);for(let e=0;e<o.length;e+=1){const t=o[e];t.parent?.removeView(t,{reason:"back",destroy:!0,callback:()=>{delete this.views[t.href]}})}n.parent.showView(n,{reason:"back",destroy:!0}),this.emit(wn.RouteChange,{reason:"back",view:n,name:n.name,href:n.href,pathname:n.pathname,query:n.query,data:e.data}),this.emit(wn.Back),this.emit(wn.StateChange,{...this.state})}forward(){const e=this.cursor+1,t=this.stacks[e];if(!t)return;if(!t.parent)return;const n=t.href;this.$router.href=n,this.$router.name=t.name,this.cursor=e;const r=this.stacks.slice(e+1);for(let e=0;e<r.length;e+=1){const t=r[e];t.parent?.removeView(t,{reason:"forward",callback:()=>{delete this.views[t.href]}})}t.parent.showView(t),this.emit(wn.RouteChange,{reason:"forward",view:t,name:t.name,href:t.href,pathname:t.pathname,query:t.query}),this.emit(wn.Forward),this.emit(wn.StateChange,{...this.state})}reload(){}destroyAllAndPush(e,t={},n={}){const{ignore:r}=n;if(this.isLayout(e))return void console.log("[DOMAIN]history/index - the target url is layout",e);const o=this.routes[e];if(!o)return void console.log("[DOMAIN]history/index - push 2. no matched route",e);const s=[o.pathname,mn(t)].filter(Boolean).join("?");if(s===this.$router.href)return;const i=this.views.root,a=this.views["root.home_layout"],h=Object.keys(this.views);for(let e=0;e<h.length;e+=1)(()=>{const t=h[e];this.views[t].unmount()})();this.views={root:i,"root.home_layout":a};const l=(()=>{const t=this.routes[e];return t||null})();if(!l)return console.log("[DOMAIN]history/index - push 2. no matched route",s),null;const u=new vn({name:l.name,pathname:l.pathname,title:l.title,query:t,animation:l.options?.animation,parent:null});this.views[s]=u,this.ensureParent(u),u.parent?(this.$router.href=u.href,this.$router.name=u.name,this.stacks=this.stacks.slice(0,this.cursor+1).concat(u),this.cursor+=1,u.parent.showView(u,{reason:"show_sibling",destroy:!1}),this.emit(wn.RouteChange,{reason:"push",view:u,name:e,href:u.href,pathname:u.pathname,query:u.query,ignore:r}),this.emit(wn.StateChange,{...this.state})):console.log("[DOMAIN]history/index - push 3. ",l.name)}ensureParent(e){const{name:t}=e;if(e.parent){if("/"===e.parent.pathname)return;return void this.ensureParent(e.parent)}const n=this.routes[t];if(!n)return;const{parent:r}=n;if(this.views[r.name]){if(e.parent=this.views[r.name],"root"===r.name)return;return void this.ensureParent(this.views[r.name])}const o=this.routes[r.name];if(!o)return null;const s=new vn({name:o.name,pathname:o.pathname,title:o.title,parent:null});this.views[o.name]=s,e.parent=s,this.ensureParent(s)}buildURL(e,t={}){const n=(()=>{const t=this.routes[e];return t||null})();if(!n)return console.log("[DOMAIN]history/index - push 2. no matched route",e),this.routes["root.notfound"].pathname;return new vn({name:n.name,pathname:n.pathname,title:n.title,query:t,parent:null}).buildUrl(t)}buildURLWithPrefix(e,t={}){const n=(()=>{const t=this.routes[e];return t||null})();if(!n)return console.log("[DOMAIN]history/index - push 2. no matched route",e),this.routes["root.notfound"].pathname;return new vn({name:n.name,pathname:n.pathname,title:n.title,query:t,parent:null}).buildUrlWithPrefix(t)}isLayout(e){const t=this.routes[e];return t?t.layout:null}handleClickLink(e){const{href:t,target:n}=e;this.emit(wn.ClickLink,{href:t,target:n})}onTopViewChange(e){return this.on(wn.TopViewChange,e)}onRouteChange(e){return this.on(wn.RouteChange,e)}onBack(e){return this.on(wn.Back,e)}onForward(e){return this.on(wn.Forward,e)}onClickLink(e){return this.on(wn.ClickLink,e)}onStateChange(e){return this.on(wn.StateChange,e)}},e.HttpClientCore=class extends s{hostname="";headers={};debug=!1;constructor(e={}){super(e);const{hostname:t="",headers:n={},debug:r=!1}=e;this.hostname=t,this.headers=n,this.debug=r}async get(e,t,n={}){try{const r=this.hostname,o={url:"string"==typeof e?[r,e,t?"?"+mn(t):""].join(""):e,method:"GET",id:n.id,headers:{...this.headers,...n.headers||{}}};this.debug&&console.log("[DOMAIN]http_client - before fetch",o);const s=await this.fetch(o);return a.Ok(s.data)}catch(e){const t=e,{message:n}=t;return a.Err(n)}}async post(e,t,n={}){const r=this.hostname,o="string"==typeof e?[r,e].join(""):e;try{const e={url:o,method:"POST",data:t,id:n.id,headers:{...this.headers,...n.headers||{}}};this.debug&&console.log("[DOMAIN]http_client - before fetch",e);const r=await this.fetch(e);return a.Ok(r.data)}catch(e){const t=e,{message:n}=t;return a.Err(n)}}async fetch(e){return console.log("请在 connect 中实现 fetch 方法"),{data:{}}}cancel(e){const t="请在 connect 中实现 cancel 方法";return console.log(t),a.Err(t)}setHeaders(e){this.headers=e}appendHeaders(e){this.headers={...this.headers,...e}}setDebug(e){this.debug=e}onStateChange(e){return this.on(xn.StateChange,e)}},e.ListCore=mo,e.MultipleSelectionCore=class extends s{shape="multiple-select";value=[];defaultValue=[];options=[];get state(){return{value:this.value,options:this.options}}constructor(e){super(e);const{defaultValue:t,options:n,onChange:r}=e;this.defaultValue=t,this.value=t,this.options=n,r&&this.onChange(r)}setValue(e){this.value=e,this.emit(go.Change,[...this.value])}toggle(e){this.value.includes(e)?this.remove(e):this.select(e)}select(e){this.value.includes(e)||(this.value.push(e),this.emit(go.Change,[...this.value]),this.emit(go.StateChange,{...this.state}))}remove(e){this.value.includes(e)&&(this.value=this.value.filter(t=>t!==e),this.emit(go.Change,[...this.value]),this.emit(go.StateChange,{...this.state}))}isEmpty(){return 0===this.value.length}clear(){this.value=[],this.emit(go.Change,[...this.value]),this.emit(go.StateChange,{...this.state})}onChange(e){return this.on(go.Change,e)}onStateChange(e){return this.on(go.StateChange,e)}},e.NavigatorCore=tn,e.RequestCore=so,e.Result=a,e.RouteMenusModel=function(e){const t={refresh(){i.emit(n.StateChange,{...s})},setCurMenu(e){r=e,t.refresh()}};let n,r=e.route,s={get menus(){return e.menus},get route_name(){return r}};!function(e){e[e.StateChange=0]="StateChange",e[e.Error=1]="Error"}(n||(n={}));const i=o(),a=e.$history.onRouteChange(({name:e})=>{t.setCurMenu(e)});return{methods:t,ui:{},state:s,ready(){},destroy(){a(),i.destroy()},onStateChange:e=>i.on(n.StateChange,e),onError:e=>i.on(n.Error,e)}},e.RouteViewCore=vn,e.ShortcutModel=Ko,e.SlateDOM=xs,e.SlateEditorModel=function(e){const t={refresh(){d.emit(r.StateChange,{...c})},emitSelectionChange(e){d.emit(r.SelectionChange,{type:e.type,start:n.$selection.start,end:n.$selection.end})},apply(e){n.$history.methods.push(e,{start:n.$selection.start,end:n.$selection.end}),d.emit(r.Action,e)},findNodeByPath(e){console.log("[]slate/slate findNodeByPath",s,e);let t=0,n=s[e[t]];for(;t<e.length-1;)t+=1,n=n.children?.[e[t]];return n},getDefaultInsertLocation:()=>[0],insertText(e,r={}){n.$selection.start,n.$selection.end;const o=t.findNodeByPath(n.$selection.start.path);if(!o||o.type!==Go.Text)return;let i=!1;l&&u&&(n.$selection.methods.setStartAndEnd({start:l,end:u}),i=!0,l=null,u=null);const a=n.$selection.start,h=n.$selection.end,c=o.text,d=e;[" ","，","。","；"].includes(d)&&n.$history.methods.mark();if(Jo.isSamePoint(a,h)){const r={type:Qo.InsertText,text:d,original_text:c,path:a.path,offset:a.offset};return s=es.exec(s,r),t.apply([r]),n.$selection.methods.moveForward({step:e.length}),void t.emitSelectionChange({type:Qo.InsertText})}if(!ss.isSameParent(a.path,h.path)){const e=ts(s,h.path);if(e&&e.type===Go.Text){const r=[],{op_start_delete_text:i,op_end_delete_text:l}=t.removeContentCrossLines(o,e,a,h);s=es.exec(s,i),s=es.exec(s,l),r.push(i),r.push(l);const u=t.removeLinesCrossLines(a,h);u&&(s=es.exec(s,u.op_remove_lines),r.push(u.op_remove_lines));const p={type:Qo.MergeNode,path:a.path,offset:a.offset,start:a,end:u?u.end:h};s=es.exec(s,p),r.push(p);const f={type:Qo.InsertText,text:d,original_text:c,path:a.path,offset:a.offset};return s=es.exec(s,f),r.push(f),t.apply(r),n.$selection.methods.collapseToOffset({offset:a.offset+d.length}),void t.emitSelectionChange({type:Qo.Unknown})}}const p=c.substring(a.offset,h.offset),f=[],g={type:Qo.RemoveText,ignore:i,text:p,original_text:c,path:a.path,offset:a.offset};f.push(g),s=es.exec(s,g);const m={type:Qo.InsertText,text:d,original_text:c,path:a.path,offset:a.offset};f.push(m),s=es.exec(s,m),t.apply(f),n.$selection.methods.collapseToOffset({offset:a.offset+d.length}),t.emitSelectionChange({type:Qo.InsertText})},insertLineBefore(){const{start:e}=n.$selection,r=e.path[0],o={type:Qo.InsertLines,node:[{key:us(),type:Go.Paragraph,children:[{type:Go.Text,text:""}]}],path:[r-1]};s=es.exec(s,o),t.apply([o]),n.$selection.methods.moveToNextLineHead(),t.emitSelectionChange({type:Qo.InsertLines})},insertLineAfter(){const{start:e,end:r}=n.$selection,o=Jo.isSamePoint(e,r);console.log("[]slate/slate - insertLineAfter",o,e,r);const i=[];if(!o){const t=ts(s,e.path);if(t&&t.type===Go.Text){const n=t.text,o=n.substring(e.offset,r.offset),a={type:Qo.RemoveText,text:o,original_text:n,path:e.path,offset:e.offset};s=es.exec(s,a),i.push(a)}}const a={type:Qo.InsertLines,node:[{key:us(),type:Go.Paragraph,children:[{type:Go.Text,text:""}]}],path:e.path};i.push(a),s=es.exec(s,a),t.apply(i),n.$selection.methods.moveToNextLineHead(),t.emitSelectionChange({type:Qo.InsertLines})},splitLine(){const{start:e,end:r}=n.$selection;if(Jo.isSamePoint(e,r)){const r=n.$selection.methods.calcNextLineHead(),o={type:Qo.SplitNode,path:e.path,offset:e.offset,start:r.start,end:r.end};return console.log("[]slate/slate - splitLine",s),s=es.exec(s,o),t.apply([o]),n.$selection.methods.setStartAndEnd(r),void t.emitSelectionChange({type:Qo.SplitNode})}const o=t.findNodeByPath(e.path),i=t.findNodeByPath(r.path);if(!o||o.type!==Go.Text||!i||i.type!==Go.Text)return;if(ss.isSameParent(e.path,r.path)){const i=o.text,a=i.substring(e.offset,r.offset),h=[],l={type:Qo.RemoveText,text:a,original_text:i,path:e.path,offset:e.offset};h.push(l),s=es.exec(s,l);const u=n.$selection.methods.calcNextLineHead(),c={type:Qo.SplitNode,path:e.path,offset:e.offset,start:u.start,end:u.end};return h.push(c),s=es.exec(s,c),t.apply(h),n.$selection.methods.setStartAndEnd(u),void t.emitSelectionChange({type:Qo.SplitNode})}const a=[],{op_start_delete_text:h,op_end_delete_text:l}=t.removeContentCrossLines(o,i,e,r);s=es.exec(s,h),s=es.exec(s,l),a.push(h),a.push(l);const u=t.removeLinesCrossLines(e,r);u&&(s=es.exec(s,u.op_remove_lines),a.push(u.op_remove_lines));const c=n.$selection.methods.calcNextLineHead(),d={type:Qo.SplitNode,path:e.path,offset:e.offset,start:c.start,end:u?u.end:c.end};a.push(d),s=es.exec(s,d),t.apply(a),n.$selection.methods.setStartAndEnd(c),t.emitSelectionChange({type:Qo.SplitNode})},mergeLines(e){console.log("[]mergeLines",e);const r=rs.getLineLastNode(s,e.path[0]-1),o=rs.getLineFirstNode(s,e.path[0]),i=rs.getLineLastPoint(s,e.path[0]-1),a={type:Qo.MergeNode,path:r.path,offset:r.offset,start:o,end:o};s=es.exec(s,a),t.apply([a]),n.$selection.methods.setStartAndEnd({start:i,end:i}),t.emitSelectionChange({type:Qo.MergeNode})},removeLines(e){const r=ts(s,[e.path[0]]);if(r){const o={type:Qo.RemoveLines,node:[r],path:e.path};s=es.exec(s,o),t.apply([o]),n.$selection.methods.moveToPrevLineHead(),t.emitSelectionChange({type:Qo.RemoveLines})}},removeText(e,r){const o=e.text,i=[r.offset-1,r.offset],a=o.substring(i[0],i[1]),h={type:Qo.RemoveText,text:a,original_text:o,path:r.path,offset:i[0]};s=es.exec(s,h),t.apply([h]),n.$selection.methods.moveBackward(),t.emitSelectionChange({type:Qo.RemoveText})},removeContentCrossLines(e,t,n,r){const o=e.text.slice(n.offset),s=t.text.slice(0,r.offset);console.log("[]slate/slate - removeSelectedText - line1 delete text",o,n.offset),console.log("[]slate/slate - removeSelectedText - line2 delete text",s,0);return{op_start_delete_text:{type:Qo.RemoveText,text:o,original_text:e.text,path:n.path,offset:n.offset},op_end_delete_text:{type:Qo.RemoveText,text:s,original_text:t.text,path:r.path,offset:0}}},removeLinesCrossLines(e,t){let n=t;if(console.log("[]slate/slate - removeSelectedText - need remove lines",t.path,e.path),t.path[0]-e.path[0]>1){const r={type:Qo.RemoveLines,node:s.slice(e.path[0]+1,t.path[0]),path:[e.path[0]+1,0]};return n={path:[t.path[0]-r.node.length,0],offset:t.offset},{end:n,op_remove_lines:r}}return null},removeSelectedTextsCrossNodes(e,r){const{start:o,end:i}=r,a=t.findNodeByPath(o.path),h=t.findNodeByPath(i.path);if(a&&h&&a!==h){if(a.type===Go.Text&&h.type===Go.Text){if(rs.isCaretAtLineHead(s,o)&&rs.isCaretAtLineEnd(s,i)){const e=[],r={type:Qo.RemoveLines,path:o.path,node:[...s]};e.push(r),s=es.exec(s,r);const i={type:Qo.InsertLines,path:o.path,node:[{key:us(),type:Go.Paragraph,children:[{type:Go.Text,text:""}]}]};return e.push(i),s=es.exec(s,i),t.apply(e),n.$selection.methods.setToHead(),void t.emitSelectionChange({type:Qo.RemoveLines})}const e=[],{op_start_delete_text:r,op_end_delete_text:l}=t.removeContentCrossLines(a,h,o,i);s=es.exec(s,r),s=es.exec(s,l),e.push(r),e.push(l);const u=t.removeLinesCrossLines(o,i);u&&(s=es.exec(s,u.op_remove_lines),e.push(u.op_remove_lines));const c={type:Qo.MergeNode,path:o.path,offset:o.offset,start:o,end:u?u.end:i};return e.push(c),s=es.exec(s,c),t.apply(e),n.$selection.methods.setStartAndEnd({start:o,end:o}),void t.emitSelectionChange({type:Qo.MergeNode})}console.log("[]slate/slate - removeSelectedTexts - merge node",s[o.path[0]-1]);const e={type:Qo.MergeNode,path:o.path,offset:o.offset,start:o,end:i};return s=es.exec(s,e),t.apply([e]),n.$selection.methods.setStartAndEnd({start:o,end:o}),void t.emitSelectionChange({type:Qo.MergeNode})}const l=e.text,u=[o.offset,i.offset],c=l.substring(u[0],u[1]),d={type:Qo.RemoveText,text:c,original_text:l,path:o.path,offset:u[0]};s=es.exec(s,d),t.apply([d]),n.$selection.methods.collapseToHead(),t.emitSelectionChange({type:Qo.RemoveText})},handleBackward(e={}){let r=n.$selection.start,o=n.$selection.end;const i=t.findNodeByPath(r.path);if(console.log("[]slate/slate - handleBackward - ",i,r.path),!i||i.type!==Go.Text)return void console.log("[ERROR]slate/slate - handleBackward");const a=i.text,h=Jo.isSamePoint(r,o);if(console.log("[]slate/slate - handleBackward - ",h,a,r.offset,o.offset),h){if(Jo.isAtLineHead(r)){if(Jo.isAtFirstLineHead(r))return;if(""===i.text){const e=ts(s,[r.path[0]-1,0]);if(console.log("[]slate/slate - handleBackward - is removeLines?",e),e&&e.type===Go.Text&&""===e.text)return void t.removeLines(r)}return console.log("[]slate/slate - handleBackward - is mergeLines?"),void t.mergeLines(r)}console.log("[]slate/slate - handleBackward - is removeText?"),t.removeText(i,r)}t.removeSelectedTextsCrossNodes(i,{start:r,end:o})},mapNodeWithKey:e=>e?as(s,Number(e)):null,checkIsSelectAll(){},collapse(){},move(e){},getCaretPosition(){},setCaretPosition(e){},handleBeforeInput(e){e.preventDefault();const n=e.data;n&&i&&l&&h&&h.type===Go.Text||null!==n&&(console.log("[DOMAIN]slate/slate ------------------"),console.log("[DOMAIN]slate/slate - handleBeforeInput",n),t.insertText(n))},handleInput(e){e.preventDefault()},handleBlur(e){},handleFocus(e){},handleClick(){},handleCompositionEnd(e){e.preventDefault();const n=e.data;console.log("[]handleCompositionEnd",n),i=!1,""!==n?t.insertText(n):a=!0},handleCompositionUpdate(e){e.preventDefault(),i||(i=!0)},handleCompositionStart(e){e.preventDefault(),i=!0;const r=ts(s,n.$selection.start.path);r&&(h={...r}),l={...n.$selection.start},u={...n.$selection.end},console.log("[BIZ]slate/slate - handleCompositionStart");if(!Jo.isSamePoint(n.$selection.start,n.$selection.end)){const e=ts(s,n.$selection.start.path),r=ts(s,n.$selection.end.path);if(e&&r&&e!==r&&e.type===Go.Text&&r.type===Go.Text){const o=e.text,i=r.text,a=o.slice(n.$selection.start.offset),u=i.slice(0,n.$selection.end.offset),c=[];console.log("[]handleCompositionStart nodes text",e.text,r.text);const d={type:Qo.RemoveText,text:a,original_text:o,path:n.$selection.start.path,offset:n.$selection.start.offset};c.push(d),s=es.exec(s,d);const p={type:Qo.RemoveText,text:u,original_text:i,path:n.$selection.end.path,offset:0};c.push(p),s=es.exec(s,p);const f=t.removeLinesCrossLines(n.$selection.start,n.$selection.end);f&&c.push(f.op_remove_lines);const g={type:Qo.MergeNode,path:n.$selection.start.path,offset:n.$selection.start.offset,start:n.$selection.end,end:f?f.end:n.$selection.end,compositing:!0};c.push(g),s=es.exec(s,g);const m=ts(s,n.$selection.start.path);m&&(h={...m}),t.apply(c),n.$selection.methods.collapseToOffset({offset:l.offset}),t.emitSelectionChange({type:Qo.Unknown})}}},handleKeyDown(e){n.$shortcut.methods.handleKeydown(e)},handleKeyUp(e){n.$shortcut.methods.handleKeyup(e)},handleSelectionChange(){n.$selection.dirty||t.getCaretPosition()}},n={$selection:rs(),$history:os(),$shortcut:Ko()};let r,s=cs(e.defaultValue),i=!1,a=!1,h=null,l=null,u=null,c={get children(){return s},get isFocus(){return false},get JSON(){return JSON.stringify(s,null,2)}};!function(e){e[e.Action=0]="Action",e[e.SelectionChange=1]="SelectionChange",e[e.StateChange=2]="StateChange",e[e.Error=3]="Error"}(r||(r={}));const d=o();return n.$shortcut.methods.register({"MetaLeft+KeyZ"(){console.log("[]MetaLeft+KeyZ");const{operations:e,selection:t}=n.$history.methods.undo();for(let t=0;t<e.length;t+=1){const n=e[t];console.log("[]Undo op",t,n.type),s=es.exec(s,n)}d.emit(r.Action,e),t&&d.emit(r.SelectionChange,{...t,type:Qo.Unknown})},async"MetaLeft+KeyV"(e){e.preventDefault(),console.log("[]slate/slate - MetaLeft+KeyV")},Enter(e){if(i)return;if(e.preventDefault(),Jo.isAtLineHead(n.$selection.start))return void t.insertLineBefore();const r=rs.isCaretAtLineEnd(s,n.$selection.start);console.log("[]slate/slate - Enter",r),r?t.insertLineAfter():t.splitLine()},Backspace(e){a||i?a=!1:(e.preventDefault(),t.handleBackward())}}),{methods:t,ui:n,state:c,get isFocus(){return c.isFocus},ready(){},destroy(){d.destroy()},onAction:e=>d.on(r.Action,e),onSelectionChange:e=>d.on(r.SelectionChange,e),onStateChange:e=>d.on(r.StateChange,e),onError:e=>d.on(r.Error,e)}},e.SlateNode=ns,e.StorageCore=class extends s{key;values;defaultValues;client;get state(){return{values:this.values}}constructor(e){super(e);const{key:t,client:n,defaultValues:r,values:o}=e;this.key=t,this.values=o,this.values={...r,...o},this.defaultValues=r,this.client=n}get(e,t){const n=this.values[e];if(void 0===n){if(t)return t[e];throw new Error("the default value no existing")}return n}set=io(100,(e,t)=>{const n={...this.values,[e]:t};this.values=n,this.client.setItem(this.key,JSON.stringify(this.values)),this.emit(qo.StateChange,{...this.state})});merge=(e,t,n={})=>{const r=this.get(e)||{};if(Array.isArray(r)){let o=n.reverse?[...t,...r]:[...r,...t];return n.limit&&(o=o.slice(0,n.limit)),this.set(e,o),o}if("object"==typeof r&&"object"==typeof t){const n={...r,...t};return this.set(e,n),n}return console.warn("the params of merge must be object"),r};clear(e){if(void 0===this.values[e])return null;this.values={...this.values,[e]:this.defaultValues[e]},this.client.setItem(this.key,JSON.stringify(this.values)),this.emit(qo.StateChange,{...this.state})}remove(e){this.clear(e)}onStateChange(e){return this.on(qo.StateChange,e)}},e.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))})})},e.base=o,e.build=function(e){const t=Cn(e);return{routes:t.map(e=>({[e.name]:e})).reduce((e,t)=>({...e,...t}),{}),routesWithPathname:t.map(e=>({[e.pathname]:e})).reduce((e,t)=>({...e,...t}),{})}},e.buildUrl=Sn,e.createQRCode=async function(e,t){const{width:n,height:r}=t,o=new Ho(t),s=await new Bo({width:n,height:r}).fetchModel(e,t);o.draw(s)},e.merge=function(e,t,n){return"object"!=typeof t?e:null==e?t:Object.keys(t).map(r=>{const o=uo(t,r);return n?{[r]:o}:void 0===uo(e,r)?{[r]:o}:{[r]:uo(e,r)}}).reduce((e,t)=>({...e,...t}),e)},e.noop=function(){},e.omit=lo,e.onRequestCreated=function(e){oo=e},e.onViewCreated=function(e){bn=e},e.qs=co,e.rutil=Wo,e.system=Yo,e.ui=ro});
